<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Марина Варфоломеева" />


<title>Классификация и ординация</title>

<script src="site_libs/header-attrs-2.7/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="site_libs/viz-1.8.2/viz.js"></script>
<link href="site_libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="site_libs/grViz-binding-1.0.6.1/grViz.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">
/* for pandoc --citeproc since 2.11 */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="my_styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-sm-12 col-md-4 col-lg-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-sm-12 col-md-8 col-lg-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Proteomics course</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Начало</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Конспект
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="00_introduction.html">О модуле Анализ протеомных данных</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="01_introduction_to_r.html">Знакомство с R</a>
    </li>
    <li>
      <a href="02_data_preprocessing.html">Предварительная обработка данных</a>
    </li>
    <li>
      <a href="03_classification.html">Классификация</a>
    </li>
    <li>
      <a href="04_differential_expression_analysis.html">Дифференциальная экспрессия</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="protocol.html">Протокол анализа данных</a>
    </li>
  </ul>
</li>
<li>
  <a href="resources.html">Ссылки и ресурсы</a>
</li>
<li>
  <a href="coding_practices.html">Правила хорошего кода</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Классификация и ординация</h1>
<h4 class="author">Марина Варфоломеева</h4>

</div>


<hr />
<p>В этом разделе мы поговорим о том, как делать кластерный анализ и строить тепловые карты экспрессии в R <span class="citation">(R Core Team 2021)</span>.</p>
<ul>
<li><p><a href="03_classification.R">Код к этому занятию</a></p></li>
<li><p>Данные о протеоме жабр гребешка <em>Pecten maximus</em> от авторов пакета <code>prot2D</code> <span class="citation">(Artigaud et al. 2013)</span>:</p>
<ul>
<li><a href="data/pecten.xlsx">pecten.xlsx</a></li>
<li><a href="data/pecten.zip">pecten.zip</a></li>
</ul></li>
<li><p>Данные о протеоме сыворотки крови пациентов, страдающих разной степенью гиперплазии предстательной железы, из пакета <code>digeR</code> <span class="citation">(Fan et al. 2009)</span>:</p>
<ul>
<li><a href="data/prostate.xlsx">prostate.xlsx</a></li>
<li><a href="data/prostate.zip">prostate.zip</a></li>
</ul></li>
<li><p>Пакеты (инсталлируйте при необходимости)</p></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Из репозитория CRAN</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">&quot;dendextend&quot;</span>, <span class="st">&quot;ape&quot;</span>, <span class="st">&quot;vegan&quot;</span>, <span class="st">&quot;pvclust&quot;</span>, <span class="st">&quot;gplots&quot;</span>, <span class="st">&quot;NMF&quot;</span>), <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<hr />
<div id="многомерные-данные" class="section level1">
<h1>Многомерные данные</h1>
<div id="облако-точек-в-многомерном-пространстве" class="section level2">
<h2>Облако точек в многомерном пространстве</h2>
<p>Когда признаков много, можно представить все объекты как облако точек в многомерном пространстве.</p>
<p><img src="images/Migration-DonMcCullough-Flickr.jpg" /></p>
<p>Migration by Don McCullough on <a href="https://flic.kr/p/fEFhCj">Flickr</a></p>
<p>Для изображения N объектов в идеале нужно N-1 измерений</p>
<ul>
<li>2 объекта = 1D прямая</li>
<li>3 объекта = 2D плоскость</li>
<li>4 объекта = 3D объем</li>
<li>…</li>
<li>N объектов = (N-1)-мерное пространство</li>
</ul>
<p>Многомерное пространство сложно изобразить. Есть два пути:</p>
<ul>
<li>Выбрать наиболее информативную проекцию (не все можно хорошо спроецировать).</li>
<li>Сохранить отношения между объектами (придется исказить расстояния).</li>
</ul>
<p><img src="images/BlackShadows-FerranJorda-Flickr.jpg" alt="Ежик в тумане" height=400px></p>
<p>black shadows for a white horses / les negres ombres dels cavalls blancs by Ferran Jordà on <a href="https://flic.kr/p/9XJxiL">Flickr</a></p>
</div>
</div>
<div id="коэффициенты-сходства-различия" class="section level1">
<h1>Коэффициенты сходства-различия</h1>
<p>Различия</p>
<p><span class="math inline">\(d \ge 0\)</span></p>
<div id="htmlwidget-9f90f6795fa1fd89d133" style="width:432px;height:48px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-9f90f6795fa1fd89d133">{"x":{"diagram":"digraph symmetry {\n\n  # a \"graph\" statement\n  graph [overlap = false, fontsize = 10, rankdir = LR]\n\n  # several \"node\" statements\n  node [shape = circle,\n        fixedsize = true,\n        width = 0.5,\n        style = filled,\n        color = grey]\n  node [fillcolor = PowderBlue]\n  A; B\n\n  # several \"edge\" statements\n  A->B [dir = \"both\"]\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>Сходства</p>
<p><span class="math inline">\(0 \le S \le 1\)</span> или <span class="math inline">\(-1 \le S \le 1\)</span></p>
<div id="htmlwidget-4dd3df195a371986a720" style="width:432px;height:48px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-4dd3df195a371986a720">{"x":{"diagram":"digraph symmetry {\n\n  # a \"graph\" statement\n  graph [overlap = false, fontsize = 10, rankdir = LR]\n\n  # several \"node\" statements\n  node [shape = circle,\n        fixedsize = true,\n        width = 0.5,\n        style = filled,\n        color = grey]\n  node [fillcolor = PowderBlue]\n  A; B\n\n  # several \"edge\" statements\n  A->B [dir = \"both\", arrowhead = inv arrowtail = inv]\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<ul>
<li>Используются в качестве исходных данных для многих видов многомерных анализов, в т.ч. для иерархического кластерного анализа</li>
<li>Из сходств можно получить различия и наоборот</li>
<li>Свои собственные коэффициенты существуют для количественных и качественных признаков</li>
</ul>
<div id="евклидово-расстояние" class="section level2">
<h2>Евклидово расстояние</h2>
<p><img src="03_classification_files/figure-html/unnamed-chunk-4-1.png" width="384" /></p>
<p>Для двумерного пространства Евклидово расстояние рассчитывается так:</p>
<p><img src="03_classification_files/figure-html/unnamed-chunk-5-1.png" width="192" /></p>
<p>Т.е. Евклидово расстояние в этом гипотетическом примере будет</p>
<p><img src="03_classification_files/figure-html/unnamed-chunk-6-1.png" width="192" /></p>
<p>Для пространства с большим числом измерений формула Евклидова расстояния выглядит так:</p>
<p><img src="03_classification_files/figure-html/unnamed-chunk-7-1.png" width="192" /></p>
<p>Евклидово расстояние — это метрика.</p>
<p>Для всех метрик (расстояний) справедливы три свойства:</p>
<ol style="list-style-type: decimal">
<li>Адекватность:</li>
</ol>
<p><span class="math display">\[d_{A, A} = 0\]</span></p>
<div id="htmlwidget-4302a6b259cadc2dd115" style="width:384px;height:48px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-4302a6b259cadc2dd115">{"x":{"diagram":"digraph symmetry {\n\n  # a \"graph\" statement\n  graph [overlap = false, fontsize = 10, rankdir = LR/*,\n  label = <<font point-size=\"10\">d<sub><font point-size=\"5\">A, A<\/font><\/sub> = 0<\/font>>*/, labelloc = t]\n\n  # several \"node\" statements\n  node [shape = circle,\n        fixedsize = true,\n        width = 0.5,\n        style = filled,\n        color = grey]\n  node [fillcolor = PowderBlue]\n  A\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<ol start="2" style="list-style-type: decimal">
<li>Симметричность:</li>
</ol>
<p><span class="math display">\[d_{A, B} = d_{B, A}\]</span></p>
<div id="htmlwidget-a832cc8e9a8db2bc4a1d" style="width:384px;height:48px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-a832cc8e9a8db2bc4a1d">{"x":{"diagram":"digraph symmetry {\n\n  # a \"graph\" statement\n  graph [overlap = false, fontsize = 10, rankdir = LR, labelloc = t, labeljust = c/*, label = \"Симметричность\"*/]\n\n  # several \"node\" statements\n  node [shape = circle,\n        fixedsize = true,\n        width = 0.5,\n        style = filled,\n        color = grey]\n  node [fillcolor = PowderBlue]\n  A; B\n\n  # several \"edge\" statements\n  A->B /*[label=<<font point-size=\"10\">d<sub><font point-size=\"5\">A, B<\/font><\/sub> = d<sub><font point-size=\"5\">B, A<\/font><\/sub><\/font>>]*/\n  B->A\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<ol start="3" style="list-style-type: decimal">
<li>Триангулярность:</li>
</ol>
<p><span class="math display">\[d_{A, B} \le d_{A, C} + d_{C, B}\]</span></p>
<p><strong>Триангулярность есть только у метрик!</strong> Именно потому, что для них выполняется неравенство треугольника, они имеют право называться <strong>расстояниями</strong>, а не просто мерами различия.</p>
<div id="htmlwidget-d39c2f02bf2a25c5fe29" style="width:384px;height:96px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-d39c2f02bf2a25c5fe29">{"x":{"diagram":"digraph symmetry {\n\n  # a \"graph\" statement\n  graph [overlap = false, fontsize = 10, rankdir = LR]\n\n  # several \"node\" statements\n  node [shape = circle,\n        fixedsize = true,\n        width = 0.5,\n        style = filled,\n        color = grey]\n  node [fillcolor = PowderBlue]\n  A; B; C\n\n  # several \"edge\" statements\n  A->B A->C C->B\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="коэффициент-жаккара" class="section level2">
<h2>Коэффициент Жаккара</h2>
<p>Если используются бинарные данные, то посчитать сходство можно, учитывая присутствие-отсутствие признаков.</p>
<table>
<thead>
<tr class="header">
<th>объект I / объект J</th>
<th>признак есть</th>
<th>признака нет</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>признак есть</td>
<td>a</td>
<td>b</td>
</tr>
<tr class="even">
<td>признака нет</td>
<td>c</td>
<td>d</td>
</tr>
</tbody>
</table>
<ul>
<li><span class="math inline">\(I\)</span>, <span class="math inline">\(J\)</span> — объекты</li>
<li><span class="math inline">\(a\)</span> — число сходств по наличию признака</li>
<li><span class="math inline">\(b\)</span> — число отличий <span class="math inline">\(I\)</span> от <span class="math inline">\(J\)</span></li>
<li><span class="math inline">\(c\)</span> — число различий <span class="math inline">\(J\)</span> от <span class="math inline">\(I\)</span></li>
<li><span class="math inline">\(d\)</span> — число сходств по отсутствию признака</li>
<li><span class="math inline">\(n_J\)</span> — число признаков у объекта <span class="math inline">\(J\)</span></li>
<li><span class="math inline">\(n_I\)</span> — число признаков у объекта <span class="math inline">\(I\)</span></li>
<li><span class="math inline">\(n = a + b + c + d\)</span> — общее число признаков</li>
</ul>
<p>Коэффициентов сходства-различия для качественных данных придумано великое множество.</p>
<p>Коэффициент Жаккара рассчитывается по формуле:</p>
<p><span class="math inline">\(S = a / (a + b + c)\)</span>, причем <span class="math inline">\(0 \le S \le 1\)</span></p>
<p>Соответствующий коэффициент различия Жаккара можно посчитать так:</p>
<p><span class="math inline">\(d = 1 - a / (a + b + c) = (b + c) / (a + b + c)\)</span></p>
<p>У коэффициента Жаккара есть одно забавное свойство. Обратите внимание, в знаменателе фигурирует не общее число признаков — сходство по отсутствию не учитывается! Это свойство очень полезно для работы с протеомными данными. Пятно может отсутствовать на геле не только потому, что белка не было в пробе, но и в силу самых разных других причин (например, экспрессия ниже порога определения, плохо прокрашен образец и проч.).</p>
<p>Например, пусть у нас есть три пробы, у которых мы нашли всего 5 пятен.</p>
<table>
<thead>
<tr class="header">
<th align="left">Objects</th>
<th align="right">Spot.1</th>
<th align="right">Spot.2</th>
<th align="right">Spot.3</th>
<th align="right">Spot.4</th>
<th align="right">Spot.5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Object 1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Object 2</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Object 3</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>Чтобы оценить различие между этими пробами, можно посчитать коэффициент Жаккара.</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Object 1</th>
<th align="right">Object 2</th>
<th align="right">Object 3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Object 1</td>
<td align="right">0.00</td>
<td align="right">0.25</td>
<td align="right">0.67</td>
</tr>
<tr class="even">
<td align="left">Object 2</td>
<td align="right">0.25</td>
<td align="right">0.00</td>
<td align="right">0.75</td>
</tr>
<tr class="odd">
<td align="left">Object 3</td>
<td align="right">0.67</td>
<td align="right">0.75</td>
<td align="right">0.00</td>
</tr>
</tbody>
</table>
<p>Точно так же, чтобы оценить различие белков, можно посчитать коэффициент Жаккара между белками.</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Spot 1</th>
<th align="right">Spot 2</th>
<th align="right">Spot 3</th>
<th align="right">Spot 4</th>
<th align="right">Spot 5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Spot 1</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.50</td>
<td align="right">0.33</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Spot 2</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.50</td>
<td align="right">0.33</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Spot 3</td>
<td align="right">0.50</td>
<td align="right">0.50</td>
<td align="right">0.00</td>
<td align="right">0.67</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Spot 4</td>
<td align="right">0.33</td>
<td align="right">0.33</td>
<td align="right">0.67</td>
<td align="right">0.00</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Spot 5</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="визуализация-многомерных-данных" class="section level1">
<h1>Визуализация многомерных данных</h1>
<ul>
<li>Дендрограммы</li>
<li>Танглграммы</li>
<li>Тепловые карты</li>
<li>Ординация</li>
</ul>
</div>
<div id="иерархическая-кластеризация" class="section level1">
<h1>Иерархическая кластеризация</h1>
<p>Существует много методов классификации: методы кластеризации на основании расстояний и методы кластеризации на основании признаков.</p>
<p>В этом курсе мы будем затрагивать только <strong>методы иерархической кластеризации на основании расстояний</strong>.</p>
<p>Классификация данных проходит в несколько этапов. Результат кластеризации будет сильнее всего зависеть (1) от выбора коэффициента сходства-различия и (2) от алгоритма кластеризации. Нет формальных способов выбрать наиболее подходящий коэффициент и алгоритм.</p>
<div id="htmlwidget-65033b05cd79c3b4e2e5" style="width:576px;height:384px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-65033b05cd79c3b4e2e5">{"x":{"diagram":"digraph symmetry {\n\n  # a \"graph\" statement\n  graph [overlap = TRUE, fontsize = 10, rankdir = TD]\n\n  # several \"node\" statements\n  node [shape = box,\n        fixedsize = false,\n//        width = 0.5,\n        style = filled,\n        color = grey,\n        fillcolor = PowderBlue]\n  A [label=\"Набор признаков\"]\n  B [label=\"Матрица расстояний или сходств\"]\n  C [label=\"Группировка объектов\"]\n  D [label=\"Отношения между кластерами\"]\n  E [label=\"Поправки\"]\n\n  # several \"edge\" statements\n  A->B B->C C->D D->E E->A\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<div id="алгоритмы-иерархической-кластеризации-на-основании-расстояний" class="section level2">
<h2>Алгоритмы иерархической кластеризации на основании расстояний</h2>
<p>Мы рассмотрим несколько алгоритмов, которые строят иерархическую кластеризацию объектов на основании матрицы различий между ними:</p>
<ul>
<li>Метод ближайшего соседа</li>
<li>Метод отдаленного соседа</li>
<li>Метод среднегруппового расстояния</li>
</ul>
<p><img src="03_classification_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
</div>
<div id="метод-ближайшего-соседа-nearest-neighbour-single-linkage" class="section level2">
<h2>Метод ближайшего соседа (= nearest neighbour = single linkage)</h2>
<ul>
<li>к кластеру присоединяется ближайший к нему кластер/объект</li>
<li>кластеры объединяются в один на расстоянии, которое равно расстоянию между ближайшими объектами этих кластеров</li>
</ul>
<p><img src="03_classification_files/figure-html/unnamed-chunk-16-1.png" width="432" /></p>
<p>Особенности:</p>
<ul>
<li>Может быть сложно интерпретировать, если нужны группы
<ul>
<li>объекты на дендрограмме часто не образуют четко разделенных групп</li>
<li>часто получаются цепочки кластеров (объекты присоединяются как бы по-одному)</li>
</ul></li>
<li>Хорош для выявления градиентов</li>
</ul>
<pre><code>## Registered S3 methods overwritten by &#39;ggalt&#39;:
##   method                  from   
##   grid.draw.absoluteGrob  ggplot2
##   grobHeight.absoluteGrob ggplot2
##   grobWidth.absoluteGrob  ggplot2
##   grobX.absoluteGrob      ggplot2
##   grobY.absoluteGrob      ggplot2</code></pre>
<p><img src="03_classification_files/figure-html/single-ani-.gif" width="768" /></p>
</div>
<div id="метод-отдаленного-соседа-furthest-neighbour-complete-linkage" class="section level2">
<h2>Метод отдаленного соседа (= furthest neighbour = complete linkage)</h2>
<ul>
<li>к кластеру присоединяется отдаленный кластер/объект</li>
<li>кластеры объединяются в один на расстоянии, которое равно расстоянию между самыми отдаленными объектами этих кластеров (следствие - чем более крупная группа, тем сложнее к ней присоединиться)</li>
</ul>
<p><img src="03_classification_files/figure-html/unnamed-chunk-17-1.png" width="432" /></p>
<p>Особенности:</p>
<ul>
<li>На дендрограмме образуется много отдельных некрупных групп</li>
<li>Хорош для поиска дискретных групп в данных</li>
</ul>
<p><img src="03_classification_files/figure-html/complete-ani-.gif" width="768" /></p>
</div>
<div id="метод-невзвешенного-попарного-среднего-upgma-unweighted-pair-group-method-with-arithmetic-mean" class="section level2">
<h2>Метод невзвешенного попарного среднего (= UPGMA = Unweighted Pair Group Method with Arithmetic mean)</h2>
<ul>
<li>кластеры объединяются в один на расстоянии, которое равно среднему значению всех возможных расстояний между объектами из разных кластеров.</li>
</ul>
<p><img src="03_classification_files/figure-html/unnamed-chunk-18-1.png" width="432" /></p>
<p>Особенности:</p>
<ul>
<li>UPGMA и WUPGMС иногда могут приводить к инверсиям на дендрограммах</li>
</ul>
<div class="figure">
<img src="images/clust-revert.png" alt="" />
<p class="caption">Инверсии на дендрограммах</p>
</div>
<p><small>из Borcard et al., 2011</small></p>
<p><img src="03_classification_files/figure-html/average-ani-.gif" width="768" /></p>
</div>
<div id="кластерный-анализ-в-r-гребешки" class="section level2">
<h2>Кластерный анализ в R: гребешки</h2>
<p>Вспомним, на чем мы остановились в прошлый раз.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(limma)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Данные об экспрессии</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>pecten <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="at">path =</span> <span class="st">&quot;data/pecten.xlsx&quot;</span>, <span class="at">sheet =</span> <span class="st">&quot;exprs&quot;</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>spot_names <span class="ot">&lt;-</span> pecten<span class="sc">$</span>Spot</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>pecten <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(pecten[, <span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(pecten) <span class="ot">&lt;-</span> spot_names</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Данные о пробах</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>pecten.fac <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="at">path =</span> <span class="st">&quot;data/pecten.xlsx&quot;</span>, <span class="at">sheet =</span> <span class="st">&quot;pheno&quot;</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>pecten.fac <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(pecten.fac)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>pecten.fac<span class="sc">$</span>Condition <span class="ot">&lt;-</span> <span class="fu">factor</span>(pecten.fac<span class="sc">$</span>Condition)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Логарифмируем данные</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>pecten_log <span class="ot">&lt;-</span> <span class="fu">log2</span>(pecten)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Квантильная нормализация</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>pecten_norm <span class="ot">&lt;-</span> <span class="fu">normalizeQuantiles</span>(<span class="fu">as.matrix</span>(pecten_log))</span></code></pre></div>
<p>Названия проб в этом файле — длинные непонятные аббревиатуры.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(pecten_norm)</span></code></pre></div>
<pre class="r-output"><code>##  [1] "Br_23865" "Br_23883" "Br_23884" "Br_23728" "Br_23729" "Br_23730"
##  [7] "Br_23731" "Br_23732" "Br_23733" "Br_23875" "Br_23876" "Br_23877"
</code></pre>
<p>Вместо них нужно создать осмысленные и краткие лейблы для проб.</p>
<p>Информацию о лейблах возьмем из датафрейма с факторами</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pecten.fac)</span></code></pre></div>
<pre class="r-output"><code>##     Sample Condition
## 1 Br_23865       15C
## 2 Br_23883       15C
## 3 Br_23884       15C
## 4 Br_23728       15C
## 5 Br_23729       15C
## 6 Br_23730       15C
</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(pecten_norm) <span class="ot">&lt;-</span> <span class="fu">make.unique</span>(<span class="fu">as.character</span>(pecten.fac<span class="sc">$</span>Condition))</span></code></pre></div>
<p>Чтобы строить деревья для проб, нам понадобится транспонировать исходные данные</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>tpecten_norm <span class="ot">&lt;-</span> <span class="fu">t</span>(pecten_norm)</span></code></pre></div>
<p>Давайте построим деревья при помощи нескольких алгоритмов кластеризации (по стандартизованным данным, с использованием Евклидова расстояния) и сравним их. Нам понадобится матрица расстояний.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">dist</span>(<span class="at">x =</span> tpecten_norm, <span class="at">method =</span> <span class="st">&quot;euclidean&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Метод ближайшего соседа</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>hc_single <span class="ot">&lt;-</span> <span class="fu">hclust</span>(d, <span class="at">method =</span> <span class="st">&quot;single&quot;</span>)</span></code></pre></div>
<p>Деревья можно визуализировать при помощи базовой графики, но у нее довольно мало возможностей для настройки внешнего вида.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ?plot.hclust</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hc_single)</span></code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>Визуализируем средствами пакета <code>ape</code> <span class="citation">(Paradis and Schliep 2019)</span>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ape)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;ape&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:dendextend&#39;:
## 
##     ladderize, rotate</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>ph_single <span class="ot">&lt;-</span> <span class="fu">as.phylo</span>(hc_single)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ?plot.phylo</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ph_single, <span class="at">type =</span> <span class="st">&quot;phylogram&quot;</span>, <span class="at">cex =</span> <span class="fl">0.7</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">axisPhylo</span>()</span></code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>Визуализируем средствами <code>dendextend</code> <span class="citation">(Galili 2015)</span>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dendextend)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>den_single <span class="ot">&lt;-</span> <span class="fu">as.dendrogram</span>(hc_single)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ?plot.dendrogram</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>op <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">4</span>), <span class="at">cex =</span> <span class="fl">0.7</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(den_single, <span class="at">horiz =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>При желании можно раскрасить лейблы. Это можно сделать вручную, просто передав вектор нужных цветов в том порядке, в котором идут лейблы на дендрограмме.</p>
<p>Чтобы не пришлось вручную создавать вектор цветов, можно попробовать при помощи функции вытащить информацию из лейблов на дендрограмме. Эта функция берет дендрограмму, экстрагирует из нее порядок лейблов, берет первые несколько букв в имени лейбла и на основании этого фактора создает вектор цветов.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>get_colours <span class="ot">&lt;-</span> <span class="cf">function</span>(dend, n_chars, <span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>){</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>labs <span class="ot">&lt;-</span> <span class="fu">get_leaves_attr</span>(dend, <span class="st">&quot;label&quot;</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>group <span class="ot">&lt;-</span> <span class="fu">substr</span>(labs, <span class="at">start =</span> <span class="dv">0</span>, <span class="at">stop =</span> n_chars)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>group <span class="ot">&lt;-</span> <span class="fu">factor</span>(group)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="fu">length</span>(<span class="fu">levels</span>(group)), <span class="at">name =</span> palette)[group]</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(cols)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Теперь можно легко раскрасить группы на дендрограмме, ориентируясь на первые несколько символов в названии лейбла.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">get_colours</span>(<span class="at">dend =</span> den_single, <span class="at">n_chars =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## Warning in brewer.pal(length(levels(group)), name = palette): minimal value for n is 3, returning requested palette with 3 different levels</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>den_single_c <span class="ot">&lt;-</span> <span class="fu">color_labels</span>(<span class="at">dend =</span> den_single, <span class="at">col =</span> cols)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(den_single_c, <span class="at">horiz =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<div id="задание-1" class="section level3">
<h3>Задание 1</h3>
<p>Постройте дендрограммы, описывающие сходство проб, при помощи методов отдаленного соседа и среднегруппового расстояния.</p>
<div id="метод-отдаленного-соседа-в-r" class="section level4">
<h4>Метод отдаленного соседа в R</h4>
<button class="btn btn-primary btn-sm" data-toggle="collapse" data-target="#hide_buttonunnamed-chunk-30">
Решение
</button>
<div id="hide_buttonunnamed-chunk-30" class="collapse">
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Метод отдаленного соседа</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>hc_compl <span class="ot">&lt;-</span> <span class="fu">hclust</span>(d, <span class="at">method =</span> <span class="st">&quot;complete&quot;</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>den_compl <span class="ot">&lt;-</span> <span class="fu">as.dendrogram</span>(hc_compl)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>den_compl_c <span class="ot">&lt;-</span> <span class="fu">color_labels</span>(den_compl, <span class="at">col =</span> <span class="fu">get_colours</span>(den_compl, <span class="at">n_chars =</span> <span class="dv">2</span>))</span></code></pre></div>
<pre><code>## Warning in brewer.pal(length(levels(group)), name = palette): minimal value for n is 3, returning requested palette with 3 different levels</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(den_compl_c, <span class="at">horiz =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<img src="03_classification_files/figure-html/unnamed-chunk-30-1.png" width="672" />
</div>
<p><br /></p>
</div>
<div id="метод-невзвешенного-попарного-среднего-в-r" class="section level4">
<h4>Метод невзвешенного попарного среднего в R</h4>
<button class="btn btn-primary btn-sm" data-toggle="collapse" data-target="#hide_buttonunnamed-chunk-31">
Решение
</button>
<div id="hide_buttonunnamed-chunk-31" class="collapse">
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Метод невзвешенного попарного среднего</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>hc_avg <span class="ot">&lt;-</span> <span class="fu">hclust</span>(d, <span class="at">method =</span> <span class="st">&quot;average&quot;</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>den_avg <span class="ot">&lt;-</span> <span class="fu">as.dendrogram</span>(hc_avg)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>den_avg_c <span class="ot">&lt;-</span> <span class="fu">color_labels</span>(den_avg, <span class="at">col =</span> <span class="fu">get_colours</span>(den_avg, <span class="at">n_chars =</span> <span class="dv">2</span>))</span></code></pre></div>
<pre><code>## Warning in brewer.pal(length(levels(group)), name = palette): minimal value for n is 3, returning requested palette with 3 different levels</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(den_avg_c, <span class="at">horiz =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<img src="03_classification_files/figure-html/unnamed-chunk-31-1.png" width="672" />
</div>
<p><br /></p>
</div>
</div>
</div>
<div id="кофенетическая-корреляция" class="section level2">
<h2>Кофенетическая корреляция</h2>
<p>Кофенетическая корреляция — метод оценки соответствия расстояний на дендрограмме расстояниям либо в исходном многомерном пространстве, либо на другой дендрограмме.</p>
<p>Кофенетическое расстояние — расстояние между объектами на дендрограмме. Его можно рассчитать при помощи функции из пакета <code>ape</code>, например.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cophenetic</span>(ph_single)</span></code></pre></div>
<pre class="r-output"><code>##            15C    15C.1    15C.2    15C.3   15C.4    15C.5      25C    25C.1
## 15C    0.00000 21.42511 23.43037 29.97752 31.0542 29.26930 29.26930 29.26930
## 15C.1 21.42511  0.00000 23.43037 29.97752 31.0542 29.26930 29.26930 29.26930
## 15C.2 23.43037 23.43037  0.00000 29.97752 31.0542 29.26930 29.26930 29.26930
## 15C.3 29.97752 29.97752 29.97752  0.00000 31.0542 29.97752 29.97752 29.97752
## 15C.4 31.05420 31.05420 31.05420 31.05420  0.0000 31.05420 31.05420 31.05420
## 15C.5 29.26930 29.26930 29.26930 29.97752 31.0542  0.00000 28.79182 26.47686
## 25C   29.26930 29.26930 29.26930 29.97752 31.0542 28.79182  0.00000 28.79182
## 25C.1 29.26930 29.26930 29.26930 29.97752 31.0542 26.47686 28.79182  0.00000
## 25C.2 29.26930 29.26930 29.26930 29.97752 31.0542 26.99377 28.79182 26.99377
## 25C.3 23.43037 23.43037 21.91978 29.97752 31.0542 29.26930 29.26930 29.26930
## 25C.4 22.80260 22.80260 23.43037 29.97752 31.0542 29.26930 29.26930 29.26930
## 25C.5 23.23561 23.23561 23.43037 29.97752 31.0542 29.26930 29.26930 29.26930
##          25C.2    25C.3    25C.4    25C.5
## 15C   29.26930 23.43037 22.80260 23.23561
## 15C.1 29.26930 23.43037 22.80260 23.23561
## 15C.2 29.26930 21.91978 23.43037 23.43037
## 15C.3 29.97752 29.97752 29.97752 29.97752
## 15C.4 31.05420 31.05420 31.05420 31.05420
## 15C.5 26.99377 29.26930 29.26930 29.26930
## 25C   28.79182 29.26930 29.26930 29.26930
## 25C.1 26.99377 29.26930 29.26930 29.26930
## 25C.2  0.00000 29.26930 29.26930 29.26930
## 25C.3 29.26930  0.00000 23.43037 23.43037
## 25C.4 29.26930 23.43037  0.00000 23.23561
## 25C.5 29.26930 23.43037 23.23561  0.00000
</code></pre>
<p>Кофенетическую корреляцию можно рассчитать как Пирсоновскую корреляцию (обычную) между матрицами исходных и кофенетических расстояний между всеми парами объектов</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(d, <span class="fu">as.dist</span>(<span class="fu">cophenetic</span>(ph_single)))</span></code></pre></div>
<pre class="r-output"><code>## [1] 0.9426727
</code></pre>
<p>Метод, который дает наибольшую кофенетическую корреляцию дает кластеры лучше всего отражающие исходные данные.</p>
<div id="задание-2" class="section level3">
<h3>Задание 2</h3>
<p>Оцените при помощи кофенетической корреляции качество кластеризаций, полученных разными методами. Какой метод дает лучший результат?</p>
<button class="btn btn-primary btn-sm" data-toggle="collapse" data-target="#hide_buttonunnamed-chunk-34">
Решение
</button>
<div id="hide_buttonunnamed-chunk-34" class="collapse">
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(d, <span class="fu">as.dist</span>(<span class="fu">cophenetic</span>(<span class="fu">as.phylo</span>(hc_compl))))</span></code></pre></div>
<pre class="r-output"><code>## [1] 0.9324593
</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(d, <span class="fu">as.dist</span>(<span class="fu">cophenetic</span>(<span class="fu">as.phylo</span>(hc_avg))))</span></code></pre></div>
<pre class="r-output"><code>## [1] 0.949797
</code></pre>
</div>
<p><br /></p>
</div>
</div>
<div id="бутстреп-поддержка-ветвей" class="section level2">
<h2>Бутстреп-поддержка ветвей</h2>
<p>Вычисление бутстреп-поддержки ветвей дендрограммы поможет оценить, насколько стабильна полученная кластеризация.</p>
<p>“An approximately unbiased test of phylogenetic tree selection” (Shimodaria, 2002)</p>
<p>Этот тест использует специальный вариант бутстрепа — multiscale bootstrap. Мы не просто многократно берем бутстреп-выборки и оцениваем для них вероятность получения топологий (BP p-value), эти выборки еще и будут с разным числом объектов. По изменению BP при разных объемах выборки можно вычислить AU (approximately unbiased p-value).</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pvclust)</span></code></pre></div>
<pre><code>## Registered S3 method overwritten by &#39;pvclust&#39;:
##   method       from      
##   text.pvclust dendextend</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># итераций должно быть 10000 и больше, здесь мало для скорости</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>cl_boot <span class="ot">&lt;-</span> <span class="fu">pvclust</span>(pecten_norm, <span class="at">method.hclust =</span> <span class="st">&quot;average&quot;</span>, <span class="at">nboot =</span> <span class="dv">100</span>, </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method.dist =</span> <span class="st">&quot;euclidean&quot;</span>, <span class="at">iseed =</span> <span class="dv">278456</span>)</span></code></pre></div>
<pre class="r-output"><code>## Bootstrap (r = 0.5)... Done.
## Bootstrap (r = 0.6)... Done.
## Bootstrap (r = 0.7)... Done.
## Bootstrap (r = 0.8)... Done.
## Bootstrap (r = 0.9)... Done.
## Bootstrap (r = 1.0)... Done.
## Bootstrap (r = 1.1)... Done.
## Bootstrap (r = 1.2)... Done.
## Bootstrap (r = 1.3)... Done.
## Bootstrap (r = 1.4)... Done.
</code></pre>
<p>Дерево с величинами поддержки</p>
<p>AU — approximately unbiased p-values (красный), BP — bootstrap p-values (зеленый)</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cl_boot)</span></code></pre></div>
<p><img src="03_classification_files/figure-html/pvclust-tree-1.png" width="960" /></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pvrect(cl_boot) # достоверные ветвления</span></span></code></pre></div>
<p>Если для кластера AU p-value &gt; 0.95, то нулевую гипотезу о том, что он не существует отвергают на уровне значимости 0.05.</p>
<p>Но сами AU p-values оцениваются при помощи бутстрепа, а значит, тоже не точно. Стандартные ошибки можно оценить чтобы оценить точность оценки самих AU. Для диагностики качества оценок AU нам понадобится график стандартных ошибок для AU p-value. Чем больше было бутстреп-итераций, тем точнее будет оценка.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">seplot</span>(cl_boot)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">seplot</span>(cl_boot, <span class="at">identify =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<img src="03_classification_files/figure-html/unnamed-chunk-36-1.png" width="672" />
<pre class="r-output"><code>## integer(0)
</code></pre>
<p>Например, для кластера 8 <span class="math inline">\(AU =\)</span> 0.5354028, а ее стандартная ошибка <span class="math inline">\(SE =\)</span> 0.1137272. Границы 95% доверительного интервала к AU p-value: 0.3124975 и 0.758308. Такая оценка значимости не точна.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cl_boot)</span></code></pre></div>
<pre class="r-output"><code>## 
## Cluster method: average
## Distance      : euclidean
## 
## Estimates on edges:
## 
##       si    au    bp se.si se.au se.bp      v     c  pchi
## 1  0.906 0.962 0.903 0.052 0.026 0.010 -1.536 0.234 0.718
## 2  0.949 0.980 0.933 0.036 0.017 0.009 -1.775 0.280 0.647
## 3  0.323 0.798 0.412 0.142 0.070 0.016 -0.306 0.527 0.802
## 4  0.094 0.653 0.420 0.133 0.091 0.016 -0.096 0.297 0.893
## 5  1.000 1.000 1.000 0.000 0.000 0.000  0.000 0.000 0.000
## 6  0.345 0.690 0.641 0.120 0.087 0.016 -0.429 0.068 0.643
## 7  0.973 0.992 0.925 0.021 0.008 0.010 -1.915 0.473 0.788
## 8  0.535 0.792 0.708 0.114 0.073 0.015 -0.681 0.134 0.862
## 9  0.343 0.762 0.503 0.131 0.076 0.016 -0.361 0.352 0.228
## 10 0.016 0.659 0.352 0.143 0.092 0.016 -0.015 0.395 0.790
## 11 1.000 1.000 1.000 0.000 0.000 0.000  0.000 0.000 0.000
</code></pre>
<div id="задание-3" class="section level3">
<h3>Задание 3</h3>
<p>Повторите бутстреп с 1000 итераций. Чему теперь будет равна стандартная ошибка AU p-value для 8 кластера. Используйте тот же сид, что в прошлом примере.</p>
<button class="btn btn-primary btn-sm" data-toggle="collapse" data-target="#hide_buttonpvclust1">
Решение
</button>
<div id="hide_buttonpvclust1" class="collapse">
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>cl_boot <span class="ot">&lt;-</span> <span class="fu">pvclust</span>(pecten_norm, <span class="at">method.hclust =</span> <span class="st">&quot;average&quot;</span>, <span class="at">nboot =</span> <span class="dv">1000</span>, </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method.dist =</span> <span class="st">&quot;euclidean&quot;</span>, <span class="at">iseed =</span> <span class="dv">278456</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<p><br /></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cl_boot)</span></code></pre></div>
<pre class="r-output"><code>## 
## Cluster method: average
## Distance      : euclidean
## 
## Estimates on edges:
## 
##       au    bp se.au se.bp      v     c  pchi
## 1  0.975 0.905 0.006 0.003 -1.634 0.321 0.261
## 2  0.973 0.929 0.007 0.003 -1.701 0.233 0.601
## 3  0.747 0.409 0.025 0.005 -0.219 0.448 0.744
## 4  0.605 0.401 0.030 0.005 -0.008 0.259 0.787
## 5  1.000 1.000 0.000 0.000  0.000 0.000 0.000
## 6  0.748 0.616 0.025 0.005 -0.482 0.187 0.564
## 7  0.963 0.928 0.009 0.003 -1.624 0.163 0.278
## 8  0.875 0.715 0.017 0.005 -0.860 0.291 0.634
## 9  0.783 0.491 0.023 0.005 -0.380 0.401 0.944
## 10 0.729 0.344 0.027 0.005 -0.104 0.505 0.253
## 11 1.000 1.000 0.000 0.000  0.000 0.000 0.000
</code></pre>
</div>
</div>
</div>
<div id="танглграмма" class="section level1">
<h1>Танглграмма</h1>
<p>Два дерева (с непохожим ветвлением) выравнивают, вращая случайным образом ветви вокруг оснований. Итеративный алгоритм. Картина каждый раз может получиться немного разная, особенно в сложных случаях.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">395</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>untang_w <span class="ot">&lt;-</span> <span class="fu">untangle_step_rotate_2side</span>(den_single, den_avg, <span class="at">print_times =</span> F)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># танглграмма</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tanglegram</span>(untang_w[[<span class="dv">1</span>]], untang_w[[<span class="dv">2</span>]],</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">highlight_distinct_edges =</span> <span class="cn">FALSE</span>,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">common_subtrees_color_lines =</span> F,</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">main =</span> <span class="st">&quot;Tanglegram&quot;</span>,</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">main_left =</span> <span class="st">&quot;Single linkage&quot;</span>,</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">main_right =</span> <span class="st">&quot;UPGMA&quot;</span>,</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">columns_width =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">1</span>, <span class="dv">8</span>),</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">margin_top =</span> <span class="fl">3.2</span>, <span class="at">margin_bottom =</span> <span class="fl">2.5</span>,</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">margin_inner =</span> <span class="dv">4</span>, <span class="at">margin_outer =</span> <span class="fl">0.5</span>,</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">lwd =</span> <span class="fl">1.2</span>, <span class="at">edge.lwd =</span> <span class="fl">1.2</span>,</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">lab.cex =</span> <span class="dv">1</span>, <span class="at">cex_main =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="03_classification_files/figure-html/tang-1.png" width="672" /></p>
</div>
<div id="тепловая-карта" class="section level1">
<h1>Тепловая карта</h1>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gplots) <span class="co"># для тепловых карт</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Палитры для тепловых карт</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>pal_green <span class="ot">&lt;-</span> <span class="fu">colorpanel</span>(<span class="dv">75</span>, <span class="at">low =</span> <span class="st">&quot;black&quot;</span>, <span class="at">mid =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">high =</span> <span class="st">&quot;yellow&quot;</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># library(spatstat) # to convert palette to grayscale</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co"># pal_gray &lt;- to.grey(pal_green, weights=c(1,1,1))</span></span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(pecten_norm)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">heatmap.2</span>(dat, <span class="at">col =</span> pal_green, <span class="at">scale =</span> <span class="st">&quot;none&quot;</span>, </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">key =</span> <span class="cn">TRUE</span>, <span class="at">symkey =</span> <span class="cn">FALSE</span>, </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">density.info =</span> <span class="st">&quot;none&quot;</span>, <span class="at">trace =</span> <span class="st">&quot;none&quot;</span>, </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">cexRow =</span> <span class="dv">1</span>, <span class="at">cexCol =</span> <span class="dv">1</span>, </span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">keysize =</span> <span class="dv">1</span>, <span class="at">margins =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span></code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Настройка внешнего вида</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">heatmap.2</span>(dat, <span class="at">col =</span> pal_green, <span class="at">scale =</span> <span class="st">&quot;none&quot;</span>, </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">key =</span> <span class="cn">TRUE</span>, <span class="at">symkey =</span> <span class="cn">FALSE</span>, </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">density.info =</span> <span class="st">&quot;none&quot;</span>, <span class="at">trace =</span> <span class="st">&quot;none&quot;</span>, </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">cexRow =</span> <span class="dv">1</span>, <span class="at">cexCol =</span> <span class="dv">1</span>, <span class="at">keysize =</span> <span class="dv">1</span>, </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">margins =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">5</span>), </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">key.par =</span> <span class="fu">list</span>(<span class="at">mgp =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">0.9</span>, <span class="dv">0</span>), </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="fl">0.1</span>), <span class="at">cex =</span> <span class="dv">1</span>),</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">key.title =</span> <span class="cn">NA</span>, <span class="at">key.xlab =</span> <span class="cn">NA</span>)</span></code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-40-2.png" width="672" /></p>
<p>Еще один вариант</p>
<p><img src="03_classification_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
</div>
<div id="ординация" class="section level1">
<h1>Ординация</h1>
<p>Из множества методов ординации здесь мы рассмотрим только неметрическое многомерное шкалирование.</p>
<div id="неметрическое-многомерное-шкалирование" class="section level2">
<h2>Неметрическое многомерное шкалирование</h2>
<p>Неметрическое многомерное шкалирование (Nonmetric Multidimensional Scaling, nMDS) — метод визуализации отношений между объектами в пространстве с небольшим числом измерений (обычно 2).</p>
<p>Исходные данные для nMDS — матрица расстояний между объектами в многомерном пространстве.</p>
</div>
<div id="расстояния-по-автодорогам-между-пригородами-санкт-петербурга" class="section level2">
<h2>Расстояния по автодорогам между пригородами Санкт-Петербурга</h2>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["name"],"name":[1],"type":["chr"],"align":["left"]},{"label":["Всеволожск"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Гатчина"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Зеленогорск"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Красное Село"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["Кронштадт"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["Павловск"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["Парголово"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["Петергоф"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["Пушкин"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["Санкт-Петербург"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["Сертолово"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["Сестрорецк"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["Стрельна"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["Шлиссельбург"],"name":[15],"type":["dbl"],"align":["right"]}],"data":[{"1":"Всеволожск","2":"0","3":"71","4":"71","5":"64","6":"70","7":"57","8":"31","9":"73","10":"52","11":"24","12":"37","13":"56","14":"64","15":"40"},{"1":"Гатчина","2":"71","3":"0","4":"97","5":"20","6":"76","7":"30","8":"70","9":"47","10":"29","11":"47","12":"79","13":"82","14":"38","15":"80"},{"1":"Зеленогорск","2":"71","3":"97","4":"0","5":"81","6":"52","7":"87","8":"44","9":"77","10":"82","11":"53","12":"33","13":"25","14":"80","15":"106"},{"1":"Красное Село","2":"64","3":"20","4":"81","5":"0","6":"56","7":"24","8":"53","9":"28","10":"21","11":"31","12":"62","13":"65","14":"19","15":"70"},{"1":"Кронштадт","2":"70","3":"76","4":"52","5":"56","6":"0","7":"75","8":"42","9":"37","10":"70","11":"51","12":"45","13":"28","14":"52","15":"105"},{"1":"Павловск","2":"57","3":"30","4":"87","5":"24","6":"75","7":"0","8":"63","9":"43","10":"5","11":"35","12":"66","13":"70","14":"34","15":"64"},{"1":"Парголово","2":"31","3":"70","4":"44","5":"53","6":"42","7":"63","8":"0","9":"68","10":"59","11":"18","12":"9","13":"29","14":"54","15":"66"},{"1":"Петергоф","2":"73","3":"47","4":"77","5":"28","6":"37","7":"43","8":"68","9":"0","10":"37","11":"41","12":"72","13":"55","14":"10","15":"81"},{"1":"Пушкин","2":"52","3":"29","4":"82","5":"21","6":"70","7":"5","8":"59","9":"37","10":"0","11":"30","12":"61","13":"64","14":"28","15":"58"},{"1":"Санкт-Петербург","2":"24","3":"47","4":"53","5":"31","6":"51","7":"35","8":"18","9":"41","10":"30","11":"0","12":"35","13":"39","14":"31","15":"49"},{"1":"Сертолово","2":"37","3":"79","4":"33","5":"62","6":"45","7":"66","8":"9","9":"72","10":"61","11":"35","12":"0","13":"22","14":"64","15":"74"},{"1":"Сестрорецк","2":"56","3":"82","4":"25","5":"65","6":"28","7":"70","8":"29","9":"55","10":"64","11":"39","12":"22","13":"0","14":"66","15":"93"},{"1":"Стрельна","2":"64","3":"38","4":"80","5":"19","6":"52","7":"34","8":"54","9":"10","10":"28","11":"31","12":"64","13":"66","14":"0","15":"72"},{"1":"Шлиссельбург","2":"40","3":"80","4":"106","5":"70","6":"105","7":"64","8":"66","9":"81","10":"58","11":"49","12":"74","13":"93","14":"72","15":"0"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Расстояния по автодорогам не совсем “евклидовы”: например, из Кронштадта до Санкт-Петербурга нельзя добраться по прямой.</p>
<p><img src="03_classification_files/figure-html/gg-spb-1.png" width="672" /></p>
<p>При помощи nMDS ординации можно восстановить карту, сохраняя ранги расстояний между объектами.</p>
<pre><code>## species scores not available</code></pre>
<p><img src="03_classification_files/figure-html/ord-spb-1.png" width="480" /></p>
<p>Что странного в этой карте?</p>
</div>
<div id="важные-свойства-nmds" class="section level2">
<h2>Важные свойства nMDS</h2>
<ol style="list-style-type: decimal">
<li><p>Ординация <strong>сохраняет ранг расстояний между объектами</strong> (похожие располагаются близко, непохожие — далеко; если объект А похож на B, больше чем на C, то и на ординации он, скорее всего, окажется ближе к B, чем к C).</p></li>
<li><p>На ординации имеет смысл только взаиморасположение объектов. Облако точек в осях MDS можно вращать, перемещать, зеркально отражать. Суть ординации от этого не изменится.</p></li>
<li><p>Значения координат точек в ординации лишены смысла (их вообще можно не приводить на итоговой ординации).</p></li>
</ol>
</div>
<div id="как-работает-nmds" class="section level2">
<h2>Как работает nMDS</h2>
<p>nMDS старается сохранить отношения между объектами. Взаиморасположение точек на плоскости ординации подобно взаиморасположению точек исходном многомерном пространстве признаков, но значения не полностью совпадают. У хорошей ординации nMDS ранги расстояний должны совпадать с рангами коэффициентов различия в исходном многомерном пространстве. Это значит, что в идеале, бOльшим расстояниям в исходном пространстве должны соответствовать бOльшие расстояния на ординации, а меньшим — меньшие (т.е. должны сохраняться ранги расстояний).</p>
<p><strong>Стресс (Stress)</strong> — мера качества ординации. Он показывает, насколько соответствуют друг другу взаиморасположение точек на плоскости ординации и в исходном многомерном пространстве признаков.</p>
<p><span class="math display">\[ Stress(1) = \sqrt{\frac{\sum_{h &lt; i}{(d_{h,i} - \hat d_{h,i})^2}}{\sum_{h &lt; i}{d_{{h,i}}^2}}}\]</span></p>
<ul>
<li><span class="math inline">\(d\)</span> — наблюдаемое значение коэффициента различия между двумя точками</li>
<li><span class="math inline">\(\hat d\)</span> — значение, предсказанное монотонной регрессией</li>
</ul>
<p>Хорошо, когда <span class="math inline">\(Stress(1) &lt; 0.2\)</span>.</p>
</div>
<div id="алгоритм-mds-для-двумерного-случая" class="section level2">
<h2>Алгоритм MDS (для двумерного случая)</h2>
<p><img src="images/ezhik.jpg" alt="Ежик в тумане" width=460px></p>
<!-- Марка СССР Ёжик в тумане (1988, ЦФА №5919). [Википедия](https://ru.wikipedia.org/wiki/%D0%A4%D0%B0%D0%B9%D0%BB:1988_CPA_5919.jpg) -->
<ol style="list-style-type: decimal">
<li>Вычисляем матрицу коэффициентов различия между объектами.</li>
<li>Распределяем объекты на плоскости в случайном порядке (или при помощи PCoA).</li>
<li>Вычисляем стресс.</li>
<li>Сдвигаем точки по плоскости так, чтобы минимизировать стресс.</li>
<li>Повторяем шаги 2-4 несколько раз, чтобы избежать локальных минимумов стресса.</li>
<li>Обычно финальную ординацию поворачивают, чтобы вдоль оси X было максимальное варьирование.</li>
</ol>
</div>
<div id="ограничения-nmds" class="section level2">
<h2>Ограничения nMDS</h2>
<ul>
<li>nMDS — метод визуализации данных.</li>
<li>Коэффициент различия и трансформация данных должны быть выбраны исходя из того, какие именно свойства объектов должны быть визуализированы.</li>
<li>Число измерений, выбранное для решения, может влиять на результат.</li>
</ul>
</div>
<div id="nmds-ординация-в-r-гребешки" class="section level2">
<h2>nMDS ординация в R: гребешки</h2>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vegan)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>pecten_ord <span class="ot">&lt;-</span> <span class="fu">metaMDS</span>(tpecten_norm, </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">distance =</span> <span class="st">&quot;euclidean&quot;</span>, </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">autotransform =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre class="r-output"><code>## Run 0 stress 0.08158633 
## Run 1 stress 0.09081752 
## Run 2 stress 0.09823082 
## Run 3 stress 0.09078355 
## Run 4 stress 0.09823011 
## Run 5 stress 0.09078365 
## Run 6 stress 0.09823084 
## Run 7 stress 0.0816771 
## ... Procrustes: rmse 0.01241796  max resid 0.03182757 
## Run 8 stress 0.09822995 
## Run 9 stress 0.09823039 
## Run 10 stress 0.08178897 
## ... Procrustes: rmse 0.01492262  max resid 0.03480022 
## Run 11 stress 0.08238989 
## Run 12 stress 0.08178756 
## ... Procrustes: rmse 0.01459091  max resid 0.03351948 
## Run 13 stress 0.08171802 
## ... Procrustes: rmse 0.01093246  max resid 0.029369 
## Run 14 stress 0.09081753 
## Run 15 stress 0.08211808 
## Run 16 stress 0.09083643 
## Run 17 stress 0.09080793 
## Run 18 stress 0.08158633 
## ... Procrustes: rmse 8.184541e-06  max resid 1.784713e-05 
## ... Similar to previous best
## Run 19 stress 0.0982301 
## Run 20 stress 0.08158633 
## ... New best solution
## ... Procrustes: rmse 6.15476e-06  max resid 1.101896e-05 
## ... Similar to previous best
## *** Solution reached
</code></pre>
<p>Простейший график ординации проб:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ordiplot</span>(pecten_ord, <span class="at">type =</span> <span class="st">&quot;t&quot;</span>, <span class="at">display =</span> <span class="st">&quot;sites&quot;</span>)</span></code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
<p>Хорошая ли получилась ординация, можно узнать по величине стресса:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>pecten_ord<span class="sc">$</span>stress</span></code></pre></div>
<pre class="r-output"><code>## [1] 0.08158633
</code></pre>
<p>Давайте теперь раскрасим график ординации.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Палитры</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>pal_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;steelblue&quot;</span>, <span class="st">&quot;orangered&quot;</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>pal_sh <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">17</span>, <span class="dv">19</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Украшенный график nMDS ординации</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ordiplot</span>(pecten_ord, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, <span class="at">display =</span> <span class="st">&quot;sites&quot;</span>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(pecten_ord, </span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> pal_col[pecten.fac<span class="sc">$</span>Condition], </span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> pal_sh[pecten.fac<span class="sc">$</span>Condition])</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, </span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>       <span class="fu">levels</span>(pecten.fac<span class="sc">$</span>Condition),</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> pal_col, </span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> pal_sh, </span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>, </span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">xpd =</span> T)</span></code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># График nMDS ординации, где обведено облако проб одной категории</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ordiplot</span>(pecten_ord, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, <span class="at">display =</span> <span class="st">&quot;sites&quot;</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(pecten_ord, </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> pal_col[pecten.fac<span class="sc">$</span>Condition], </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> pal_sh[pecten.fac<span class="sc">$</span>Condition])</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ordihull</span>(pecten_ord, <span class="at">groups =</span> pecten.fac<span class="sc">$</span>Condition, <span class="at">col =</span> pal_col, <span class="at">label =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-46-2.png" width="672" /></p>
<p>Можно сопоставить результаты ординации и классификации. Видно, что дендрограмма лишь очень условно отображает исходное многомерное пространство.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># График nMDS ординации с наложенной дендрограммой</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ordiplot</span>(pecten_ord, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, <span class="at">display =</span> <span class="st">&quot;sites&quot;</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(pecten_ord, </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> pal_col[pecten.fac<span class="sc">$</span>Condition], </span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> pal_sh[pecten.fac<span class="sc">$</span>Condition])</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ordicluster</span>(pecten_ord, <span class="at">cluster =</span> hc_avg)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, </span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>       <span class="fu">levels</span>(pecten.fac<span class="sc">$</span>Condition),</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> pal_col, </span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> pal_sh, </span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>, </span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">xpd =</span> T)</span></code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
</div>
</div>
<div id="задание-для-самостоятельной-работы" class="section level1">
<h1>Задание для самостоятельной работы</h1>
<p>Для выполнения этого задания вы можете использовать либо свои собственные данные, либо (уже логарифмированные) данные о протеоме сыворотки крови пациентов, страдающих разной степенью гиперплазии предстательной железы, из пакета <code>digeR</code> <span class="citation">(Fan et al. 2009)</span>: - <a href="data/prostate.xlsx">prostate.xlsx</a> - <a href="data/prostate.zip">prostate.zip</a></p>
<p>В качестве исходных данных используйте матрицу евклидовых расстояний между пробами.</p>
<ul>
<li><p>Постройте дендрограмму. Используйте алгоритм кластеризации, который лучше всего отражает матрицу исходных расстояний на дендрограмме)</p></li>
<li><p>Постройте танглграмму из двух дендрограмм, полученных методом ближайшего соседа и методом невзвешенного попарного среднего.</p></li>
<li><p>Постройте тепловую карту.</p></li>
<li><p>Постройте ординацию методом nMDS.</p></li>
</ul>
<p>На ваш взгляд, для каких целей лучше всего подходит каждый из использованных методов визуализации?</p>
</div>
<div id="ссылки" class="section level1 unnumbered">
<h1 class="unnumbered">Ссылки</h1>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-Artigaud_2013" class="csl-entry">
Artigaud, S., O. Gauthier, and V. Pichereau. 2013. Identifying differentially expressed proteins in two-dimensional electrophoresis experiments: Inputs from transcriptomics statistical tools. Bioinformatics 29:2729–2734.
</div>
<div id="ref-fan2009diger" class="csl-entry">
Fan, Y., T. B. Murphy, and R. W. G. Watson. 2009. digeR: A graphical user interface r package for analyzing 2D-DIGE data. Bioinformatics 25:3033–3034.
</div>
<div id="ref-Galili_2015" class="csl-entry">
Galili, T. 2015. Dendextend: An r package for visualizing, adjusting, and comparing trees of hierarchical clustering. Bioinformatics.
</div>
<div id="ref-Paradis_2019" class="csl-entry">
Paradis, E., and K. Schliep. 2019. Ape 5.0: An environment for modern phylogenetics and evolutionary analyses in <span>R</span>. Bioinformatics 35:526–528.
</div>
<div id="ref-R_Core_Team_2021" class="csl-entry">
R Core Team. 2021. R: A language and environment for statistical computing. R Foundation for Statistical Computing, Vienna, Austria.
</div>
</div>
</div>

<p><small>
  <br/>
(C) 2019-present Marina Varfolomeeva, Arina Maltseva
</small></p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
