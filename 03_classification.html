<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Марина Варфоломеева" />


<title>Классификация и ординация</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<script src="site_libs/viz-0.3/viz.js"></script>
<link href="site_libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="site_libs/grViz-binding-1.0.0/grViz.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="my_styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<div class="container-fluid main-container">

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Proteomics course</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Начало</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Конспект
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="00_introduction.html">О модуле Анализ протеомных данных</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="01_introduction_to_r.html">Знакомство с R</a>
    </li>
    <li>
      <a href="02_data_preprocessing.html">Предварительная обработка данных</a>
    </li>
    <li class="dropdown-header">Классификация</li>
    <li class="dropdown-header">Дифференциальная экспрессия</li>
    <li class="divider"></li>
    <li>
      <a href="protocol.html">Протокол анализа данных</a>
    </li>
  </ul>
</li>
<li>
  <a href="resources.html">Ссылки и ресурсы</a>
</li>
<li>
  <a href="coding_practices.html">Правила хорошего кода</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Классификация и ординация</h1>
<h4 class="author"><em>Марина Варфоломеева</em></h4>

</div>


<style type="text/css">
.spoiler {
  visibility: hidden;
}

.spoiler::before {
  visibility: visible;
  content: "ОТВЕТ (наведите указатель, чтобы увидеть)"
}

.spoiler:hover {
  visibility: visible;
}

.spoiler:hover::before {
  display: none;
}
</style>
<hr />
<p>В этом разделе мы поговорим о том, как делать кластерный анализ и строить тепловые карты экспрессии в R <span class="citation">(R Core Team 2018)</span>.</p>
<ul>
<li><p><a href="03_classification1.R">Код к этому занятию</a></p></li>
<li>Данные о протеоме жабр гребешка <em>Pecten maximus</em> от авторов пакета <code>prot2D</code> <span class="citation">(Artigaud et al. 2013)</span>:
<ul>
<li><a href="data/pecten.xlsx">pecten.xlsx</a></li>
<li><a href="data/pecten.zip">pecten.zip</a></li>
</ul></li>
<li>Данные о протеоме сыворотки крови пациентов, страдающих разной степенью гиперплазии предстательной железы, из пакета <code>digeR</code> <span class="citation">(Fan et al. 2009)</span>:
<ul>
<li><a href="data/prostate.xlsx">prostate.xlsx</a></li>
<li><a href="data/prostate.zip">prostate.zip</a></li>
</ul></li>
<li><p>Пакеты (инсталлируйте при необходимости)</p></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># Из репозитория CRAN</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">install.packages</span>(<span class="kw">c</span>(<span class="st">&quot;dendextend&quot;</span>, <span class="st">&quot;ape&quot;</span>, <span class="st">&quot;vegan&quot;</span>, <span class="st">&quot;pvclust&quot;</span>, <span class="st">&quot;gplots&quot;</span>, <span class="st">&quot;NMF&quot;</span>), <span class="dt">dependencies =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<hr />
<div id="-" class="section level1">
<h1>Многомерные данные</h1>
<div id="----" class="section level2">
<h2>Облако точек в многомерном пространстве</h2>
<p>Когда признаков много, можно представить все объекты как облако точек в многомерном пространстве.</p>
<p><img src="images/Migration-DonMcCullough-Flickr.jpg" /></p>
<p>Migration by Don McCullough on <a href="https://flic.kr/p/fEFhCj">Flickr</a></p>
<p>Для изображения N объектов в идеале нужно N-1 измерений</p>
<ul>
<li>2 объекта = 1D прямая</li>
<li>3 объекта = 2D плоскость</li>
<li>4 объекта = 3D объем</li>
<li>…</li>
<li>N объектов = (N-1)-мерное пространство</li>
</ul>
<p>Многомерное пространство сложно изобразить. Есть два пути:</p>
<ul>
<li>Выбрать наиболее информативную проекцию (не все можно хорошо спроецировать).</li>
<li>Сохранить отношения между объектами (придется исказить расстояния).</li>
</ul>
<p><img src="images/BlackShadows-FerranJorda-Flickr.jpg" alt="Ежик в тумане" height=400px></p>
<p>black shadows for a white horses / les negres ombres dels cavalls blancs by Ferran Jordà on <a href="https://flic.kr/p/9XJxiL">Flickr</a></p>
</div>
</div>
<div id="--" class="section level1">
<h1>Коэффициенты сходства-различия</h1>
<p>Различия</p>
<p><span class="math inline">\(d \ge 0\)</span> <div id="htmlwidget-9663bf022f0cf4edfe55" style="width:432px;height:48px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-9663bf022f0cf4edfe55">{"x":{"diagram":"digraph symmetry {\n\n  # a \"graph\" statement\n  graph [overlap = false, fontsize = 10, rankdir = LR]\n\n  # several \"node\" statements\n  node [shape = circle,\n        fixedsize = true,\n        width = 0.5,\n        style = filled,\n        color = grey]\n  node [fillcolor = PowderBlue]\n  A; B\n\n  # several \"edge\" statements\n  A->B [dir = \"both\"]\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script></p>
<p>Сходства</p>
<p><span class="math inline">\(0 \le S \le 1\)</span> или <span class="math inline">\(-1 \le S \le 1\)</span></p>
<div id="htmlwidget-e5c55c61a7f113cf9190" style="width:432px;height:48px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-e5c55c61a7f113cf9190">{"x":{"diagram":"digraph symmetry {\n\n  # a \"graph\" statement\n  graph [overlap = false, fontsize = 10, rankdir = LR]\n\n  # several \"node\" statements\n  node [shape = circle,\n        fixedsize = true,\n        width = 0.5,\n        style = filled,\n        color = grey]\n  node [fillcolor = PowderBlue]\n  A; B\n\n  # several \"edge\" statements\n  A->B [dir = \"both\", arrowhead = inv arrowtail = inv]\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<ul>
<li>Используются в качестве исходных данных для многих видов многомерных анализов, в т.ч. для иерархического кластерного анализа</li>
<li>Из сходств можно получить различия и наоборот</li>
<li>Свои собственные коэффициенты существуют для количественных и качественных признаков</li>
</ul>
<div id="-" class="section level2">
<h2>Евклидово расстояние</h2>
<p><img src="03_classification_files/figure-html/unnamed-chunk-5-1.png" width="384" /></p>
<p>Для двумерного пространства Евклидово расстояние рассчитывается так:</p>
<p><img src="03_classification_files/figure-html/unnamed-chunk-6-1.png" width="192" /></p>
<p>Т.е. Евклидово расстояние в этом гипотетическом примере будет</p>
<p><img src="03_classification_files/figure-html/unnamed-chunk-7-1.png" width="192" /></p>
<p>Для пространства с большим числом измерений формула Евклидова расстояния выглядит так:</p>
<p><img src="03_classification_files/figure-html/unnamed-chunk-8-1.png" width="192" /></p>
<p>Евклидово расстояние — это метрика.</p>
<p>Для всех метрик (расстояний) справедливы три свойства:</p>
<ol style="list-style-type: decimal">
<li>Адекватность:</li>
</ol>
<p><span class="math display">\[d_{A, A} = 0\]</span></p>
<div id="htmlwidget-4b3aacdc4071ea1ce38c" style="width:384px;height:48px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-4b3aacdc4071ea1ce38c">{"x":{"diagram":"digraph symmetry {\n\n  # a \"graph\" statement\n  graph [overlap = false, fontsize = 10, rankdir = LR/*,\n  label = <<font point-size=\"10\">d<sub><font point-size=\"5\">A, A<\/font><\/sub> = 0<\/font>>*/, labelloc = t]\n\n  # several \"node\" statements\n  node [shape = circle,\n        fixedsize = true,\n        width = 0.5,\n        style = filled,\n        color = grey]\n  node [fillcolor = PowderBlue]\n  A\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<ol start="2" style="list-style-type: decimal">
<li>Симметричность:</li>
</ol>
<p><span class="math display">\[d_{A, B} = d_{B, A}\]</span></p>
<div id="htmlwidget-40748004ab576bfa8778" style="width:384px;height:48px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-40748004ab576bfa8778">{"x":{"diagram":"digraph symmetry {\n\n  # a \"graph\" statement\n  graph [overlap = false, fontsize = 10, rankdir = LR, labelloc = t, labeljust = c/*, label = \"Симметричность\"*/]\n\n  # several \"node\" statements\n  node [shape = circle,\n        fixedsize = true,\n        width = 0.5,\n        style = filled,\n        color = grey]\n  node [fillcolor = PowderBlue]\n  A; B\n\n  # several \"edge\" statements\n  A->B /*[label=<<font point-size=\"10\">d<sub><font point-size=\"5\">A, B<\/font><\/sub> = d<sub><font point-size=\"5\">B, A<\/font><\/sub><\/font>>]*/\n  B->A\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<ol start="3" style="list-style-type: decimal">
<li>Триангулярность:</li>
</ol>
<p><span class="math display">\[d_{A, B} \le d_{A, C} + d_{C, B}\]</span></p>
<p><strong>Триангулярность есть только у метрик!</strong> Именно потому, что для них выполняется неравенство треугольника, они имеют право называться <strong>расстояниями</strong>, а не просто мерами различия.</p>
<div id="htmlwidget-f92d5f2d905baecbd94f" style="width:384px;height:96px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-f92d5f2d905baecbd94f">{"x":{"diagram":"digraph symmetry {\n\n  # a \"graph\" statement\n  graph [overlap = false, fontsize = 10, rankdir = LR]\n\n  # several \"node\" statements\n  node [shape = circle,\n        fixedsize = true,\n        width = 0.5,\n        style = filled,\n        color = grey]\n  node [fillcolor = PowderBlue]\n  A; B; C\n\n  # several \"edge\" statements\n  A->B A->C C->B\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="-" class="section level2">
<h2>Коэффициент Жаккара</h2>
<p>Если используются бинарные данные, то посчитать сходство можно, учитывая присутствие-отсутствие признаков.</p>
<table>
<thead>
<tr class="header">
<th>объект I / объект J</th>
<th>признак есть</th>
<th>признака нет</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>признак есть</td>
<td>a</td>
<td>b</td>
</tr>
<tr class="even">
<td>признака нет</td>
<td>c</td>
<td>d</td>
</tr>
</tbody>
</table>
<ul>
<li><span class="math inline">\(I\)</span>, <span class="math inline">\(J\)</span> — объекты</li>
<li><span class="math inline">\(a\)</span> — число сходств по наличию признака</li>
<li><span class="math inline">\(b\)</span> — число отличий <span class="math inline">\(I\)</span> от <span class="math inline">\(J\)</span></li>
<li><span class="math inline">\(c\)</span> — число различий <span class="math inline">\(J\)</span> от <span class="math inline">\(I\)</span></li>
<li><span class="math inline">\(d\)</span> — число сходств по отсутствию признака</li>
<li><span class="math inline">\(n_J\)</span> — число признаков у объекта <span class="math inline">\(J\)</span></li>
<li><span class="math inline">\(n_I\)</span> — число признаков у объекта <span class="math inline">\(I\)</span></li>
<li><span class="math inline">\(n = a + b + c + d\)</span> — общее число признаков</li>
</ul>
<p>Коэффициентов сходства-различия для качественных данных придумано великое множество.</p>
<p>Коэффициент Жаккара рассчитывается по формуле:</p>
<p><span class="math inline">\(S = a / (a + b + c)\)</span>, причем <span class="math inline">\(0 \le S \le 1\)</span></p>
<p>Соответствующий коэффициент различия Жаккара можно посчитать так:</p>
<p><span class="math inline">\(d = 1 - a / (a + b + c) = (b + c) / (a + b + c)\)</span></p>
<p>У коэффициента Жаккара есть одно забавное свойство. Обратите внимание, в знаменателе фигурирует не общее число признаков — сходство по отсутствию не учитывается! Это свойство очень полезно для работы с протеомными данными. Пятно может отсутствовать на геле не только потому, что белка не было в пробе, но и в силу самых разных других причин (например, экспрессия ниже порога определения, плохо прокрашен образец и проч.).</p>
<p>Например, пусть у нас есть три пробы, у которых мы нашли всего 5 пятен.</p>
<table>
<thead>
<tr class="header">
<th align="left">Objects</th>
<th align="right">Spot.1</th>
<th align="right">Spot.2</th>
<th align="right">Spot.3</th>
<th align="right">Spot.4</th>
<th align="right">Spot.5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Object 1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Object 2</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Object 3</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>Чтобы оценить различие между этими пробами, можно посчитать коэффициент Жаккара.</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Object 1</th>
<th align="right">Object 2</th>
<th align="right">Object 3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Object 1</td>
<td align="right">0.00</td>
<td align="right">0.25</td>
<td align="right">0.67</td>
</tr>
<tr class="even">
<td align="left">Object 2</td>
<td align="right">0.25</td>
<td align="right">0.00</td>
<td align="right">0.75</td>
</tr>
<tr class="odd">
<td align="left">Object 3</td>
<td align="right">0.67</td>
<td align="right">0.75</td>
<td align="right">0.00</td>
</tr>
</tbody>
</table>
<p>Точно так же, чтобы оценить различие белков, можно посчитать коэффициент Жаккара между белками.</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Spot 1</th>
<th align="right">Spot 2</th>
<th align="right">Spot 3</th>
<th align="right">Spot 4</th>
<th align="right">Spot 5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Spot 1</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.50</td>
<td align="right">0.33</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Spot 2</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.50</td>
<td align="right">0.33</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Spot 3</td>
<td align="right">0.50</td>
<td align="right">0.50</td>
<td align="right">0.00</td>
<td align="right">0.67</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Spot 4</td>
<td align="right">0.33</td>
<td align="right">0.33</td>
<td align="right">0.67</td>
<td align="right">0.00</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Spot 5</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="--" class="section level1">
<h1>Визуализация многомерных данных</h1>
<ul>
<li>Дендрограммы</li>
<li>Танглграммы</li>
<li>Тепловые карты</li>
<li>Ординация</li>
</ul>
</div>
<div id="-" class="section level1">
<h1>Иерархическая кластеризация</h1>
<p>Существует много методов классификации: методы класстеризации на основании расстояний и методы кластеризации на основании признаков.</p>
<p>В этом курсе мы будем затрагивать только <strong>методы иерархической класстеризации на основании расстояний</strong>.</p>
<p>Классификация данных проходит в несколько этапов. Рзультат кластеризации будет сильнее всего зависеть (1) от выбора коэффициента сходства-различия и (2) от алгоритма кластеризации. Нет формальных способов выбрать наиболее подходящий коэффициент и алгоритм.</p>
<div id="htmlwidget-8cdefc7a931f88f4f3fd" style="width:576px;height:384px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-8cdefc7a931f88f4f3fd">{"x":{"diagram":"digraph symmetry {\n\n  # a \"graph\" statement\n  graph [overlap = TRUE, fontsize = 10, rankdir = TD]\n\n  # several \"node\" statements\n  node [shape = box,\n        fixedsize = false,\n//        width = 0.5,\n        style = filled,\n        color = grey,\n        fillcolor = PowderBlue]\n  A [label=\"Набор признаков\"]\n  B [label=\"Матрица расстояний или сходств\"]\n  C [label=\"Группировка объектов\"]\n  D [label=\"Отношения между кластерами\"]\n  E [label=\"Поправки\"]\n\n  # several \"edge\" statements\n  A->B B->C C->D D->E E->A\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<div id="-----" class="section level2">
<h2>Алгоритмы иерархической кластеризации на основании расстояний</h2>
<p>Мы рассмотрим несколько алгоритмов, которые строят иерархическую кластеризацию объектов на основании матрицы различий между ними:</p>
<ul>
<li>Метод ближайшего соседа</li>
<li>Метод отдаленного соседа</li>
<li>Метод среднегруппового расстояния</li>
</ul>
<p><img src="03_classification_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
</div>
<div id="---nearest-neighbour-single-linkage" class="section level2">
<h2>Метод ближайшего соседа (= nearest neighbour = single linkage)</h2>
<ul>
<li>к кластеру присоединяется ближайший к нему кластер/объект</li>
<li>кластеры объединяются в один на расстоянии, которое равно расстоянию между ближайшими объектами этих кластеров</li>
</ul>
<p><img src="03_classification_files/figure-html/unnamed-chunk-17-1.png" width="432" /></p>
<p>Особенности:</p>
<ul>
<li>Может быть сложно интерпретировать, если нужны группы
<ul>
<li>объекты на дендрограмме часто не образуют четко разделенных групп</li>
<li>часто получаются цепочки кластеров (объекты присоединяются как бы по-одному)</li>
</ul></li>
<li>Хорош для выявления градиентов</li>
</ul>
<p><img src="03_classification_files/figure-html/single-ani-.gif" width="768" /></p>
</div>
<div id="---furthest-neighbour-complete-linkage" class="section level2">
<h2>Метод отдаленного соседа (= furthest neighbour = complete linkage)</h2>
<ul>
<li>к кластеру присоединяется отдаленный кластер/объект</li>
<li>кластеры объединяются в один на расстоянии, которое равно расстоянию между самыми отдаленными объектами этих кластеров (следствие - чем более крупная группа, тем сложнее к ней присоединиться)</li>
</ul>
<p><img src="03_classification_files/figure-html/unnamed-chunk-18-1.png" width="432" /></p>
<p>Особенности:</p>
<ul>
<li>На дендрограмме образуется много отдельных некрупных групп</li>
<li>Хорош для поиска дискретных групп в данных</li>
</ul>
<p><img src="03_classification_files/figure-html/complete-ani-.gif" width="768" /></p>
</div>
<div id="----upgma-unweighted-pair-group-method-with-arithmetic-mean" class="section level2">
<h2>Метод невзвешенного попарного среднего (= UPGMA = Unweighted Pair Group Method with Arithmetic mean)</h2>
<ul>
<li>кластеры объединяются в один на расстоянии, которое равно среднему значению всех возможных расстояний между объектами из разных кластеров.</li>
</ul>
<p><img src="03_classification_files/figure-html/unnamed-chunk-19-1.png" width="432" /></p>
<p>Особенности:</p>
<ul>
<li>UPGMA и WUPGMС иногда могут приводить к инверсиям на дендрограммах</li>
</ul>
<div class="figure">
<img src="images/clust-revert.png" alt="Инверсии на дендрограммах" />
<p class="caption">Инверсии на дендрограммах</p>
</div>
<p><small>из Borcard et al., 2011</small></p>
<p><img src="03_classification_files/figure-html/average-ani-.gif" width="768" /></p>
</div>
<div id="---r-" class="section level2">
<h2>Кластерный анализ в R: гребешки</h2>
<p>Вспомним, на чем мы остановились в прошлый раз.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(readxl)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">library</span>(limma)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co"># Данные об экспрессии</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">pecten &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="dt">path =</span> <span class="st">&quot;data/pecten.xlsx&quot;</span>, <span class="dt">sheet =</span> <span class="st">&quot;exprs&quot;</span>)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">spot_names &lt;-<span class="st"> </span>pecten<span class="op">$</span>Spot</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">pecten &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(pecten[, <span class="dv">-1</span>])</a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="kw">rownames</span>(pecten) &lt;-<span class="st"> </span>spot_names</a>
<a class="sourceLine" id="cb2-9" data-line-number="9"></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co"># Данные о пробах</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11">pecten.fac &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="dt">path =</span> <span class="st">&quot;data/pecten.xlsx&quot;</span>, <span class="dt">sheet =</span> <span class="st">&quot;pheno&quot;</span>)</a>
<a class="sourceLine" id="cb2-12" data-line-number="12">pecten.fac &lt;-<span class="st"> </span><span class="kw">data.frame</span>(pecten.fac)</a>
<a class="sourceLine" id="cb2-13" data-line-number="13">pecten.fac<span class="op">$</span>Condition &lt;-<span class="st"> </span><span class="kw">factor</span>(pecten.fac<span class="op">$</span>Condition)</a>
<a class="sourceLine" id="cb2-14" data-line-number="14"></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co"># Логарифмируем данные</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16">pecten_log &lt;-<span class="st"> </span><span class="kw">log2</span>(pecten)</a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="co"># Квантильная нормализация</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18">pecten_norm &lt;-<span class="st"> </span><span class="kw">normalizeQuantiles</span>(<span class="kw">as.matrix</span>(pecten_log))</a></code></pre></div>
<p>Названия проб в этом файле — длинные непонятные аббревиатуры.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">colnames</span>(pecten_norm)</a></code></pre></div>
<pre><code>##  [1] &quot;Br_23865&quot; &quot;Br_23883&quot; &quot;Br_23884&quot; &quot;Br_23728&quot; &quot;Br_23729&quot; &quot;Br_23730&quot;
##  [7] &quot;Br_23731&quot; &quot;Br_23732&quot; &quot;Br_23733&quot; &quot;Br_23875&quot; &quot;Br_23876&quot; &quot;Br_23877&quot;</code></pre>
<p>Вместо них нужно создать осмысленные и краткие лейблы для проб.</p>
<p>Информацию о лейблах возьмем из датафрейма с факторами</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">head</span>(pecten.fac)</a></code></pre></div>
<pre><code>##     Sample Condition
## 1 Br_23865       15C
## 2 Br_23883       15C
## 3 Br_23884       15C
## 4 Br_23728       15C
## 5 Br_23729       15C
## 6 Br_23730       15C</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">colnames</span>(pecten_norm) &lt;-<span class="st"> </span><span class="kw">make.unique</span>(<span class="kw">as.character</span>(pecten.fac<span class="op">$</span>Condition))</a></code></pre></div>
<p>Чтобы строить деревья для проб, нам понадобится транспонировать исходные данные</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">tpecten_norm &lt;-<span class="st"> </span><span class="kw">t</span>(pecten_norm)</a></code></pre></div>
<p>Давайте построим деревья при помощи нескольких алгоритмов кластеризации (по стандартизованным данным, с использованием Евклидова расстояния) и сравним их. Нам понадобится матрица расстояний.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">d &lt;-<span class="st"> </span><span class="kw">dist</span>(<span class="dt">x =</span> tpecten_norm, <span class="dt">method =</span> <span class="st">&quot;euclidean&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co"># Метод ближайшего соседа</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">hc_single &lt;-<span class="st"> </span><span class="kw">hclust</span>(d, <span class="dt">method =</span> <span class="st">&quot;single&quot;</span>)</a></code></pre></div>
<p>Деревья можно визуализировать при помощи базовой графики, но у нее довольно мало возможностей для настройки внешнего вида.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co"># ?plot.hclust</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw">plot</span>(hc_single)</a></code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>Визуализируем средствами пакета <code>ape</code> <span class="citation">(Paradis and Schliep 2018)</span>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">library</span>(ape)</a></code></pre></div>
<pre><code>## 
## Attaching package: &#39;ape&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:dendextend&#39;:
## 
##     ladderize, rotate</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">ph_single &lt;-<span class="st"> </span><span class="kw">as.phylo</span>(hc_single)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="co"># ?plot.phylo</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="kw">plot</span>(ph_single, <span class="dt">type =</span> <span class="st">&quot;phylogram&quot;</span>, <span class="dt">cex =</span> <span class="fl">0.7</span>)</a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="kw">axisPhylo</span>()</a></code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>Визуализируем средствами <code>dendextend</code> <span class="citation">(Galili 2015)</span>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">library</span>(dendextend)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">den_single &lt;-<span class="st"> </span><span class="kw">as.dendrogram</span>(hc_single)</a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="co"># ?plot.dendrogram</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4">op &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">4</span>), <span class="dt">cex =</span> <span class="fl">0.7</span>)</a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="kw">plot</span>(den_single, <span class="dt">horiz =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>При желании можно раскрасить лейблы. Это можно сделать вручную, просто передав вектор нужных цветов в том порядке, в котором идут лейблы на дендрограмме.</p>
<p>Чтобы не пришлось вручную создавать вектор цветов, можно попробовать при помощи функции вытащить информацию из лейблов на дендрограмме. Эта функция берет дендрограмму, экстрагирует из нее порядок лейблов, берет первые несколько букв в имени лейбла и на основании этого фактора создает вектор цветов.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">library</span>(RColorBrewer)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">get_colours &lt;-<span class="st"> </span><span class="cf">function</span>(dend, n_chars, <span class="dt">palette =</span> <span class="st">&quot;Dark2&quot;</span>){</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">labs &lt;-<span class="st"> </span><span class="kw">get_leaves_attr</span>(dend, <span class="st">&quot;label&quot;</span>)</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">group &lt;-<span class="st"> </span><span class="kw">substr</span>(labs, <span class="dt">start =</span> <span class="dv">0</span>, <span class="dt">stop =</span> n_chars)</a>
<a class="sourceLine" id="cb17-5" data-line-number="5">group &lt;-<span class="st"> </span><span class="kw">factor</span>(group)</a>
<a class="sourceLine" id="cb17-6" data-line-number="6">cols &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(<span class="kw">length</span>(<span class="kw">levels</span>(group)), <span class="dt">name =</span> palette)[group]</a>
<a class="sourceLine" id="cb17-7" data-line-number="7"><span class="kw">return</span>(cols)</a>
<a class="sourceLine" id="cb17-8" data-line-number="8">}</a></code></pre></div>
<p>Теперь можно легко раскрасить группы на дендрограмме, ориентируясь на первые несколько символов в названии лейбла.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">cols &lt;-<span class="st"> </span><span class="kw">get_colours</span>(<span class="dt">dend =</span> den_single, <span class="dt">n_chars =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## Warning in brewer.pal(length(levels(group)), name = palette): minimal value for n is 3, returning requested palette with 3 different levels</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">den_single_c &lt;-<span class="st"> </span><span class="kw">color_labels</span>(<span class="dt">dend =</span> den_single, <span class="dt">col =</span> cols)</a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="kw">plot</span>(den_single_c, <span class="dt">horiz =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<div id="-1" class="section level3">
<h3>Задание 1</h3>
<p>Постройте дендрограммы, описывающие сходство проб, при помощи методов отдаленного соседа и среднегруппового расстояния.</p>
<div id="----r" class="section level4">
<h4>Метод отдаленного соседа в R</h4>
<div class="spoiler">
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="co"># Метод отдаленного соседа</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2">hc_compl &lt;-<span class="st"> </span><span class="kw">hclust</span>(d, <span class="dt">method =</span> <span class="st">&quot;complete&quot;</span>)</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">den_compl &lt;-<span class="st"> </span><span class="kw">as.dendrogram</span>(hc_compl)</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">den_compl_c &lt;-<span class="st"> </span><span class="kw">color_labels</span>(den_compl, <span class="dt">col =</span> <span class="kw">get_colours</span>(den_compl, <span class="dt">n_chars =</span> <span class="dv">2</span>))</a></code></pre></div>
<pre><code>## Warning in brewer.pal(length(levels(group)), name = palette): minimal value for n is 3, returning requested palette with 3 different levels</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw">plot</span>(den_compl_c, <span class="dt">horiz =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
</div>
</div>
<div id="-----r" class="section level4">
<h4>Метод невзвешенного попарного среднего в R</h4>
<div class="spoiler">
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="co"># Метод невзвешенного попарного среднего</span></a>
<a class="sourceLine" id="cb24-2" data-line-number="2">hc_avg &lt;-<span class="st"> </span><span class="kw">hclust</span>(d, <span class="dt">method =</span> <span class="st">&quot;average&quot;</span>)</a>
<a class="sourceLine" id="cb24-3" data-line-number="3">den_avg &lt;-<span class="st"> </span><span class="kw">as.dendrogram</span>(hc_avg)</a>
<a class="sourceLine" id="cb24-4" data-line-number="4">den_avg_c &lt;-<span class="st"> </span><span class="kw">color_labels</span>(den_avg, <span class="dt">col =</span> <span class="kw">get_colours</span>(den_avg, <span class="dt">n_chars =</span> <span class="dv">2</span>))</a></code></pre></div>
<pre><code>## Warning in brewer.pal(length(levels(group)), name = palette): minimal value for n is 3, returning requested palette with 3 different levels</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw">plot</span>(den_avg_c, <span class="dt">horiz =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
</div>
</div>
</div>
</div>
<div id="-" class="section level2">
<h2>Кофенетическая корреляция</h2>
<p>Кофенетическая корреляция — метод оценки соответствия расстояний на дендрограмме расстояниям либо в исходном многомерном пространстве, либо на другой дендрограмме.</p>
<p>Кофенетическое расстояние — расстояние между объектами на дендрограмме. Его можно рассчитать при помощи функции из пакета <code>ape</code>, например.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw">cophenetic</span>(ph_single)</a></code></pre></div>
<pre><code>##            15C    15C.1    15C.2    15C.3   15C.4    15C.5      25C
## 15C    0.00000 21.42511 23.43037 29.97752 31.0542 29.26930 29.26930
## 15C.1 21.42511  0.00000 23.43037 29.97752 31.0542 29.26930 29.26930
## 15C.2 23.43037 23.43037  0.00000 29.97752 31.0542 29.26930 29.26930
## 15C.3 29.97752 29.97752 29.97752  0.00000 31.0542 29.97752 29.97752
## 15C.4 31.05420 31.05420 31.05420 31.05420  0.0000 31.05420 31.05420
## 15C.5 29.26930 29.26930 29.26930 29.97752 31.0542  0.00000 28.79182
## 25C   29.26930 29.26930 29.26930 29.97752 31.0542 28.79182  0.00000
## 25C.1 29.26930 29.26930 29.26930 29.97752 31.0542 26.47686 28.79182
## 25C.2 29.26930 29.26930 29.26930 29.97752 31.0542 26.99377 28.79182
## 25C.3 23.43037 23.43037 21.91978 29.97752 31.0542 29.26930 29.26930
## 25C.4 22.80260 22.80260 23.43037 29.97752 31.0542 29.26930 29.26930
## 25C.5 23.23561 23.23561 23.43037 29.97752 31.0542 29.26930 29.26930
##          25C.1    25C.2    25C.3    25C.4    25C.5
## 15C   29.26930 29.26930 23.43037 22.80260 23.23561
## 15C.1 29.26930 29.26930 23.43037 22.80260 23.23561
## 15C.2 29.26930 29.26930 21.91978 23.43037 23.43037
## 15C.3 29.97752 29.97752 29.97752 29.97752 29.97752
## 15C.4 31.05420 31.05420 31.05420 31.05420 31.05420
## 15C.5 26.47686 26.99377 29.26930 29.26930 29.26930
## 25C   28.79182 28.79182 29.26930 29.26930 29.26930
## 25C.1  0.00000 26.99377 29.26930 29.26930 29.26930
## 25C.2 26.99377  0.00000 29.26930 29.26930 29.26930
## 25C.3 29.26930 29.26930  0.00000 23.43037 23.43037
## 25C.4 29.26930 29.26930 23.43037  0.00000 23.23561
## 25C.5 29.26930 29.26930 23.43037 23.23561  0.00000</code></pre>
<p>Кофенетическую корреляцию можно рассчитать как пирсоновскую корреляцию (обычную) между матрицами исходных и кофенетических расстояний между всеми парами объектов</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw">cor</span>(d, <span class="kw">as.dist</span>(<span class="kw">cophenetic</span>(ph_single)))</a></code></pre></div>
<pre><code>## [1] 0.9426727</code></pre>
<p>Метод, который дает наибольшую кофенетическую корреляцию дает кластеры лучше всего отражающие исходные данные.</p>
<div id="-2" class="section level3">
<h3>Задание 2</h3>
<p>Оцените при помощи кофенетической корреляции качество кластеризаций, полученных разными методами. Какой метод дает лучший результат?</p>
<div class="spoiler">

<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw">cor</span>(d, <span class="kw">as.dist</span>(<span class="kw">cophenetic</span>(<span class="kw">as.phylo</span>(hc_compl))))</a></code></pre></div>
<pre><code>## [1] 0.9324593</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="kw">cor</span>(d, <span class="kw">as.dist</span>(<span class="kw">cophenetic</span>(<span class="kw">as.phylo</span>(hc_avg))))</a></code></pre></div>
<pre><code>## [1] 0.949797</code></pre>
<div/>

</div>
</div>
<div id="--" class="section level2">
<h2>Бутстреп-поддержка ветвей</h2>
<p>Вычисление бутстреп-поддержки ветвей дендрограммы поможет оценить, насколько стабильна полученная кластеризация.</p>
<p>“An approximately unbiased test of phylogenetic tree selection” (Shimodaria, 2002)</p>
<p>Этот тест использует специальный вариант бутстрепа — multiscale bootstrap. Мы не просто многократно берем бутстреп-выборки и оцениваем для них вероятность получения топологий (BP p-value), эти выборки еще и будут с разным числом объектов. По изменению BP при разных объемах выборки можно вычислить AU (approximately unbiased p-value).</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="kw">library</span>(pvclust)</a></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="co"># итераций должно быть 10000 и больше, здесь мало для скорости</span></a>
<a class="sourceLine" id="cb36-2" data-line-number="2">cl_boot &lt;-<span class="st"> </span><span class="kw">pvclust</span>(pecten_norm, <span class="dt">method.hclust =</span> <span class="st">&quot;average&quot;</span>, <span class="dt">nboot =</span> <span class="dv">100</span>, </a>
<a class="sourceLine" id="cb36-3" data-line-number="3">                   <span class="dt">method.dist =</span> <span class="st">&quot;euclidean&quot;</span>, <span class="dt">iseed =</span> <span class="dv">278456</span>)</a></code></pre></div>
<pre><code>## Bootstrap (r = 0.5)... Done.
## Bootstrap (r = 0.6)... Done.
## Bootstrap (r = 0.7)... Done.
## Bootstrap (r = 0.8)... Done.
## Bootstrap (r = 0.9)... Done.
## Bootstrap (r = 1.0)... Done.
## Bootstrap (r = 1.1)... Done.
## Bootstrap (r = 1.2)... Done.
## Bootstrap (r = 1.3)... Done.
## Bootstrap (r = 1.4)... Done.</code></pre>
<p>Дерево с величинами поддержки</p>
<p>AU — approximately unbiased p-values (красный), BP — bootstrap p-values (зеленый)</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1"><span class="kw">plot</span>(cl_boot)</a></code></pre></div>
<p><img src="03_classification_files/figure-html/pvclust-tree-1.png" width="960" /></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="co"># pvrect(cl_boot) # достоверные ветвления</span></a></code></pre></div>
<p>Если для кластера AU p-value &gt; 0.95, то нулевую гипотезу о том, что он не существует отвергают на уровне значимости 0.05.</p>
<p>Но сами AU p-values оцениваются при помощи бутстрепа, а значит, тоже не точно. Стандартные ошибки можно оценить чтобы оценить точность оценки самих AU. Для диагностики качества оценок AU нам понадобится график стандартных ошибок для AU p-value. Чем больше было бутстреп-итераций, тем точнее будет оценка.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1"><span class="kw">seplot</span>(cl_boot)</a>
<a class="sourceLine" id="cb40-2" data-line-number="2"><span class="kw">seplot</span>(cl_boot, <span class="dt">identify =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<pre><code>## integer(0)</code></pre>
<p>Например, для кластера 8 <span class="math inline">\(AU =\)</span> 0.9234669, а ее стандартная ошибка <span class="math inline">\(SE =\)</span> 0.0375665. Границы 95% доверительного индервала к AU p-value: 0.8498366 и 0.9970972. Такая оценка значимости не точна.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1"><span class="kw">print</span>(cl_boot)</a></code></pre></div>
<pre><code>## 
## Cluster method: average
## Distance      : euclidean
## 
## Estimates on edges:
## 
##       au    bp se.au se.bp      v     c  pchi
## 1  0.948 0.902 0.034 0.010 -1.463 0.167 0.653
## 2  0.986 0.947 0.013 0.008 -1.906 0.293 0.862
## 3  0.696 0.387 0.087 0.016 -0.113 0.401 0.002
## 4  0.729 0.392 0.083 0.016 -0.168 0.442 0.004
## 5  1.000 1.000 0.000 0.000  0.000 0.000 0.000
## 6  0.722 0.622 0.083 0.016 -0.451 0.139 0.375
## 7  0.940 0.919 0.041 0.010 -1.478 0.077 0.351
## 8  0.923 0.730 0.038 0.015 -1.021 0.408 0.601
## 9  0.653 0.484 0.090 0.016 -0.176 0.217 0.571
## 10 0.710 0.356 0.087 0.016 -0.092 0.461 0.364
## 11 1.000 1.000 0.000 0.000  0.000 0.000 0.000</code></pre>
<div id="-3" class="section level3">
<h3>Задание 3</h3>
<p>Повторите бутстреп с 1000 итераций. Чему теперь будет равна стандартная ошибка AU p-value для 8 кластера. Используйте тот же сид, что в прошлом примере.</p>
<div>
<div class="spoiler">

<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1">cl_boot &lt;-<span class="st"> </span><span class="kw">pvclust</span>(pecten_norm, <span class="dt">method.hclust =</span> <span class="st">&quot;average&quot;</span>, <span class="dt">nboot =</span> <span class="dv">1000</span>, </a>
<a class="sourceLine" id="cb44-2" data-line-number="2">                   <span class="dt">method.dist =</span> <span class="st">&quot;euclidean&quot;</span>, <span class="dt">iseed =</span> <span class="dv">278456</span>, <span class="dt">quiet =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1"><span class="kw">print</span>(cl_boot)</a></code></pre></div>
<pre><code>## 
## Cluster method: average
## Distance      : euclidean
## 
## Estimates on edges:
## 
##       au    bp se.au se.bp      v     c  pchi
## 1  0.975 0.905 0.006 0.003 -1.634 0.321 0.261
## 2  0.973 0.929 0.007 0.003 -1.701 0.233 0.601
## 3  0.747 0.409 0.025 0.005 -0.219 0.448 0.744
## 4  0.605 0.401 0.030 0.005 -0.008 0.259 0.787
## 5  1.000 1.000 0.000 0.000  0.000 0.000 0.000
## 6  0.748 0.616 0.025 0.005 -0.482 0.187 0.564
## 7  0.963 0.928 0.009 0.003 -1.624 0.163 0.278
## 8  0.875 0.715 0.017 0.005 -0.860 0.291 0.634
## 9  0.783 0.491 0.023 0.005 -0.380 0.401 0.944
## 10 0.729 0.344 0.027 0.005 -0.104 0.505 0.253
## 11 1.000 1.000 0.000 0.000  0.000 0.000 0.000</code></pre>
<div/>
<div/>

</div>
</div>
</div>
<div class="section level1">
<h1>Танглграмма</h1>
<p>Два дерева (с непохожим ветвлением) выравнивают, вращая случайным образом ветви вокруг оснований. Итеративный алгоритм. Картина каждый раз может получиться немного разная, особенно в сложных случаях.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">395</span>)</a>
<a class="sourceLine" id="cb47-2" data-line-number="2">untang_w &lt;-<span class="st"> </span><span class="kw">untangle_step_rotate_2side</span>(den_single, den_avg, <span class="dt">print_times =</span> F)</a>
<a class="sourceLine" id="cb47-3" data-line-number="3"><span class="co"># танглграмма</span></a>
<a class="sourceLine" id="cb47-4" data-line-number="4"><span class="kw">tanglegram</span>(untang_w[[<span class="dv">1</span>]], untang_w[[<span class="dv">2</span>]],</a>
<a class="sourceLine" id="cb47-5" data-line-number="5">           <span class="dt">highlight_distinct_edges =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb47-6" data-line-number="6">           <span class="dt">common_subtrees_color_lines =</span> F,</a>
<a class="sourceLine" id="cb47-7" data-line-number="7">           <span class="dt">main =</span> <span class="st">&quot;Tanglegram&quot;</span>,</a>
<a class="sourceLine" id="cb47-8" data-line-number="8">           <span class="dt">main_left =</span> <span class="st">&quot;Single linkage&quot;</span>,</a>
<a class="sourceLine" id="cb47-9" data-line-number="9">           <span class="dt">main_right =</span> <span class="st">&quot;UPGMA&quot;</span>,</a>
<a class="sourceLine" id="cb47-10" data-line-number="10">           <span class="dt">columns_width =</span> <span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">1</span>, <span class="dv">8</span>),</a>
<a class="sourceLine" id="cb47-11" data-line-number="11">           <span class="dt">margin_top =</span> <span class="fl">3.2</span>, <span class="dt">margin_bottom =</span> <span class="fl">2.5</span>,</a>
<a class="sourceLine" id="cb47-12" data-line-number="12">           <span class="dt">margin_inner =</span> <span class="dv">4</span>, <span class="dt">margin_outer =</span> <span class="fl">0.5</span>,</a>
<a class="sourceLine" id="cb47-13" data-line-number="13">           <span class="dt">lwd =</span> <span class="fl">1.2</span>, <span class="dt">edge.lwd =</span> <span class="fl">1.2</span>,</a>
<a class="sourceLine" id="cb47-14" data-line-number="14">           <span class="dt">lab.cex =</span> <span class="dv">1</span>, <span class="dt">cex_main =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="03_classification_files/figure-html/tang-1.png" width="672" /></p>
</div>
<div id="-" class="section level1">
<h1>Тепловая карта</h1>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1"><span class="kw">library</span>(gplots) <span class="co"># для тепловых карт</span></a>
<a class="sourceLine" id="cb48-2" data-line-number="2"></a>
<a class="sourceLine" id="cb48-3" data-line-number="3"><span class="co"># Палитры для тепловых карт</span></a>
<a class="sourceLine" id="cb48-4" data-line-number="4">pal_green &lt;-<span class="st"> </span><span class="kw">colorpanel</span>(<span class="dv">75</span>, <span class="dt">low =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">mid =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;yellow&quot;</span>)</a>
<a class="sourceLine" id="cb48-5" data-line-number="5"><span class="co"># library(spatstat) # to convert palette to grayscale</span></a>
<a class="sourceLine" id="cb48-6" data-line-number="6"><span class="co"># pal_gray &lt;- to.grey(pal_green, weights=c(1,1,1))</span></a></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1">dat &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(pecten_norm)</a>
<a class="sourceLine" id="cb49-2" data-line-number="2"><span class="kw">heatmap.2</span>(dat, <span class="dt">col =</span> pal_green, <span class="dt">scale =</span> <span class="st">&quot;none&quot;</span>, </a>
<a class="sourceLine" id="cb49-3" data-line-number="3">          <span class="dt">key =</span> <span class="ot">TRUE</span>, <span class="dt">symkey =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb49-4" data-line-number="4">          <span class="dt">density.info =</span> <span class="st">&quot;none&quot;</span>, <span class="dt">trace =</span> <span class="st">&quot;none&quot;</span>, </a>
<a class="sourceLine" id="cb49-5" data-line-number="5">          <span class="dt">cexRow =</span> <span class="dv">1</span>, <span class="dt">cexCol =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb49-6" data-line-number="6">          <span class="dt">keysize =</span> <span class="dv">1</span>, <span class="dt">margins =</span> <span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">5</span>))</a></code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1"><span class="co"># Настройка внешнего вида</span></a>
<a class="sourceLine" id="cb50-2" data-line-number="2"><span class="kw">heatmap.2</span>(dat, <span class="dt">col =</span> pal_green, <span class="dt">scale =</span> <span class="st">&quot;none&quot;</span>, </a>
<a class="sourceLine" id="cb50-3" data-line-number="3">          <span class="dt">key =</span> <span class="ot">TRUE</span>, <span class="dt">symkey =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb50-4" data-line-number="4">          <span class="dt">density.info =</span> <span class="st">&quot;none&quot;</span>, <span class="dt">trace =</span> <span class="st">&quot;none&quot;</span>, </a>
<a class="sourceLine" id="cb50-5" data-line-number="5">          <span class="dt">cexRow =</span> <span class="dv">1</span>, <span class="dt">cexCol =</span> <span class="dv">1</span>, <span class="dt">keysize =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb50-6" data-line-number="6">          <span class="dt">margins =</span> <span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">5</span>), </a>
<a class="sourceLine" id="cb50-7" data-line-number="7">          <span class="dt">key.par =</span> <span class="kw">list</span>(<span class="dt">mgp =</span> <span class="kw">c</span>(<span class="fl">1.5</span>, <span class="fl">0.9</span>, <span class="dv">0</span>), </a>
<a class="sourceLine" id="cb50-8" data-line-number="8">                         <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="fl">0.1</span>), <span class="dt">cex =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb50-9" data-line-number="9">          <span class="dt">key.title =</span> <span class="ot">NA</span>, <span class="dt">key.xlab =</span> <span class="ot">NA</span>)</a></code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-41-2.png" width="672" /></p>
<p>Еще один вариант</p>
<pre><code>## Loading required package: pkgmaker</code></pre>
<pre><code>## Loading required package: registry</code></pre>
<pre><code>## 
## Attaching package: &#39;pkgmaker&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     isFALSE</code></pre>
<pre><code>## Loading required package: rngtools</code></pre>
<pre><code>## Loading required package: cluster</code></pre>
<pre><code>## NMF - BioConductor layer [OK] | Shared memory capabilities [NO: bigmemory] | Cores 3/4</code></pre>
<pre><code>##   To enable shared memory capabilities, try: install.extras(&#39;
## NMF
## &#39;)</code></pre>
<pre><code>## 
## Attaching package: &#39;NMF&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:ape&#39;:
## 
##     consensus</code></pre>
<p><img src="03_classification_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
</div>
<div class="section level1">
<h1>Ординация</h1>
<p>Из множества методов ординации здесь мы рассмотрим только неметрическое многомерное шкалирование.</p>
<div id="--" class="section level2">
<h2>Неметрическое многомерное шкалирование</h2>
<p>Неметрическое многомерное шкалирование (Nonmetric Multidimensional Scaling, nMDS) — метод визуализации отношений между объектами в пространстве с небольшим числом измерений (обычно 2).</p>
<p>Исходные данные для nMDS — матрица расстояний между объектами в многомерном пространстве.</p>
</div>
<div id="------" class="section level2">
<h2>Расстояния по автодорогам между пригородами Санкт-Петербурга</h2>
<pre><code>##               name Всеволожск Гатчина Зеленогорск Красное Село Кронштадт
## 1       Всеволожск          0      71          71           64        70
## 2          Гатчина         71       0          97           20        76
## 3      Зеленогорск         71      97           0           81        52
## 4     Красное Село         64      20          81            0        56
## 5        Кронштадт         70      76          52           56         0
## 6         Павловск         57      30          87           24        75
## 7        Парголово         31      70          44           53        42
## 8         Петергоф         73      47          77           28        37
## 9           Пушкин         52      29          82           21        70
## 10 Санкт-Петербург         24      47          53           31        51
## 11       Сертолово         37      79          33           62        45
## 12      Сестрорецк         56      82          25           65        28
## 13        Стрельна         64      38          80           19        52
## 14    Шлиссельбург         40      80         106           70       105
##    Павловск Парголово Петергоф Пушкин Санкт-Петербург Сертолово Сестрорецк
## 1        57        31       73     52              24        37         56
## 2        30        70       47     29              47        79         82
## 3        87        44       77     82              53        33         25
## 4        24        53       28     21              31        62         65
## 5        75        42       37     70              51        45         28
## 6         0        63       43      5              35        66         70
## 7        63         0       68     59              18         9         29
## 8        43        68        0     37              41        72         55
## 9         5        59       37      0              30        61         64
## 10       35        18       41     30               0        35         39
## 11       66         9       72     61              35         0         22
## 12       70        29       55     64              39        22          0
## 13       34        54       10     28              31        64         66
## 14       64        66       81     58              49        74         93
##    Стрельна Шлиссельбург
## 1        64           40
## 2        38           80
## 3        80          106
## 4        19           70
## 5        52          105
## 6        34           64
## 7        54           66
## 8        10           81
## 9        28           58
## 10       31           49
## 11       64           74
## 12       66           93
## 13        0           72
## 14       72            0</code></pre>
<p>Расстояния по автородогам не совсем “евклидовы”: например, из Кронштадта до Санкт-Петербурга нельзя добраться по прямой.</p>
<p><img src="03_classification_files/figure-html/gg-spb-1.png" width="672" /></p>
<p>При помощи nMDS ординации можно восстановить карту, сохраняя ранги расстояний между объектами.</p>
<pre><code>## species scores not available</code></pre>
<p><img src="03_classification_files/figure-html/ord-spb-1.png" width="480" /></p>
<p>Что странного в этой карте?</p>
</div>
<div id="--nmds" class="section level2">
<h2>Важные свойства nMDS</h2>
<ol style="list-style-type: decimal">
<li><p>Ординация <strong>сохраняет ранг расстояний между объектами</strong> (похожие располагаются близко, непохожие — далеко; если объект А похож на B, больше чем на C, то и на ординации он, скорее всего, окажется ближе к B, чем к C).</p></li>
<li><p>На ординации имеет смысл только взаиморасположение объектов. Облако точек в осях MDS можно вращать, перемещать, зеркально отражать. Суть ординации от этого не изменится.</p></li>
<li><p>Значения координат точек в ординации лишены смысла (их вообще можно не приводить на итоговой ординации).</p></li>
</ol>
</div>
<div id="--nmds" class="section level2">
<h2>Как работает nMDS</h2>
<p>nMDS старается сохранить отношения между объектами. Взаиморасположение точек на плоскости ординации подобно взаиморасположению точек исходном многомерном пространстве признаков, но значения не полностью совпадают. У хорошей ординации nMDS ранги расстояний должны совпадать с рангами коэффициентов различия в исходном многомерном пространстве. Это значит, что в идеале, бOльшим расстояниям в исходном пространстве должны соответствовать бOльшие расстояния на ординации, а меньшим — меньшие (т.е. должны сохраняться ранги расстояний).</p>
<p><strong>Стресс (Stress)</strong> — мера качества ординации. Он показывает, насколько соответствуют друг другу взаиморасположение точек на плоскости ординации и в исходном многомерном пространстве признаков.</p>
<p><span class="math display">\[ Stress(1) = \sqrt{\frac{\sum_{h &lt; i}{(d_{h,i} - \hat d_{h,i})^2}}{\sum_{h &lt; i}{d_{{h,i}}^2}}}\]</span></p>
<ul>
<li><span class="math inline">\(d\)</span> — наблюдаемое значение коэффициента различия между двумя точками</li>
<li><span class="math inline">\(\hat d\)</span> — значение, предсказанное монотонной регрессией</li>
</ul>
<p>Хорошо, когда <span class="math inline">\(Stress(1) &lt; 0.2\)</span>.</p>
</div>
<div id="-mds---" class="section level2">
<h2>Алгоритм MDS (для двумерного случая)</h2>
<p><img src="images/ezhik.jpg" alt="Ежик в тумане" width=460px></p>
<!-- Марка СССР Ёжик в тумане (1988, ЦФА №5919). [Википедия](https://ru.wikipedia.org/wiki/%D0%A4%D0%B0%D0%B9%D0%BB:1988_CPA_5919.jpg) -->
<ol style="list-style-type: decimal">
<li>Вычисляем матрицу коэффициентов различия между объектами.</li>
<li>Распределеяем объекты на плоскости в случайном порядке (или при помощи PCoA).</li>
<li>Вычисляем стресс.</li>
<li>Сдвигаем точки по плоскости так, чтобы минимизировать стресс.</li>
<li>Повторяем шаги 2-4 несколько раз, чтобы избежать локальных минимумов стресса.</li>
<li>Обычно финальную ординацию поворачивают, чтобы вдоль оси X было максимальное варьирование.</li>
</ol>
</div>
<div id="-nmds" class="section level2">
<h2>Ограничения nMDS</h2>
<ul>
<li>nMDS — метод визуализации данных.</li>
<li>Коэффициент различия и трансформация данных должны быть выбраны исходя из того, какие именно свойства объектов должны быть визуализированы.</li>
<li>Число измерений, выбранное для решения, может влиять на результат.</li>
</ul>
</div>
<div id="nmds---r-" class="section level2">
<h2>nMDS ординация в R: гребешки</h2>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" data-line-number="1"><span class="kw">library</span>(vegan)</a>
<a class="sourceLine" id="cb63-2" data-line-number="2">pecten_ord &lt;-<span class="st"> </span><span class="kw">metaMDS</span>(tpecten_norm, </a>
<a class="sourceLine" id="cb63-3" data-line-number="3">                      <span class="dt">distance =</span> <span class="st">&quot;euclidean&quot;</span>, </a>
<a class="sourceLine" id="cb63-4" data-line-number="4">                      <span class="dt">autotransform =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## Run 0 stress 0.08158633 
## Run 1 stress 0.09081754 
## Run 2 stress 0.09823191 
## Run 3 stress 0.09078469 
## Run 4 stress 0.09823044 
## Run 5 stress 0.0907842 
## Run 6 stress 0.0982319 
## Run 7 stress 0.08167712 
## ... Procrustes: rmse 0.01241113  max resid 0.03183732 
## Run 8 stress 0.09823017 
## Run 9 stress 0.09823196 
## Run 10 stress 0.08179005 
## ... Procrustes: rmse 0.01500334  max resid 0.0350661 
## Run 11 stress 0.08239204 
## Run 12 stress 0.08178756 
## ... Procrustes: rmse 0.01457973  max resid 0.03347871 
## Run 13 stress 0.08171813 
## ... Procrustes: rmse 0.01091991  max resid 0.02944923 
## Run 14 stress 0.09081806 
## Run 15 stress 0.0821181 
## Run 16 stress 0.09083667 
## Run 17 stress 0.09080886 
## Run 18 stress 0.08158649 
## ... Procrustes: rmse 6.669593e-05  max resid 0.0001532853 
## ... Similar to previous best
## Run 19 stress 0.0982303 
## Run 20 stress 0.08158633 
## ... Procrustes: rmse 2.173075e-05  max resid 3.966025e-05 
## ... Similar to previous best
## *** Solution reached</code></pre>
<p>Простейший график ординации проб:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" data-line-number="1"><span class="kw">ordiplot</span>(pecten_ord, <span class="dt">type =</span> <span class="st">&quot;t&quot;</span>, <span class="dt">display =</span> <span class="st">&quot;sites&quot;</span>)</a></code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
<p>Хорошая ли получилась ординация, можно узнать по величине стресса:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1">pecten_ord<span class="op">$</span>stress</a></code></pre></div>
<pre><code>## [1] 0.08158633</code></pre>
<p>Давайте теперь раскрасим график ординаци.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" data-line-number="1"><span class="co"># Палитры</span></a>
<a class="sourceLine" id="cb68-2" data-line-number="2">pal_col &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;steelblue&quot;</span>, <span class="st">&quot;orangered&quot;</span>)</a>
<a class="sourceLine" id="cb68-3" data-line-number="3">pal_sh &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">17</span>, <span class="dv">19</span>)</a>
<a class="sourceLine" id="cb68-4" data-line-number="4"></a>
<a class="sourceLine" id="cb68-5" data-line-number="5"><span class="co"># Украшенный график nMDS ординации</span></a>
<a class="sourceLine" id="cb68-6" data-line-number="6"><span class="kw">ordiplot</span>(pecten_ord, <span class="dt">type =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">display =</span> <span class="st">&quot;sites&quot;</span>)</a>
<a class="sourceLine" id="cb68-7" data-line-number="7"><span class="kw">points</span>(pecten_ord, </a>
<a class="sourceLine" id="cb68-8" data-line-number="8">       <span class="dt">col =</span> pal_col[pecten.fac<span class="op">$</span>Condition], </a>
<a class="sourceLine" id="cb68-9" data-line-number="9">       <span class="dt">pch =</span> pal_sh[pecten.fac<span class="op">$</span>Condition])</a>
<a class="sourceLine" id="cb68-10" data-line-number="10"><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, </a>
<a class="sourceLine" id="cb68-11" data-line-number="11">       <span class="kw">levels</span>(pecten.fac<span class="op">$</span>Condition),</a>
<a class="sourceLine" id="cb68-12" data-line-number="12">       <span class="dt">col =</span> pal_col, </a>
<a class="sourceLine" id="cb68-13" data-line-number="13">       <span class="dt">pch =</span> pal_sh, </a>
<a class="sourceLine" id="cb68-14" data-line-number="14">       <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>, </a>
<a class="sourceLine" id="cb68-15" data-line-number="15">       <span class="dt">xpd =</span> T)</a></code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" data-line-number="1"><span class="co"># График nMDS ординации, где обведено облако проб одной категории</span></a>
<a class="sourceLine" id="cb69-2" data-line-number="2"><span class="kw">ordiplot</span>(pecten_ord, <span class="dt">type =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">display =</span> <span class="st">&quot;sites&quot;</span>)</a>
<a class="sourceLine" id="cb69-3" data-line-number="3"><span class="kw">points</span>(pecten_ord, </a>
<a class="sourceLine" id="cb69-4" data-line-number="4">       <span class="dt">col =</span> pal_col[pecten.fac<span class="op">$</span>Condition], </a>
<a class="sourceLine" id="cb69-5" data-line-number="5">       <span class="dt">pch =</span> pal_sh[pecten.fac<span class="op">$</span>Condition])</a>
<a class="sourceLine" id="cb69-6" data-line-number="6"><span class="kw">ordihull</span>(pecten_ord, <span class="dt">groups =</span> pecten.fac<span class="op">$</span>Condition, <span class="dt">col =</span> pal_col, <span class="dt">label =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-47-2.png" width="672" /></p>
<p>Можно сопоставить результаты ординации и классификации. Видно, что дендрограмма лишь очень условно отображает исходное многомерное пространство.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" data-line-number="1"><span class="co"># График nMDS ординации с наложенной дендрограммой</span></a>
<a class="sourceLine" id="cb70-2" data-line-number="2"><span class="kw">ordiplot</span>(pecten_ord, <span class="dt">type =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">display =</span> <span class="st">&quot;sites&quot;</span>)</a>
<a class="sourceLine" id="cb70-3" data-line-number="3"><span class="kw">points</span>(pecten_ord, </a>
<a class="sourceLine" id="cb70-4" data-line-number="4">       <span class="dt">col =</span> pal_col[pecten.fac<span class="op">$</span>Condition], </a>
<a class="sourceLine" id="cb70-5" data-line-number="5">       <span class="dt">pch =</span> pal_sh[pecten.fac<span class="op">$</span>Condition])</a>
<a class="sourceLine" id="cb70-6" data-line-number="6"><span class="kw">ordicluster</span>(pecten_ord, <span class="dt">cluster =</span> hc_avg)</a>
<a class="sourceLine" id="cb70-7" data-line-number="7"><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, </a>
<a class="sourceLine" id="cb70-8" data-line-number="8">       <span class="kw">levels</span>(pecten.fac<span class="op">$</span>Condition),</a>
<a class="sourceLine" id="cb70-9" data-line-number="9">       <span class="dt">col =</span> pal_col, </a>
<a class="sourceLine" id="cb70-10" data-line-number="10">       <span class="dt">pch =</span> pal_sh, </a>
<a class="sourceLine" id="cb70-11" data-line-number="11">       <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>, </a>
<a class="sourceLine" id="cb70-12" data-line-number="12">       <span class="dt">xpd =</span> T)</a></code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
</div>
</div>
<div id="---" class="section level1">
<h1>Задание для самостоятельной работы</h1>
<p>Для выполнения этого задания вы можете использовать либо свои собственные данные, либо (уже логарифмированные) данные о протеоме сыворотки крови пациентов, страдающих разной степенью гиперплазии предстательной железы, из пакета <code>digeR</code> <span class="citation">(Fan et al. 2009)</span>: - <a href="data/prostate.xlsx">prostate.xlsx</a> - <a href="data/prostate.zip">prostate.zip</a></p>
<p>В качестве исходных данных используйте матрицу евклидовых расстояний между пробами.</p>
<ul>
<li><p>Постройте дендрограмму. Используйте алгоритм кластеризации, который лучше всего отражает матрицу исходных расстояний на дендрограмме)</p></li>
<li><p>Постройте танглграмму из двух дендрограмм, полученных методом ближайшего соседа и методом невзвешенного попарного среднего.</p></li>
<li><p>Постройте тепловую карту.</p></li>
<li><p>Постройте ординацию методом nMDS.</p></li>
</ul>
<p>На ваш взгляд, для каких целей лучше всего подходит каждый из использованных методов визуализации?</p>
</div>
<div class="section level1 unnumbered">
<h1>Ссылки</h1>
<div id="refs" class="references">
<div id="ref-Artigaud_2013">
<p>Artigaud, S., O. Gauthier, and V. Pichereau. 2013. Identifying differentially expressed proteins in two-dimensional electrophoresis experiments: Inputs from transcriptomics statistical tools. Bioinformatics 29:2729–2734.</p>
</div>
<div id="ref-fan2009diger">
<p>Fan, Y., T. B. Murphy, and R. W. G. Watson. 2009. DigeR: A graphical user interface r package for analyzing 2D-dige data. Bioinformatics 25:3033–3034.</p>
</div>
<div id="ref-Galili_2015">
<p>Galili, T. 2015. Dendextend: An r package for visualizing, adjusting, and comparing trees of hierarchical clustering. Bioinformatics.</p>
</div>
<div id="ref-Paradis_2018">
<p>Paradis, E., and K. Schliep. 2018. Ape 5.0: An environment for modern phylogenetics and evolutionary analyses in R. Bioinformatics xx:xxx–xxx.</p>
</div>
<div id="ref-R_Core_Team_2018">
<p>R Core Team. 2018. R: A language and environment for statistical computing. R Foundation for Statistical Computing, Vienna, Austria.</p>
</div>
</div>
</div>

<p><small>
(C) 2019 Marina Varfolomeeva, Arina Maltseva
</small></p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
