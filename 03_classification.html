<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Марина Варфоломеева" />


<title>Классификация пептидов и проб</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<script src="libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="libs/tocify-1.9.1/jquery.tocify.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/htmlwidgets-0.6/htmlwidgets.js"></script>
<script src="libs/viz-0.3/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-0.8.2/grViz.js"></script>

<style type="text/css">

/* don't use link color in navbar */
.dropdown-menu>li>a {
  color: black;
}

/* some padding for disqus */
#disqus_thread {
  margin-top: 45px;
}

</style>

<link rel="stylesheet" href="libs/font-awesome-4.1.0/css/font-awesome.min.css"/>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #0000ff; } /* Keyword */
code > span.ch { color: #008080; } /* Char */
code > span.st { color: #008080; } /* String */
code > span.co { color: #008000; } /* Comment */
code > span.ot { color: #ff4000; } /* Other */
code > span.al { color: #ff0000; } /* Alert */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #008000; font-weight: bold; } /* Warning */
code > span.cn { } /* Constant */
code > span.sc { color: #008080; } /* SpecialChar */
code > span.vs { color: #008080; } /* VerbatimString */
code > span.ss { color: #008080; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { } /* Variable */
code > span.cf { color: #0000ff; } /* ControlFlow */
code > span.op { } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #ff4000; } /* Preprocessor */
code > span.do { color: #008000; } /* Documentation */
code > span.an { color: #008000; } /* Annotation */
code > span.cv { color: #008000; } /* CommentVar */
code > span.at { } /* Attribute */
code > span.in { color: #008000; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>

<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="libs/navigation-1.0/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {
    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: "h1.title, .toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.9em;
  padding-left: 5px;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
  padding-left: 10px;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/proteomics-course/">Proteomics course</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li><a href="index.html">Начало</a></li>
        <li class="dropdown">
          <a href="lecture-notes" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Конспект<span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
<!--             <li class="dropdown-header">Начало работы</li>
--->
             <li><a href="00_introduction.html">О модуле Анализ протеомных данных</a></li>
             <li class="divider"></li>
             <li><a href="01_introduction_to_r.html">Знакомство с R</a></li>
             <li><a href="02_data_preprocessing.html">Предварительная обработка данных</a></li>
             <li><a href="03_classification.html">Классификация</a></li>
             <li><a href="04_differential_expression_analysis.html">Выявление дифференциально-экспрессируемых пептидов</a></li>
<!--
             <li><a href="05_multivariate_methods_pca.html">Многомерные методы (PCA)</a></li>
--->
<!--             <li><a href="06_multivariate_methods_pls-da.html">Многомерные методы (PLS-DA)</a></li>
-->
            <li class="divider"></li>
            <li><a href="protocol.html">Протокол анализа данных</a></li>
          </ul>
        </li>
        <li><a href="resources.html">Ссылки и ресурсы</a></li>
        <li><a href="coding_practices.html">Правила хорошего кода</a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">


<h1 class="title">Классификация пептидов и проб</h1>
<h4 class="author"><em>Марина Варфоломеева</em></h4>

</div>


<hr />
<p>В этом разделе мы поговорим о том, как делать кластерный анализ и строить тепловые карты экспрессии в R <span class="citation">(R Core Team 2016)</span>.</p>
<ul>
<li><a href="https://raw.githubusercontent.com/varmara/proteomics-course/gh-pages/03_classification.R">Код к этому занятию</a></li>
<li>Данные <span class="citation">(Artigaud et al. 2015)</span>:
<ul>
<li><a href="https://raw.githubusercontent.com/varmara/proteomics-course/gh-pages/data/Prot_Br_H_T.csv">Prot_Br_H_T.csv</a></li>
<li><a href="https://raw.githubusercontent.com/varmara/proteomics-course/gh-pages/data/Prot_Br_H_T_factor.csv">Prot_Br_H_T_factor.csv</a></li>
</ul></li>
<li>Пакеты (инсталлируйте при необходимости)</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Из репозитория CRAN</span>
<span class="kw">install.packages</span>(<span class="kw">c</span>(<span class="st">&quot;dendextend&quot;</span>, <span class="st">&quot;ape&quot;</span>, <span class="st">&quot;fpc&quot;</span>, <span class="st">&quot;pvclust&quot;</span>, <span class="st">&quot;gplots&quot;</span>, <span class="st">&quot;NMF&quot;</span>), <span class="dt">dependencies =</span> <span class="ot">TRUE</span>)</code></pre></div>
<hr />
<div id="--" class="section level1">
<h1>Методы построения деревьев</h1>
<p>Существует много методов классификации. Их можно разделить на две основные группы (хотя есть много других вариантов деления):</p>
<p><strong>Методы класстеризации на основании расстояний:</strong></p>
<ul>
<li>Метод ближайшего соседа</li>
<li>Метод отдаленного соседа</li>
<li>Метод среднегруппового расстояния</li>
<li>Метод Варда</li>
<li>и т.д. и т.п.</li>
</ul>
<p><strong>Методы кластеризации на основании признаков:</strong></p>
<ul>
<li>Метод максимальной бережливости</li>
<li>Метод максимального правдоподобия</li>
</ul>
<p>В этом курсе мы будем затрагивать только методы иерархической класстеризации на основании расстояний.</p>
<p>Классификация данных проходит в несколько этапов. Рзультат кластеризации будет сильнее всего зависеть (1) от выбора коэффициента сходства-различия и (2) от алгоритма кластеризации. Нет формальных способов выбрать наиболее подходящий коэффициент и алгоритм.</p>
<p><div id="htmlwidget-3078" style="width:576px;height:384px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-3078">{"x":{"diagram":"digraph symmetry {\n\n  # a \"graph\" statement\n  graph [overlap = TRUE, fontsize = 10, rankdir = TD]\n\n  # several \"node\" statements\n  node [shape = box,\n        fixedsize = false,\n//        width = 0.5,\n        style = filled,\n        color = grey,\n        fillcolor = PowderBlue]\n  A [label=\"Набор признаков\"]\n  B [label=\"Матрица расстояний или сходств\"]\n  C [label=\"Группировка объектов\"]\n  D [label=\"Отношения между кластерами\"]\n  E [label=\"Поправки\"]\n\n  # several \"edge\" statements\n  A->B B->C C->D D->E E->A\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script></p>
</div>
<div id="--" class="section level1">
<h1>Коэффициенты сходства-различия</h1>
<p>Различия</p>
<p><span class="math inline"><em>d</em> ≥ 0</span> <div id="htmlwidget-2577" style="width:432px;height:48px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-2577">{"x":{"diagram":"digraph symmetry {\n\n  # a \"graph\" statement\n  graph [overlap = false, fontsize = 10, rankdir = LR]\n\n  # several \"node\" statements\n  node [shape = circle,\n        fixedsize = true,\n        width = 0.5,\n        style = filled,\n        color = grey]\n  node [fillcolor = PowderBlue]\n  A; B\n\n  # several \"edge\" statements\n  A->B [dir = \"both\"]\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script></p>
<p>Сходства</p>
<p><span class="math inline">0 ≤ <em>S</em> ≤ 1</span> или <span class="math inline">−1 ≤ <em>S</em> ≤ 1</span></p>
<p><div id="htmlwidget-5523" style="width:432px;height:48px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-5523">{"x":{"diagram":"digraph symmetry {\n\n  # a \"graph\" statement\n  graph [overlap = false, fontsize = 10, rankdir = LR]\n\n  # several \"node\" statements\n  node [shape = circle,\n        fixedsize = true,\n        width = 0.5,\n        style = filled,\n        color = grey]\n  node [fillcolor = PowderBlue]\n  A; B\n\n  # several \"edge\" statements\n  A->B [dir = \"both\", arrowhead = inv arrowtail = inv]\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script></p>
<ul>
<li>Используются в качестве исходных данных для многих видов многомерных анализов, в т.ч. для иерархического кластерного анализа</li>
<li>Из сходств можно получить различия и наоборот</li>
<li>Свои собственные коэффициенты существуют для количественных и качественных признаков</li>
</ul>
<div id="-" class="section level2">
<h2>Евклидово расстояние</h2>
<p><img src="03_classification_files/figure-html/unnamed-chunk-5-1.png" /><!-- --></p>
<p>Для двумерного пространства Евклидово расстояние рассчитывается так:</p>
<p><img src="03_classification_files/figure-html/unnamed-chunk-6-1.png" /><!-- --></p>
<p>Т.е. Евклидово расстояние в этом гипотетическом примере будет</p>
<p><img src="03_classification_files/figure-html/unnamed-chunk-7-1.png" /><!-- --></p>
<p>Для пространства с большим числом измерений формула Евклидова расстояния выглядит так:</p>
<p><img src="03_classification_files/figure-html/unnamed-chunk-8-1.png" /><!-- --></p>
<p>Евклидово расстояние — это метрика.</p>
<p>Для всех метрик (расстояний) справедливы три свойства:</p>
<ol style="list-style-type: decimal">
<li>Адекватность:</li>
</ol>
<p><br /><span class="math display"><em>d</em><sub><em>A</em>, <em>A</em></sub> = 0</span><br /></p>
<p><div id="htmlwidget-564" style="width:384px;height:48px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-564">{"x":{"diagram":"digraph symmetry {\n\n  # a \"graph\" statement\n  graph [overlap = false, fontsize = 10, rankdir = LR/*,\n  label = <<font point-size=\"10\">d<sub><font point-size=\"5\">A, A\u003c/font>\u003c/sub> = 0\u003c/font>>*/, labelloc = t]\n\n  # several \"node\" statements\n  node [shape = circle,\n        fixedsize = true,\n        width = 0.5,\n        style = filled,\n        color = grey]\n  node [fillcolor = PowderBlue]\n  A\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script></p>
<ol start="2" style="list-style-type: decimal">
<li>Симметричность:</li>
</ol>
<p><br /><span class="math display"><em>d</em><sub><em>A</em>, <em>B</em></sub> = <em>d</em><sub><em>B</em>, <em>A</em></sub></span><br /></p>
<p><div id="htmlwidget-4686" style="width:384px;height:48px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-4686">{"x":{"diagram":"digraph symmetry {\n\n  # a \"graph\" statement\n  graph [overlap = false, fontsize = 10, rankdir = LR, labelloc = t, labeljust = c/*, label = \"Симметричность\"*/]\n\n  # several \"node\" statements\n  node [shape = circle,\n        fixedsize = true,\n        width = 0.5,\n        style = filled,\n        color = grey]\n  node [fillcolor = PowderBlue]\n  A; B\n\n  # several \"edge\" statements\n  A->B /*[label=<<font point-size=\"10\">d<sub><font point-size=\"5\">A, B\u003c/font>\u003c/sub> = d<sub><font point-size=\"5\">B, A\u003c/font>\u003c/sub>\u003c/font>>]*/\n  B->A\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script></p>
<ol start="3" style="list-style-type: decimal">
<li>Триангулярность:</li>
</ol>
<p><br /><span class="math display"><em>d</em><sub><em>A</em>, <em>B</em></sub> ≤ <em>d</em><sub><em>A</em>, <em>C</em></sub> + <em>d</em><sub><em>C</em>, <em>B</em></sub></span><br /></p>
<p><strong>Триангулярность есть только у метрик!</strong> Именно потому, что для них выполняется неравенство треугольника, они имеют право называться <strong>расстояниями</strong>, а не просто мерами различия.</p>
<p><div id="htmlwidget-4838" style="width:384px;height:96px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-4838">{"x":{"diagram":"digraph symmetry {\n\n  # a \"graph\" statement\n  graph [overlap = false, fontsize = 10, rankdir = LR]\n\n  # several \"node\" statements\n  node [shape = circle,\n        fixedsize = true,\n        width = 0.5,\n        style = filled,\n        color = grey]\n  node [fillcolor = PowderBlue]\n  A; B; C\n\n  # several \"edge\" statements\n  A->B A->C C->B\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script></p>
</div>
<div id="-" class="section level2">
<h2>Коэффициент Жаккара</h2>
<p>Если используются бинарные данные - то посчитать сходство можно, учитывая присутствие-отсутствие признаков.</p>
<table>
<thead>
<tr class="header">
<th align="left">объект I / объект J</th>
<th align="left">признак есть</th>
<th align="left">признака нет</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">признак есть</td>
<td align="left">a</td>
<td align="left">b</td>
</tr>
<tr class="even">
<td align="left">признака нет</td>
<td align="left">c</td>
<td align="left">d</td>
</tr>
</tbody>
</table>
<ul>
<li><span class="math inline"><em>I</em></span>, <span class="math inline"><em>J</em></span> — объекты</li>
<li><span class="math inline"><em>a</em></span> — число сходств по наличию признака</li>
<li><span class="math inline"><em>b</em></span> — число отличий <span class="math inline"><em>I</em></span> от <span class="math inline"><em>J</em></span></li>
<li><span class="math inline"><em>c</em></span> — число различий <span class="math inline"><em>J</em></span> от <span class="math inline"><em>I</em></span></li>
<li><span class="math inline"><em>d</em></span> — число сходств по отсутствию признака</li>
<li><span class="math inline"><em>n</em><sub><em>J</em></sub></span> — число признаков у объекта <span class="math inline"><em>J</em></span></li>
<li><span class="math inline"><em>n</em><sub><em>I</em></sub></span> — число признаков у объекта <span class="math inline"><em>I</em></span></li>
<li><span class="math inline"><em>n</em> = <em>a</em> + <em>b</em> + <em>c</em> + <em>d</em></span> — общее число признаков</li>
</ul>
<p>Коэффициентов сходства-различия для качественных данных придумано великое множество.</p>
<p>Коэффициент Жаккара рассчитывается по формуле:</p>
<p><span class="math inline"><em>S</em> = <em>a</em>/(<em>a</em> + <em>b</em> + <em>c</em>)</span>, причем <span class="math inline">0 ≤ <em>S</em> ≤ 1</span></p>
<p>Соответствующий коэффициент различия Жаккара можно посчитать так:</p>
<p><span class="math inline"><em>d</em> = 1 − <em>a</em>/(<em>a</em> + <em>b</em> + <em>c</em>)=(<em>b</em> + <em>c</em>)/(<em>a</em> + <em>b</em> + <em>c</em>)</span></p>
<p>У коэффициента Жаккара есть одно забавное свойство. Обратите внимание, в знаменателе фигурирует не общее число признаков — сходство по отсутствию не учитывается! Это свойство очень полезно для работы с протеомными данными. Пятно может отсутствовать на геле не только потому, что пептида не было в пробе, но и в силу самых разных других причин (например, экспрессия ниже порога определения, плохо прокрашен образец и проч.).</p>
<p>Например, пусть у нас есть три пробы, у которых мы нашли всего 5 пятен.</p>
<table>
<thead>
<tr class="header">
<th align="left">Objects</th>
<th align="right">Spot.1</th>
<th align="right">Spot.2</th>
<th align="right">Spot.3</th>
<th align="right">Spot.4</th>
<th align="right">Spot.5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Object 1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Object 2</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Object 3</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>Чтобы оценить различие между этими пробами, можно посчитать коэффициент Жаккара.</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Object 1</th>
<th align="right">Object 2</th>
<th align="right">Object 3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Object 1</td>
<td align="right">0.00</td>
<td align="right">0.25</td>
<td align="right">0.67</td>
</tr>
<tr class="even">
<td align="left">Object 2</td>
<td align="right">0.25</td>
<td align="right">0.00</td>
<td align="right">0.75</td>
</tr>
<tr class="odd">
<td align="left">Object 3</td>
<td align="right">0.67</td>
<td align="right">0.75</td>
<td align="right">0.00</td>
</tr>
</tbody>
</table>
<p>Точно так же, чтобы оценить различие пептидов, можно посчитать коэффициент Жаккара между пептидами</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Spot 1</th>
<th align="right">Spot 2</th>
<th align="right">Spot 3</th>
<th align="right">Spot 4</th>
<th align="right">Spot 5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Spot 1</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.50</td>
<td align="right">0.33</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Spot 2</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.50</td>
<td align="right">0.33</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Spot 3</td>
<td align="right">0.50</td>
<td align="right">0.50</td>
<td align="right">0.00</td>
<td align="right">0.67</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Spot 4</td>
<td align="right">0.33</td>
<td align="right">0.33</td>
<td align="right">0.67</td>
<td align="right">0.00</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Spot 5</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="-----" class="section level1">
<h1>Алгоритмы иерархической класстеризации на основании расстояний</h1>
<p>Мы рассмотрим несколько алгоритмов, которые строят иерархическую кластеризацию объектов на основании матрицы расстояний / сходств между ними:</p>
<ul>
<li>Метод ближайшего соседа</li>
<li>Метод отдаленного соседа</li>
<li>Метод среднегруппового расстояния</li>
<li>Метод Варда</li>
</ul>
<p><img src="03_classification_files/figure-html/unnamed-chunk-15-1.png" /><!-- --></p>
<div id="---nearest-neighbour-single-linkage" class="section level2">
<h2>Метод ближайшего соседа (= nearest neighbour = single linkage)</h2>
<ul>
<li>к кластеру присоединяется ближайший к нему кластер/объект</li>
<li>кластеры объединяются в один на расстоянии, которое равно расстоянию между ближайшими объектами этих кластеров</li>
</ul>
<p><img src="03_classification_files/figure-html/unnamed-chunk-16-1.png" /><!-- --></p>
<p>Особенности:</p>
<ul>
<li>Может быть сложно интерпретировать, если нужны группы</li>
<li>объекты на дендрограмме часто не образуют четко разделенных групп</li>
<li>часто получаются цепочки кластеров (объекты присоединяются как бы по-одному)</li>
<li>Хорош для выявления градиентов</li>
</ul>
<p>Работа метода ближайшего соседа</p>
<p><img src="images/Min_Link_Clustering.jpg" alt="Single link clustering" height=450px></p>
<p><img src="images/Min_Link_Dendogramm.jpg" alt="Single link dendrogram" width=260px></p>
<p><small><a href="http://www-m9.ma.tum.de/material/felix-klein/clustering/Methoden/Hierarchisches_Clustern_Beispiel.php" class="uri">http://www-m9.ma.tum.de/material/felix-klein/clustering/Methoden/Hierarchisches_Clustern_Beispiel.php</a></small></p>
</div>
<div id="---furthest-neighbour-complete-linkage" class="section level2">
<h2>Метод отдаленного соседа (= furthest neighbour = complete linkage)</h2>
<ul>
<li>к кластеру присоединяется отдаленный кластер/объект</li>
<li>кластеры объединяются в один на расстоянии, которое равно расстоянию между самыми отдаленными объектами этих кластеров (следствие - чем более крупная группа, тем сложнее к ней присоединиться)</li>
</ul>
<p><img src="03_classification_files/figure-html/unnamed-chunk-17-1.png" /><!-- --></p>
<p>Особенности:</p>
<ul>
<li>На дендрограмме образуется много отдельных некрупных групп</li>
<li>Хорош для поиска дискретных групп в данных</li>
</ul>
<p>Как работает метод отдаленного соседа</p>
<p><img src="images/Max_Link_Clustering.jpg" alt="Complete link clustering" height=450px> <img src="images/Max_Link_Dendogramm.jpg" alt="Complete link dendrogram" width=260px></p>
<p><small><a href="http://www-m9.ma.tum.de/material/felix-klein/clustering/Methoden/Hierarchisches_Clustern_Beispiel.php" class="uri">http://www-m9.ma.tum.de/material/felix-klein/clustering/Methoden/Hierarchisches_Clustern_Beispiel.php</a></small></p>
</div>
<div id="----upgma-unweighted-pair-group-method-with-arithmetic-mean" class="section level2">
<h2>Метод невзвешенного попарного среднего (= UPGMA = Unweighted Pair Group Method with Arithmetic mean)</h2>
<ul>
<li>кластеры объединяются в один на расстоянии, которое равно среднему значению всех возможных расстояний между объектами из разных кластеров.</li>
</ul>
<p><img src="03_classification_files/figure-html/unnamed-chunk-18-1.png" /><!-- --></p>
<p>Особенности:</p>
<ul>
<li>UPGMA и WUPGMС иногда могут приводить к инверсиям на дендрограммах</li>
</ul>
<div class="figure">
<img src="images/clust-revert.png" alt="Инверсии на дендрограммах" />
<p class="caption">Инверсии на дендрограммах</p>
</div>
<p><small>из Borcard et al., 2011</small></p>
<p>Как работает метод среднегруппового расстояния</p>
<p><img src="images/Group_Average_Clustering.jpg" alt="UPGMA clustering" height=450px> <img src="images/Group_Average_Dendogramm.jpg" alt="UPGMA dendrogram" width=260px></p>
<p><small><a href="http://www-m9.ma.tum.de/material/felix-klein/clustering/Methoden/Hierarchisches_Clustern_Beispiel.php" class="uri">http://www-m9.ma.tum.de/material/felix-klein/clustering/Methoden/Hierarchisches_Clustern_Beispiel.php</a></small></p>
</div>
<div id="--wards-minimum-variance-clustering" class="section level2">
<h2>Метод Варда (= Ward’s Minimum Variance Clustering)</h2>
<ul>
<li>объекты объединяются в кластеры так, чтобы внутригрупповая дисперсия расстояний была минимальной</li>
</ul>
<p><img src="03_classification_files/figure-html/unnamed-chunk-19-1.png" /><!-- --></p>
<p>Особенности:</p>
<ul>
<li>метод годится и для неевклидовых расстояний несмотря на то, что внутригрупповая дисперсия расстояний рассчитывается так, как будто это евклидовы расстояния</li>
</ul>
</div>
</div>
<div id="---r" class="section level1">
<h1>Кластерный анализ в R</h1>
<div id="-" class="section level2">
<h2>Пример: Гребешки</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">expr &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;data/Prot_Br_H_T.csv&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="dt">row.names =</span> <span class="dv">1</span>)

fact &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;data/Prot_Br_H_T_factor.csv&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="dt">row.names =</span> <span class="dv">1</span>)</code></pre></div>
<p>Давайте познакомимся с данными.</p>
<p>Все ли правильно открылось?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(expr, <span class="dv">2</span>)</code></pre></div>
<pre><code>##    HT_Br_141_27754 HT_Br_142_27755 HT_Br_143_27756 HT_Br_145_27757
## 45         6763312         6966863         6006985         5120761
## 53         9950611        17838761        12401817        14001657
##    HT_Br_153_27758 HT_Br_182_30362 HT_Br_184_30363 HT_Br_186_30343
## 45         9120571         6161298         4438035        19590652
## 53        11963762        14891363         9596294        23846920
##    HT_Br_185_30364 HT_Br_189_30367 HT_Br_221_30350 HT_Br_222_30351
## 45         5282460         6504236         4678531         2160960
## 53         9998502         9999054        11837575        12884919
##    HT_Br_227_30353 HT_Br_229_30354 HT_Br_233_30355 HT_Br_122_27749
## 45         3939886         2445546           64768         7563888
## 53         9805115         8734801          604969        12735062
##    HT_Br_123_27750 HT_Br_125_27751 HT_Br_126_27752 HT_Br_129_27753
## 45         5879243         7043350         5885715         6699740
## 53         8899526        11570789        17043221         9936874
##    HT_Br_161_27759 HT_Br_162_27760 HT_Br_166_30359 HT_Br_172_30342
## 45         5128015         2430172         5303710         5635613
## 53        12689674         9537262        10988683        11866547
##    HT_Br_173_30361 HT_Br_202_30368 HT_Br_203_30369 HT_Br_204_30346
## 45         2586951         4819522         4860770         4842049
## 53         7705261        11889297        15321258        18908028
##    HT_Br_205_30347 HT_Br_207_30345
## 45         1839401          605503
## 53         6482305        16408730</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(expr)</code></pre></div>
<pre><code>## [1] 647  30</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(expr, class)</code></pre></div>
<pre><code>## HT_Br_141_27754 HT_Br_142_27755 HT_Br_143_27756 HT_Br_145_27757 
##       &quot;integer&quot;       &quot;integer&quot;       &quot;integer&quot;       &quot;integer&quot; 
## HT_Br_153_27758 HT_Br_182_30362 HT_Br_184_30363 HT_Br_186_30343 
##       &quot;integer&quot;       &quot;integer&quot;       &quot;integer&quot;       &quot;integer&quot; 
## HT_Br_185_30364 HT_Br_189_30367 HT_Br_221_30350 HT_Br_222_30351 
##       &quot;integer&quot;       &quot;integer&quot;       &quot;integer&quot;       &quot;integer&quot; 
## HT_Br_227_30353 HT_Br_229_30354 HT_Br_233_30355 HT_Br_122_27749 
##       &quot;integer&quot;       &quot;integer&quot;       &quot;integer&quot;       &quot;integer&quot; 
## HT_Br_123_27750 HT_Br_125_27751 HT_Br_126_27752 HT_Br_129_27753 
##       &quot;integer&quot;       &quot;integer&quot;       &quot;integer&quot;       &quot;integer&quot; 
## HT_Br_161_27759 HT_Br_162_27760 HT_Br_166_30359 HT_Br_172_30342 
##       &quot;integer&quot;       &quot;integer&quot;       &quot;integer&quot;       &quot;integer&quot; 
## HT_Br_173_30361 HT_Br_202_30368 HT_Br_203_30369 HT_Br_204_30346 
##       &quot;integer&quot;       &quot;integer&quot;       &quot;integer&quot;       &quot;integer&quot; 
## HT_Br_205_30347 HT_Br_207_30345 
##       &quot;integer&quot;       &quot;integer&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(fact)</code></pre></div>
<pre><code>##                 Oxygen Temperature
## HT_Br_141_27754 Normox         10C
## HT_Br_142_27755 Normox         10C
## HT_Br_143_27756 Normox         10C
## HT_Br_145_27757 Normox         10C
## HT_Br_153_27758 Normox         10C
## HT_Br_182_30362 Normox         18C</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(fact)</code></pre></div>
<pre><code>## [1] 30  2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(fact, class)</code></pre></div>
<pre><code>##      Oxygen Temperature 
##    &quot;factor&quot;    &quot;factor&quot;</code></pre>
<p>Сколько экспериментальных групп? И каковы объемы выборок?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(fact$Oxygen, fact$Temperature)</code></pre></div>
<pre><code>##         
##          10C 18C 25C
##   Hypox    5   5   5
##   Normox   5   5   5</code></pre>
<p>Есть ли пропущенные значения экспрессии?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(expr, function(x)<span class="kw">sum</span>(<span class="kw">is.na</span>(x)))</code></pre></div>
<pre><code>## HT_Br_141_27754 HT_Br_142_27755 HT_Br_143_27756 HT_Br_145_27757 
##               0               0               0               0 
## HT_Br_153_27758 HT_Br_182_30362 HT_Br_184_30363 HT_Br_186_30343 
##               0               0               0               0 
## HT_Br_185_30364 HT_Br_189_30367 HT_Br_221_30350 HT_Br_222_30351 
##               0               0               0               0 
## HT_Br_227_30353 HT_Br_229_30354 HT_Br_233_30355 HT_Br_122_27749 
##               0               0               0               0 
## HT_Br_123_27750 HT_Br_125_27751 HT_Br_126_27752 HT_Br_129_27753 
##               0               0               0               0 
## HT_Br_161_27759 HT_Br_162_27760 HT_Br_166_30359 HT_Br_172_30342 
##               0               0               0               0 
## HT_Br_173_30361 HT_Br_202_30368 HT_Br_203_30369 HT_Br_204_30346 
##               0               0               0               0 
## HT_Br_205_30347 HT_Br_207_30345 
##               0               0</code></pre>
<p>Нужна ли нормализация?</p>
<p>Боксплот исходных данных экспрессии</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># создаем палитру и вектор цветов</span>
<span class="kw">library</span>(RColorBrewer)
pal &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&quot;Set1&quot;</span>)
groups &lt;-<span class="st"> </span><span class="kw">interaction</span>(fact$Oxygen, fact$Temperature)
cols &lt;-<span class="st"> </span>pal[groups]
<span class="co"># боксплот</span>
<span class="kw">boxplot</span>(expr, <span class="dt">outline =</span> <span class="ot">FALSE</span>, <span class="dt">notch =</span> T, <span class="dt">col =</span> cols, <span class="dt">main =</span> <span class="st">&quot;Исходные данные&quot;</span>)</code></pre></div>
<pre><code>## Warning in bxp(structure(list(stats = structure(c(231211, 1008860.5,
## 2130516, : some notches went outside hinges (&#39;box&#39;): maybe set notch=FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="kw">levels</span>(groups), <span class="dt">fill =</span> <span class="kw">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&quot;Set1&quot;</span>), <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">xpd =</span> T)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-24-1.png" /><!-- --></p>
<p>RI-plot исходных данных</p>
<p>Создадим пользовательскую функцию для построения RI-плота.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RIP &lt;-<span class="st"> </span>function(X1, X2, <span class="dt">main =</span> <span class="st">&quot;RI-plot&quot;</span>, <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">col =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="dt">lpars =</span> <span class="kw">list</span>(<span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>), <span class="dt">alpha =</span> <span class="fl">0.3</span>, <span class="dt">xlab =</span> <span class="st">&quot;Intensity&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Ratio&quot;</span>, ...){
  <span class="co"># соотношение и интенсивность</span>
  R &lt;-<span class="st"> </span><span class="kw">log2</span>(<span class="kw">rowMeans</span>(X2) /<span class="st"> </span><span class="kw">rowMeans</span>(X1))
  I &lt;-<span class="st"> </span><span class="kw">log10</span>(<span class="kw">rowMeans</span>(X2) *<span class="st"> </span><span class="kw">rowMeans</span>(X1))
  <span class="co"># прозрачный цвет</span>
  col_btransp &lt;-<span class="st"> </span><span class="kw">adjustcolor</span>(col, <span class="dt">alpha.f =</span> alpha)
  <span class="co"># график</span>
  <span class="kw">scatter.smooth</span>(I, R, <span class="dt">main =</span> main, <span class="dt">pch =</span> pch, <span class="dt">xlab =</span> xlab, <span class="dt">ylab =</span> ylab, <span class="dt">col =</span> col_btransp, <span class="dt">lpars =</span> lpars, ...)
  <span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">0</span>)
}</code></pre></div>
<p>Строим RI-plot’ы по разным факторам и ужасаемся</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">RIP</span>(expr[, fact$Oxygen ==<span class="st"> &quot;Normox&quot;</span>], expr[, fact$Oxygen ==<span class="st"> &quot;Hypox&quot;</span>], <span class="dt">main =</span> <span class="st">&quot;Raw data, Normox vs. Hypox&quot;</span>)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-26-1.png" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">RIP</span>(expr[, fact$Temperature ==<span class="st"> &quot;10C&quot;</span>], expr[, fact$Temperature ==<span class="st"> &quot;18C&quot;</span>], <span class="dt">main =</span> <span class="st">&quot;Raw data, 10C vs 18C&quot;</span>)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-26-2.png" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">RIP</span>(expr[, fact$Temperature ==<span class="st"> &quot;10C&quot;</span>], expr[, fact$Temperature ==<span class="st"> &quot;25C&quot;</span>], <span class="dt">main =</span> <span class="st">&quot;Raw data, 10C vs 25C&quot;</span>)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-26-3.png" /><!-- --></p>
<p>Данные не нормализованы и не логарифмированы.</p>
<p>Нормализуем данные</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(limma)
expr_norm &lt;-<span class="st"> </span><span class="kw">normalizeQuantiles</span>(expr)</code></pre></div>
<p>Проверяем на боксплоте</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(expr_norm, <span class="dt">outline =</span> <span class="ot">FALSE</span>, <span class="dt">notch =</span> T, <span class="dt">col =</span> cols, <span class="dt">main =</span> <span class="st">&quot;Нормализованные данные&quot;</span>)
<span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="kw">levels</span>(groups), <span class="dt">fill =</span> <span class="kw">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&quot;Set1&quot;</span>), <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">xpd =</span> T)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-28-1.png" /><!-- --></p>
<p>Строим RI-plot’ы по разным факторам и радуемся</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">RIP</span>(expr_norm[, fact$Oxygen ==<span class="st"> &quot;Normox&quot;</span>], 
    expr_norm[, fact$Oxygen ==<span class="st"> &quot;Hypox&quot;</span>], 
    <span class="dt">main =</span> <span class="st">&quot;Normalized data, Normox vs. Hypox&quot;</span>)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-29-1.png" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">RIP</span>(expr_norm[, fact$Temperature ==<span class="st"> &quot;10C&quot;</span>], 
    expr_norm[, fact$Temperature ==<span class="st"> &quot;18C&quot;</span>], 
    <span class="dt">main =</span> <span class="st">&quot;Normalized data, 10C vs 18C&quot;</span>)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-29-2.png" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">RIP</span>(expr_norm[, fact$Temperature ==<span class="st"> &quot;10C&quot;</span>], 
    expr_norm[, fact$Temperature ==<span class="st"> &quot;25C&quot;</span>], 
    <span class="dt">main =</span> <span class="st">&quot;Normalized data, 10C vs 25C&quot;</span>)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-29-3.png" /><!-- --></p>
<p>Логарифмируем данные</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">expr_log &lt;-<span class="st"> </span><span class="kw">log2</span>(expr_norm)</code></pre></div>
</div>
<div id="----" class="section level2">
<h2>Подготовка данных к кластерному анализу</h2>
<p>Названия проб в этом файле — длинные непонятные аббревиатуры.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colnames</span>(expr_log)</code></pre></div>
<pre><code>##  [1] &quot;HT_Br_141_27754&quot; &quot;HT_Br_142_27755&quot; &quot;HT_Br_143_27756&quot;
##  [4] &quot;HT_Br_145_27757&quot; &quot;HT_Br_153_27758&quot; &quot;HT_Br_182_30362&quot;
##  [7] &quot;HT_Br_184_30363&quot; &quot;HT_Br_186_30343&quot; &quot;HT_Br_185_30364&quot;
## [10] &quot;HT_Br_189_30367&quot; &quot;HT_Br_221_30350&quot; &quot;HT_Br_222_30351&quot;
## [13] &quot;HT_Br_227_30353&quot; &quot;HT_Br_229_30354&quot; &quot;HT_Br_233_30355&quot;
## [16] &quot;HT_Br_122_27749&quot; &quot;HT_Br_123_27750&quot; &quot;HT_Br_125_27751&quot;
## [19] &quot;HT_Br_126_27752&quot; &quot;HT_Br_129_27753&quot; &quot;HT_Br_161_27759&quot;
## [22] &quot;HT_Br_162_27760&quot; &quot;HT_Br_166_30359&quot; &quot;HT_Br_172_30342&quot;
## [25] &quot;HT_Br_173_30361&quot; &quot;HT_Br_202_30368&quot; &quot;HT_Br_203_30369&quot;
## [28] &quot;HT_Br_204_30346&quot; &quot;HT_Br_205_30347&quot; &quot;HT_Br_207_30345&quot;</code></pre>
<p>Вместо них нужно создать осмысленные и краткие лейблы для проб.</p>
<p>Информацию о лейблах возьмем из датафрейма с факторами</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(fact)</code></pre></div>
<pre><code>##                 Oxygen Temperature
## HT_Br_141_27754 Normox         10C
## HT_Br_142_27755 Normox         10C
## HT_Br_143_27756 Normox         10C
## HT_Br_145_27757 Normox         10C
## HT_Br_153_27758 Normox         10C
## HT_Br_182_30362 Normox         18C</code></pre>
<p>Кодировку уровня содержания кислорода мы сократим до одной буквы, из температуры уберем <span class="math inline"><em>C</em></span>, и добавим номер гребешка для уникальности. Затем склеим лейблы из трех частей.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">part1 &lt;-<span class="st"> </span><span class="kw">substr</span>(<span class="dt">x =</span> fact$Oxygen, <span class="dt">start =</span> <span class="dv">0</span>, <span class="dt">stop =</span> <span class="dv">1</span>)
part2 &lt;-<span class="st"> </span><span class="kw">substr</span>(<span class="dt">x =</span> fact$Temperature, <span class="dt">start =</span> <span class="dv">0</span>, <span class="dt">stop =</span> <span class="dv">2</span>)
part3 &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>:<span class="dv">5</span>, <span class="dv">6</span>)
<span class="kw">colnames</span>(expr_log) &lt;-<span class="st"> </span><span class="kw">paste</span>(part1, part2, part3, <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)</code></pre></div>
<p>Чтобы строить деревья для проб, нам понадобится транспонировать исходные данные</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">texpr_log &lt;-<span class="st"> </span><span class="kw">t</span>(expr_log)</code></pre></div>
<p>Давайте построим деревья при помощи нескольких алгоритмов кластеризации (по стандартизованным данным, с использованием Евклидова расстояния) и сравним их. Нам понадобится матрица расстояний.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span><span class="kw">dist</span>(<span class="dt">x =</span> texpr_log, <span class="dt">method =</span> <span class="st">&quot;euclidean&quot;</span>)</code></pre></div>
</div>
<div id="----r" class="section level2">
<h2>Метод ближайшего соседа в R</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hc_single &lt;-<span class="st"> </span><span class="kw">hclust</span>(d, <span class="dt">method =</span> <span class="st">&quot;single&quot;</span>)</code></pre></div>
<p>Деревья можно визуализировать при помощи базовой графики, но у нее довольно мало возможностей для настройки внешнего вида.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ?plot.hclust</span>
<span class="kw">plot</span>(hc_single)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-37-1.png" /><!-- --></p>
<p>Визуализируем средствами пакета <code>ape</code> <span class="citation">(Paradis et al. 2004)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ape)
ph_single &lt;-<span class="st"> </span><span class="kw">as.phylo</span>(hc_single)
<span class="co"># ?plot.phylo</span>
<span class="kw">plot</span>(ph_single, <span class="dt">type =</span> <span class="st">&quot;phylogram&quot;</span>, <span class="dt">cex =</span> <span class="fl">0.7</span>)
<span class="kw">axisPhylo</span>()</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-38-1.png" /><!-- --></p>
<p>Визуализируем средствами <code>dendextend</code> <span class="citation">(Galili 2015)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dendextend)
den_single &lt;-<span class="st"> </span><span class="kw">as.dendrogram</span>(hc_single)
<span class="co"># ?plot.dendrogram</span>
op &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">4</span>), <span class="dt">cex =</span> <span class="fl">0.7</span>)
<span class="kw">plot</span>(den_single, <span class="dt">horiz =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-39-1.png" /><!-- --></p>
<p>При желании можно раскрасить лейблы</p>
<p>Это можно сделать вручную, просто передав вектор нужных цветов в том порядке, в котором идут лейблы на дендрограмме. Но мы сейчас не будем заниматься ручным подбором порядка цветов. Давайте раскрасим дендрограмму в произвольные цвета, чтобы понять, как это делается.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cols &lt;-<span class="st"> </span><span class="kw">rainbow</span>(<span class="dv">30</span>)
den_single_manual &lt;-<span class="st"> </span><span class="kw">color_labels</span>(<span class="dt">dend =</span> den_single, <span class="dt">col =</span> cols)
<span class="kw">plot</span>(den_single_manual, <span class="dt">horiz =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-40-1.png" /><!-- --></p>
<p>Чтобы не пришлось вручную создавать вектор цветов, можно попробовать при помощи функции вытащить информацию из лейблов на дендрограмме. Эта функция берет дендрограмму, экстрагирует из нее порядок лейблов, берет первые несколько букв в имени лейбла и на основании этого фактора создает вектор цветов.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">get_colours &lt;-<span class="st"> </span>function(dend, n_chars, <span class="dt">palette =</span> <span class="st">&quot;Dark2&quot;</span>){
labs &lt;-<span class="st"> </span><span class="kw">get_leaves_attr</span>(dend, <span class="st">&quot;label&quot;</span>)
group &lt;-<span class="st"> </span><span class="kw">substr</span>(labs, <span class="dt">start =</span> <span class="dv">0</span>, <span class="dt">stop =</span> n_chars)
group &lt;-<span class="st"> </span><span class="kw">factor</span>(group)
cols &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(<span class="kw">length</span>(<span class="kw">levels</span>(group)), <span class="dt">name =</span> palette)[group]
<span class="kw">return</span>(cols)
}</code></pre></div>
<p>Теперь можно легко раскрасить группы на дендрограмме, ориентируясь на первые несколько символов в названии лейбла.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cols &lt;-<span class="st"> </span><span class="kw">get_colours</span>(<span class="dt">dend =</span> den_single, <span class="dt">n_chars =</span> <span class="dv">4</span>)
den_single_c &lt;-<span class="st"> </span><span class="kw">color_labels</span>(<span class="dt">dend =</span> den_single, <span class="dt">col =</span> cols)
<span class="kw">plot</span>(den_single_c, <span class="dt">horiz =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-42-1.png" /><!-- --></p>
</div>
<div id="----r" class="section level2">
<h2>Метод отдаленного соседа в R</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hc_compl &lt;-<span class="st"> </span><span class="kw">hclust</span>(d, <span class="dt">method =</span> <span class="st">&quot;complete&quot;</span>)
ph_compl &lt;-<span class="st"> </span><span class="kw">as.phylo</span>(hc_compl)
<span class="kw">plot</span>(ph_compl, <span class="dt">type =</span> <span class="st">&quot;phylogram&quot;</span>, <span class="dt">cex =</span> <span class="fl">0.7</span>)
<span class="kw">axisPhylo</span>()</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-43-1.png" /><!-- --></p>
<p>Визуализируем дерево, полученное методом отдаленного соседа, средствами <code>dendextend</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">den_compl &lt;-<span class="st"> </span><span class="kw">as.dendrogram</span>(hc_compl)
cols &lt;-<span class="st"> </span><span class="kw">get_colours</span>(den_compl, <span class="dt">n_chars =</span> <span class="dv">4</span>)
den_compl_c &lt;-<span class="st"> </span><span class="kw">color_labels</span>(den_compl, <span class="dt">col =</span> cols)
<span class="kw">plot</span>(den_compl_c, <span class="dt">horiz =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-44-1.png" /><!-- --></p>
</div>
<div id="-----r" class="section level2">
<h2>Метод невзвешенного попарного среднего в R</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hc_avg &lt;-<span class="st"> </span><span class="kw">hclust</span>(d, <span class="dt">method =</span> <span class="st">&quot;average&quot;</span>)
ph_avg &lt;-<span class="st"> </span><span class="kw">as.phylo</span>(hc_avg)
<span class="kw">plot</span>(ph_avg, <span class="dt">type =</span> <span class="st">&quot;phylogram&quot;</span>, <span class="dt">cex =</span> <span class="fl">0.7</span>)
<span class="kw">axisPhylo</span>()</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-45-1.png" /><!-- --></p>
<p>Визуализируем дерево, полученное методом невзвешенного попарного среднего, средствами <code>dendextend</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">den_avg &lt;-<span class="st"> </span><span class="kw">as.dendrogram</span>(hc_avg)
cols &lt;-<span class="st"> </span><span class="kw">get_colours</span>(den_avg, <span class="dt">n_chars =</span> <span class="dv">4</span>)
den_avg_c &lt;-<span class="st"> </span><span class="kw">color_labels</span>(den_avg, <span class="dt">col =</span> cols)
<span class="kw">plot</span>(den_avg_c, <span class="dt">horiz =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-46-1.png" /><!-- --></p>
</div>
<div id="---r" class="section level2">
<h2>Метод Варда в R</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hc_w2 &lt;-<span class="kw">hclust</span>(d, <span class="dt">method =</span> <span class="st">&quot;ward.D2&quot;</span>)
ph_w2 &lt;-<span class="st"> </span><span class="kw">as.phylo</span>(hc_w2)
<span class="kw">plot</span>(ph_w2, <span class="dt">type =</span> <span class="st">&quot;phylogram&quot;</span>, <span class="dt">cex =</span> <span class="fl">0.7</span>)
<span class="kw">axisPhylo</span>()</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-47-1.png" /><!-- --></p>
<p>Визуализируем дерево, полученное методом Варда, средствами <code>dendextend</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">den_w2 &lt;-<span class="st"> </span><span class="kw">as.dendrogram</span>(hc_w2)
cols &lt;-<span class="st"> </span><span class="kw">get_colours</span>(den_w2, <span class="dt">n_chars =</span> <span class="dv">4</span>)
den_w2_c &lt;-<span class="st"> </span><span class="kw">color_labels</span>(den_w2, <span class="dt">col =</span> cols)
<span class="kw">plot</span>(den_w2_c, <span class="dt">horiz =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-48-1.png" /><!-- --></p>
</div>
</div>
<div id="--" class="section level1">
<h1>Оценка качества кластеризации</h1>
<div id="-" class="section level2">
<h2>Кофенетическая корреляция</h2>
<p>Кофенетическое расстояние - расстояние между объектами на дендрограмме</p>
<p>Кофенетическую корреляцию можно рассчитать как пирсоновскую корреляцию (обычную) между матрицами исходных и кофенетических расстояний между всеми парами объектов</p>
<p>Метод, который дает наибольшую кофенетическую корреляцию дает кластеры лучше всего отражающие исходные данные</p>
<p>Можно рассчитать при помощи функции из пакета <code>ape</code></p>
<div id="---r" class="section level3">
<h3>Кофенетическая корреляция в R</h3>
<p>Оцените при помощи кофенетической корреляции качество кластеризаций, полученных разными методами. Какой метод дает лучший результат?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">c_single &lt;-<span class="st"> </span><span class="kw">cophenetic</span>(ph_single)
c_compl &lt;-<span class="st"> </span><span class="kw">cophenetic</span>(ph_compl)
c_avg &lt;-<span class="st"> </span><span class="kw">cophenetic</span>(ph_avg)
c_w2 &lt;-<span class="st"> </span><span class="kw">cophenetic</span>(ph_w2)

<span class="kw">cor</span>(d, <span class="kw">as.dist</span>(c_single))</code></pre></div>
<pre><code>## [1] 0.7394115</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor</span>(d, <span class="kw">as.dist</span>(c_compl))</code></pre></div>
<pre><code>## [1] 0.5846987</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor</span>(d, <span class="kw">as.dist</span>(c_avg))</code></pre></div>
<pre><code>## [1] 0.8184344</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor</span>(d, <span class="kw">as.dist</span>(c_w2))</code></pre></div>
<pre><code>## [1] 0.7116216</code></pre>
</div>
</div>
<div id="---" class="section level2">
<h2>Качество и количество кластеров</h2>
<p>На каком уровне нужно делить дендрограмму на кластеры?</p>
<ul>
<li>Можно субъективно, на любом выбранном уровне. Главное, чтобы кластеры были осмысленными и интерпретируемыми.</li>
<li>Можно выбрать, глядя на распределение расстояний ветвления</li>
<li>Можно оценить стабильность кластеризации при помощи бутстрепа и выбрать оптимальное число кластеров.</li>
</ul>
<div id="-" class="section level3">
<h3>Стабильность кластеров</h3>
<p>На хорошей кластеризации кластеры должны воспроизводиться.</p>
<p>Оптимальное число кластеров можно определить рассчитывая меру нестабильности для каждой из выборок бутстрепа (Fang and Wang (2012))</p>
<p>Много раз берем по 2 выборки бутстрепом, и оцениваем стабильность.</p>
<p>Здесь мы используем всего 1000 итераций. Для реальной жизни нужно больше.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(fpc)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nsel &lt;-<span class="st"> </span><span class="kw">nselectboot</span>(d, <span class="dt">B =</span> <span class="dv">1000</span>, <span class="dt">clustermethod =</span> hclustCBI, <span class="dt">seed =</span> <span class="dv">9646</span>, <span class="dt">method =</span> <span class="st">&quot;average&quot;</span>, <span class="dt">krange=</span><span class="dv">2</span>:<span class="dv">11</span>)</code></pre></div>
<p>Оптимальное число кластеров — с минимальным значением нестабильности</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nsel$kopt <span class="co"># оптимальное число кластеров</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nsel$stabk <span class="co"># средние значения нестабильности</span></code></pre></div>
<pre><code>##  [1]         NA 0.13947778 0.04067333 0.07087333 0.06828889 0.06383333
##  [7] 0.06660667 0.06024889 0.05499556 0.04776667 0.04400000</code></pre>
<p>Чтобы легче было выбирать, и чтобы понять, что происходит, изобразим значения нестабильности на графике</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="dv">1</span>:<span class="dv">11</span>, nsel$stabk)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-51-1.png" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># nsel$stab # матрица с результатами бутстрепа</span></code></pre></div>
</div>
</div>
<div id="-" class="section level2">
<h2>Ширина силуэта</h2>
<p>Ширина силуэта — мера степени принадлежности объекта к кластеру.</p>
<p><!-- (Kaufman, Rousseeuw 1990)) --></p>
<p>Ширина силуэта — это среднее расстояние от данного объекта до других объектов из того же кластера, в сравнении с аналогичной величиной для ближайшего кластера.</p>
<p>Чем больше ширина силуэта, тем лучше.</p>
<p>Оценим ширину силуэта для 3 или 6 кластеров</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">complete3 &lt;-<span class="st"> </span><span class="kw">cutree</span>(<span class="kw">hclust</span>(d), <span class="dv">3</span>)
qual3&lt;-<span class="st"> </span><span class="kw">cluster.stats</span>(d, complete3)
qual3$clus.avg.silwidths</code></pre></div>
<pre><code>##          1          2          3 
## 0.05606534 0.20823684 0.22461054</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">complete6 &lt;-<span class="st"> </span><span class="kw">cutree</span>(<span class="kw">hclust</span>(d), <span class="dv">6</span>)
qual6&lt;-<span class="st"> </span><span class="kw">cluster.stats</span>(d, complete6)
qual6$clus.avg.silwidths</code></pre></div>
<pre><code>##         1         2         3         4         5         6 
## 0.0797556 0.1540164 0.0000000 0.2177627 0.0000000 0.0000000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(qual3$clus.avg.silwidths); <span class="kw">mean</span>(qual6$clus.avg.silwidths)</code></pre></div>
<pre><code>## [1] 0.1629709</code></pre>
<pre><code>## [1] 0.07525578</code></pre>
</div>
<div id="--" class="section level2">
<h2>Бутстреп поддержка ветвей</h2>
<p>“An approximately unbiased test of phylogenetic tree selection” (Shimodaria, 2002)</p>
<p>Этот тест использует специальный вариант бутстрепа — multiscale bootstrap. Мы не просто многократно берем бутстреп-выборки и оцениваем для них вероятность получения топологий (BP p-value), эти выборки еще и будут с разным числом объектов. По изменению BP при разных объемах выборки можно вычислить AU (approximately unbiased p-value).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(pvclust)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># итераций должно быть 1000 и больше, здесь мало для скорости</span>
<span class="kw">set.seed</span>(<span class="dv">42</span>)
cl_boot &lt;-<span class="st"> </span><span class="kw">pvclust</span>(expr_log, <span class="dt">method.hclust =</span> <span class="st">&quot;average&quot;</span>, <span class="dt">nboot =</span> <span class="dv">100</span>, <span class="dt">method.dist =</span> <span class="st">&quot;euclidean&quot;</span>)</code></pre></div>
<pre><code>## Bootstrap (r = 0.5)... Done.
## Bootstrap (r = 0.6)... Done.
## Bootstrap (r = 0.7)... Done.
## Bootstrap (r = 0.8)... Done.
## Bootstrap (r = 0.9)... Done.
## Bootstrap (r = 1.0)... Done.
## Bootstrap (r = 1.1)... Done.
## Bootstrap (r = 1.2)... Done.
## Bootstrap (r = 1.3)... Done.
## Bootstrap (r = 1.4)... Done.</code></pre>
<p>Дерево с величинами поддержки</p>
<p>AU — approximately unbiased p-values (красный), BP — bootstrap p-values (зеленый)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(cl_boot)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-54-1.png" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># pvrect(cl_boot) # достоверные ветвления</span></code></pre></div>
<p>Если для кластера AU p-value &gt; 0.95, то нулевую гипотезу о том, что он не существует отвергают на уровне значимости 0.05.</p>
<p>Но сами AU p-values оцениваются при помощи бутстрепа, а значит, тоже не точно. Стандартные ошибки можно оценить чтобы оценить точность оценки самих AU. Для диагностики качества оценок AU нам понадобится график стандартных ошибок для AU p-value. Чем больше было бутстреп-итераций, тем точнее будет оценка.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">seplot</span>(cl_boot)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-55-1.png" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># seplot(cl_boot, identify = TRUE)</span>
<span class="co"># print(cl_boot) # все значения</span></code></pre></div>
<p>Например, для кластера 16 <span class="math inline"><em>A</em><em>U</em>=</span> 0.829, а ее стандартная ошибка <span class="math inline"><em>S</em><em>E</em>=</span> 0.196. Это будет значить, что истинное значение AU p-value будет лежать в пределах между 0.446 и 1.213. Такая оценка значимости не точна, т.к. <span class="math inline">0 ≤ <em>A</em><em>U</em> <em>p</em> <em>v</em><em>a</em><em>l</em><em>u</em><em>e</em> ≤ 1</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(cl_boot, <span class="dt">which =</span> <span class="dv">16</span>)</code></pre></div>
<pre><code>## 
## Cluster method: average
## Distance      : euclidean
## 
## Estimates on edges:
## 
##       au    bp se.au se.bp      v     c  pchi
## 16 0.829 0.986 0.196 0.006 -1.571 -0.62 0.929</code></pre>
<p>Если повторить бутстреп с большим числом итераций, стандартные ошибки AU p-values уменьшатся.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">42</span>)
cl_boot &lt;-<span class="st"> </span><span class="kw">pvclust</span>(expr_log, <span class="dt">method.hclust =</span> <span class="st">&quot;average&quot;</span>, <span class="dt">nboot =</span> <span class="dv">1000</span>, <span class="dt">method.dist =</span> <span class="st">&quot;euclidean&quot;</span>)</code></pre></div>
<pre><code>## Bootstrap (r = 0.5)... Done.
## Bootstrap (r = 0.6)... Done.
## Bootstrap (r = 0.7)... Done.
## Bootstrap (r = 0.8)... Done.
## Bootstrap (r = 0.9)... Done.
## Bootstrap (r = 1.0)... Done.
## Bootstrap (r = 1.1)... Done.
## Bootstrap (r = 1.2)... Done.
## Bootstrap (r = 1.3)... Done.
## Bootstrap (r = 1.4)... Done.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">seplot</span>(cl_boot)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-57-1.png" /><!-- --></p>
</div>
</div>
<div id="--" class="section level1">
<h1>Сопоставление деревьев: Танглграммы</h1>
<div class="section level2">
<h2>Танглграмма</h2>
<p>Два дерева (с непохожим ветвлением) выравнивают, вращая случайным образом ветви вокруг оснований. Итеративный алгоритм. Картина каждый раз разная.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">395</span>)
untang_w &lt;-<span class="st"> </span><span class="kw">untangle_step_rotate_2side</span>(den_single, den_avg, <span class="dt">print_times =</span> F)
<span class="co"># танглграмма</span>
<span class="kw">tanglegram</span>(untang_w[[<span class="dv">1</span>]], untang_w[[<span class="dv">2</span>]],
           <span class="dt">highlight_distinct_edges =</span> <span class="ot">FALSE</span>,
           <span class="dt">common_subtrees_color_lines =</span> F,
           <span class="dt">main =</span> <span class="st">&quot;Tanglegram&quot;</span>,
           <span class="dt">main_left =</span> <span class="st">&quot;Single linkage&quot;</span>,
           <span class="dt">main_right =</span> <span class="st">&quot;UPGMA&quot;</span>,
           <span class="dt">columns_width =</span> <span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">1</span>, <span class="dv">8</span>),
           <span class="dt">margin_top =</span> <span class="fl">3.2</span>, <span class="dt">margin_bottom =</span> <span class="fl">2.5</span>,
           <span class="dt">margin_inner =</span> <span class="dv">4</span>, <span class="dt">margin_outer =</span> <span class="fl">0.5</span>,
           <span class="dt">lwd =</span> <span class="fl">1.2</span>, <span class="dt">edge.lwd =</span> <span class="fl">1.2</span>,
           <span class="dt">lab.cex =</span> <span class="dv">1</span>, <span class="dt">cex_main =</span> <span class="dv">1</span>)</code></pre></div>
<p><img src="03_classification_files/figure-html/tang-1.png" /><!-- --></p>
</div>
</div>
<div id="--." class="section level1">
<h1>Тепловые карты экспрессии.</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(gplots) <span class="co"># для тепловых карт</span></code></pre></div>
<div id="---" class="section level2">
<h2>Палитры для тепловых карт</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pal_green &lt;-<span class="st"> </span><span class="kw">colorpanel</span>(<span class="dv">75</span>, <span class="dt">low =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">mid =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;yellow&quot;</span>)
<span class="co"># library(spatstat) # to convert palette to grayscale</span>
<span class="co"># pal_gray &lt;- to.grey(pal_green, weights=c(1,1,1))</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(expr_log)
<span class="kw">heatmap.2</span>(dat, <span class="dt">col=</span>pal_green, <span class="dt">scale =</span> <span class="st">&quot;none&quot;</span>, <span class="dt">key=</span><span class="ot">TRUE</span>, <span class="dt">symkey=</span><span class="ot">FALSE</span>, <span class="dt">density.info=</span><span class="st">&quot;none&quot;</span>, <span class="dt">trace=</span><span class="st">&quot;none&quot;</span>, <span class="dt">cexRow=</span><span class="dv">1</span>, <span class="dt">cexCol =</span> <span class="dv">1</span>, <span class="dt">keysize =</span> <span class="dv">1</span>, <span class="dt">margins =</span> <span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">5</span>))</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-60-1.png" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">heatmap.2</span>(dat, <span class="dt">col=</span>pal_green, <span class="dt">scale =</span> <span class="st">&quot;none&quot;</span>, <span class="dt">key=</span><span class="ot">TRUE</span>, <span class="dt">symkey=</span><span class="ot">FALSE</span>, <span class="dt">density.info=</span><span class="st">&quot;none&quot;</span>, <span class="dt">trace=</span><span class="st">&quot;none&quot;</span>, <span class="dt">cexRow=</span><span class="dv">1</span>, <span class="dt">cexCol =</span> <span class="dv">1</span>, <span class="dt">keysize =</span> <span class="dv">1</span>, <span class="dt">margins =</span> <span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">5</span>), <span class="dt">key.par =</span> <span class="kw">list</span>(<span class="dt">mgp =</span> <span class="kw">c</span>(<span class="fl">1.5</span>, <span class="fl">0.9</span>, <span class="dv">0</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="fl">0.1</span>), <span class="dt">cex =</span> <span class="dv">1</span>), <span class="dt">key.title =</span> <span class="ot">NA</span>, <span class="dt">key.xlab =</span> <span class="ot">NA</span>)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-60-2.png" /><!-- --></p>
<p>Еще один вариант</p>
<pre><code>## Loading required package: pkgmaker</code></pre>
<pre><code>## Loading required package: registry</code></pre>
<pre><code>## 
## Attaching package: &#39;pkgmaker&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     isNamespaceLoaded</code></pre>
<pre><code>## Loading required package: rngtools</code></pre>
<pre><code>## Loading required package: cluster</code></pre>
<pre><code>## NMF - BioConductor layer [OK] | Shared memory capabilities [NO: bigmemory] | Cores 3/4</code></pre>
<pre><code>##   To enable shared memory capabilities, try: install.extras(&#39;
## NMF
## &#39;)</code></pre>
<pre><code>## 
## Attaching package: &#39;NMF&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:ape&#39;:
## 
##     consensus</code></pre>
<p><img src="03_classification_files/figure-html/unnamed-chunk-61-1.png" /><!-- --></p>
<!-- # Задания для самостоятельной работы -->
<!-- Для выполнения этих заданий вы можете использовать либо свои собственные данные, либо данные о протеоме жабр гребешков при разной температуре и разном содержании кислорода ([Prot_Br_H_T.csv](https://raw.githubusercontent.com/varmara/proteomics-course/gh-pages/data/Prot_Br_H_T.csv), [Prot_Br_H_T_factor.csv](https://raw.githubusercontent.com/varmara/proteomics-course/gh-pages/data/Prot_Br_H_T_factor.csv))  [@artigaud_proteomic_2015]. -->
<!-- ## Задание 1 -->
<!-- Постройте танглграмму из дендрограмм, полученных методом ближайшего соседа и методом Варда. -->
</div>
</div>
<div class="section level1 unnumbered">
<h1>Ссылки</h1>
<div id="refs" class="references">
<div id="ref-artigaud_proteomic_2015">
<p>Artigaud, S., C. Lacroix, J. Richard, J. Flye-Sainte-Marie, L. Bargelloni, and V. Pichereau. 2015. Proteomic responses to hypoxia at different temperatures in the great scallop ( <em>Pecten maximus</em> ). PeerJ 3:e871.</p>
</div>
<div id="ref-Galili_2015">
<p>Galili, T. 2015. Dendextend: An r package for visualizing, adjusting, and comparing trees of hierarchical clustering. Bioinformatics.</p>
</div>
<div id="ref-Paradis_2004">
<p>Paradis, E., J. Claude, and K. Strimmer. 2004. APE: Analyses of phylogenetics and evolution in R language. Bioinformatics 20:289–290.</p>
</div>
<div id="ref-R_Core_Team_2016">
<p>R Core Team. 2016. R: A language and environment for statistical computing. R Foundation for Statistical Computing, Vienna, Austria.</p>
</div>
</div>
</div>


<!-- some extra javascript for older browsers -->
<script type="text/javascript" src="libs/polyfill.js"></script>


<!-- bizible -->
<script type="text/javascript" src="//cdn.bizible.com/scripts/bizible.js" async=""></script>


<!-- disqus
  <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'rmarkdown'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

-->


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>


</body>
</html>
