<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Марина Варфоломеева" />


<title>Классификация пептидов</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<script src="libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="libs/tocify-1.9.1/jquery.tocify.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/htmlwidgets-0.6/htmlwidgets.js"></script>
<script src="libs/viz-0.3/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-0.8.2/grViz.js"></script>

<style type="text/css">

/* don't use link color in navbar */
.dropdown-menu>li>a {
  color: black;
}

/* some padding for disqus */
#disqus_thread {
  margin-top: 45px;
}

</style>

<link rel="stylesheet" href="libs/font-awesome-4.1.0/css/font-awesome.min.css"/>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #0000ff; } /* Keyword */
code > span.ch { color: #008080; } /* Char */
code > span.st { color: #008080; } /* String */
code > span.co { color: #008000; } /* Comment */
code > span.ot { color: #ff4000; } /* Other */
code > span.al { color: #ff0000; } /* Alert */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #008000; font-weight: bold; } /* Warning */
code > span.cn { } /* Constant */
code > span.sc { color: #008080; } /* SpecialChar */
code > span.vs { color: #008080; } /* VerbatimString */
code > span.ss { color: #008080; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { } /* Variable */
code > span.cf { color: #0000ff; } /* ControlFlow */
code > span.op { } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #ff4000; } /* Preprocessor */
code > span.do { color: #008000; } /* Documentation */
code > span.an { color: #008000; } /* Annotation */
code > span.cv { color: #008000; } /* CommentVar */
code > span.at { } /* Attribute */
code > span.in { color: #008000; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>

<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="libs/navigation-1.0/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {
    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: "h1.title, .toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.9em;
  padding-left: 5px;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
  padding-left: 10px;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/proteomics-course/">Proteomics course</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li><a href="index.html">Начало</a></li>
        <li class="dropdown">
          <a href="lecture-notes" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Конспект<span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
<!--             <li class="dropdown-header">Начало работы</li>
--->
             <li><a href="00_introduction.html">О модуле Анализ протеомных данных</a></li>
             <li><a href="01_introduction_to_r.html">Знакомство с R</a></li>
             <li class="divider"></li>
             <li><a href="02_data_preprocessing.html">Предварительная обработка данных</a></li>
             <!--
             <li><a href="03_classification.html">Классификация</a></li>
             <li><a href="04_differential_expression_analysis.html">Выявление дифференциально-экспрессируемых пептидов</a></li>
             <li><a href="05_multivariate_methods_pca.html">Многомерные методы (PCA)</a></li>
--->
<!--             <li><a href="06_multivariate_methods_pls-da.html">Многомерные методы (PLS-DA)</a></li>
-->
          </ul>
        </li>
        <li><a href="resources.html">Ссылки и ресурсы</a></li>
        <li><a href="coding_practices.html">Правила хорошего кода</a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">


<h1 class="title">Классификация пептидов</h1>
<h4 class="author"><em>Марина Варфоломеева</em></h4>

</div>


<div id="--" class="section level1">
<h1>Методы построения деревьев</h1>
<p>Существует много методов классификации. Их можно разделить на две основные группы (хотя есть много других вариантов)</p>
<p><strong>Методы класстеризации на основании расстояний:</strong></p>
<ul>
<li>Метод ближайшего соседа</li>
<li>Метод отдаленного соседа</li>
<li>Метод среднегруппового расстояния</li>
<li>Метод Варда</li>
<li>и т.д. и т.п.</li>
</ul>
<p>__ Методы кластеризации на основании признаков:__</p>
<ul>
<li>Метод максимальной бережливости</li>
<li>Метод максимального правдоподобия</li>
</ul>
<p>В этом курсе мы будем затрагивать только методы иерархической класстеризации на основании расстояний.</p>
<p>Классификация данных проходит в несколько этапов. Рзультат кластеризации будет сильнее всего зависеть (1) от выбора коэффициента сходства-различия и (2) от алгоритма кластеризации. Нет формальных способов выбрать наиболее подходящий коэффициент и алгоритм.</p>
<p><div id="htmlwidget-3078" style="width:960px;height:576px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-3078">{"x":{"diagram":"digraph symmetry {\n\n  # a \"graph\" statement\n  graph [overlap = TRUE, fontsize = 10, rankdir = TD]\n\n  # several \"node\" statements\n  node [shape = box,\n        fixedsize = false,\n//        width = 0.5,\n        style = filled,\n        color = grey,\n        fillcolor = PowderBlue]\n  A [label=\"Набор признаков\"]\n  B [label=\"Матрица расстояний или сходств\"]\n  C [label=\"Группировка объектов\"]\n  D [label=\"Отношения между кластерами\"]\n  E [label=\"Поправки\"]\n\n  # several \"edge\" statements\n  A->B B->C C->D D->E E->A\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script></p>
</div>
<div id="--" class="section level1">
<h1>Коэффициенты сходства-различия</h1>
<div id="-" class="section level2">
<h2>Евклидово расстояние</h2>
</div>
<div id="-" class="section level2">
<h2>Коэффициент Жаккара</h2>
</div>
<div id="----" class="section level2">
<h2>Расстояние на основе коэффициента корреляции</h2>
</div>
</div>
<div id="-----" class="section level1">
<h1>Алгоритмы иерархической класстеризации на основании расстояний</h1>
<p>Мы рассмотрим несколько алгоритмов, которые строят иерархическую кластеризацию объектов на основании матрицы расстояний / сходств между ними:</p>
<ul>
<li>Метод ближайшего соседа</li>
<li>Метод отдаленного соседа</li>
<li>Метод среднегруппового расстояния</li>
<li>Метод Варда</li>
</ul>
<p><img src="03_classification_files/figure-html/unnamed-chunk-2-1.png" title="" alt="" width="672" /></p>
<div id="---nearest-neighbour-single-linkage" class="section level2">
<h2>Метод ближайшего соседа (= nearest neighbour = single linkage)</h2>
<ul>
<li>к кластеру присоединяется ближайший к нему кластер/объект</li>
<li>кластеры объединяются в один на расстоянии, которое равно расстоянию между ближайшими объектами этих кластеров</li>
</ul>
<p><img src="03_classification_files/figure-html/unnamed-chunk-3-1.png" title="" alt="" width="432" /></p>
<p>Особенности:</p>
<ul>
<li>Может быть сложно интерпретировать, если нужны группы</li>
<li>объекты на дендрограмме часто не образуют четко разделенных групп</li>
<li>часто получаются цепочки кластеров (объекты присоединяются как бы по-одному)</li>
<li>Хорош для выявления градиентов</li>
</ul>
<p>Работа метода ближайшего соседа</p>
<p><img src="images/Min_Link_Clustering.jpg" alt="Single link clustering" height=450px></p>
<p><img src="images/Min_Link_Dendogramm.jpg" alt="Single link dendrogram" width=260px></p>
<p><small><a href="http://www-m9.ma.tum.de/material/felix-klein/clustering/Methoden/Hierarchisches_Clustern_Beispiel.php" class="uri">http://www-m9.ma.tum.de/material/felix-klein/clustering/Methoden/Hierarchisches_Clustern_Beispiel.php</a></small></p>
</div>
<div id="---furthest-neighbour-complete-linkage" class="section level2">
<h2>Метод отдаленного соседа (= furthest neighbour = complete linkage)</h2>
<p><img src="03_classification_files/figure-html/unnamed-chunk-4-1.png" title="" alt="" width="432" /></p>
<ul>
<li>к кластеру присоединяется отдаленный кластер/объект</li>
<li>кластеры объединяются в один на расстоянии, которое равно расстоянию между самыми отдаленными объектами этих кластеров (следствие - чем более крупная группа, тем сложнее к ней присоединиться)</li>
</ul>
<p>Особенности:</p>
<ul>
<li>На дендрограмме образуется много отдельных некрупных групп</li>
<li>Хорош для поиска дискретных групп в данных</li>
</ul>
<p>Как работает метод отдаленного соседа</p>
<p><img src="images/Max_Link_Clustering.jpg" alt="Complete link clustering" height=450px> <img src="images/Max_Link_Dendogramm.jpg" alt="Complete link dendrogram" width=260px></p>
<p><small><a href="http://www-m9.ma.tum.de/material/felix-klein/clustering/Methoden/Hierarchisches_Clustern_Beispiel.php" class="uri">http://www-m9.ma.tum.de/material/felix-klein/clustering/Methoden/Hierarchisches_Clustern_Beispiel.php</a></small></p>
</div>
<div id="----upgma-unweighted-pair-group-method-with-arithmetic-mean" class="section level2">
<h2>Метод невзвешенного попарного среднего (= UPGMA = Unweighted Pair Group Method with Arithmetic mean)</h2>
<ul>
<li>кластеры объединяются в один на расстоянии, которое равно среднему значению всех возможных расстояний между объектами из разных кластеров.</li>
</ul>
<p><img src="03_classification_files/figure-html/unnamed-chunk-5-1.png" title="" alt="" width="432" /></p>
<p>Особенности:</p>
<ul>
<li>UPGMA и WUPGMС иногда могут приводить к инверсиям на дендрограммах</li>
</ul>
<p><img src="images/clust-revert.png" alt="Инверсии на дендрограммах" /></p>
<p><small>из Borcard et al., 2011</small></p>
<p>Как работает метод среднегруппового расстояния</p>
<p><img src="images/Group_Average_Clustering.jpg" alt="UPGMA clustering" height=450px> <img src="images/Group_Average_Dendogramm.jpg" alt="UPGMA dendrogram" width=260px></p>
<p><small><a href="http://www-m9.ma.tum.de/material/felix-klein/clustering/Methoden/Hierarchisches_Clustern_Beispiel.php" class="uri">http://www-m9.ma.tum.de/material/felix-klein/clustering/Methoden/Hierarchisches_Clustern_Beispiel.php</a></small></p>
</div>
<div id="--wards-minimum-variance-clustering" class="section level2">
<h2>Метод Варда (= Ward’s Minimum Variance Clustering)</h2>
<p><img src="03_classification_files/figure-html/unnamed-chunk-6-1.png" title="" alt="" width="432" /></p>
<ul>
<li>объекты объединяются в кластеры так, чтобы внутригрупповая дисперсия расстояний была минимальной</li>
</ul>
<p>Особенности:</p>
<ul>
<li>метод годится и для неевклидовых расстояний несмотря на то, что внутригрупповая дисперсия расстояний рассчитывается так, как будто это евклидовы расстояния</li>
</ul>
</div>
</div>
<div id="---r" class="section level1">
<h1>Кластерный анализ в R</h1>
<div id="-" class="section level2">
<h2>Пример: Ирисы</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;iris&quot;</span>)</code></pre></div>
<p>Давайте познакомимся с данными.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(iris)</code></pre></div>
<pre><code>## [1] 150   5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colnames</span>(iris)</code></pre></div>
<pre><code>## [1] &quot;Sepal.Length&quot; &quot;Sepal.Width&quot;  &quot;Petal.Length&quot; &quot;Petal.Width&quot; 
## [5] &quot;Species&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">rownames</span>(iris))</code></pre></div>
<pre><code>## [1] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; &quot;5&quot; &quot;6&quot;</code></pre>
<p>Делаем осмысленные имена строк</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Species &lt;-<span class="st"> </span><span class="kw">substr</span>(iris$Species, <span class="dv">0</span>, <span class="dv">2</span>)
<span class="kw">rownames</span>(iris) &lt;-<span class="st"> </span><span class="kw">make.unique</span>(Species)</code></pre></div>
<p>Делаем случайную выборку для этой демонстрации</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">191231</span>)
ids &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">nrow</span>(iris), <span class="dv">50</span>)
siris &lt;-<span class="st"> </span>iris[ids, ]</code></pre></div>
<p>Давайте построим деревья при помощи нескольких алгоритмов кластеризации (по стандартизованным данным, с использованием Евклидова расстояния) и сравним их. Нам понадобится матрица расстояний.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span><span class="kw">dist</span>(<span class="dt">x =</span> siris[, -<span class="dv">5</span>], <span class="dt">method =</span> <span class="st">&quot;euclidean&quot;</span>)</code></pre></div>
</div>
<div id="----r" class="section level2">
<h2>Метод ближайшего соседа в R</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hc_single &lt;-<span class="st"> </span><span class="kw">hclust</span>(d, <span class="dt">method =</span> <span class="st">&quot;single&quot;</span>)</code></pre></div>
<p>Визуализируем при помощи базовой графики</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(hc_single)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-13-1.png" title="" alt="" width="672" /></p>
<p>Визуализируем средствами пакета <code>ape</code> <span class="citation">(Paradis et al. 2004)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ape)
ph_single &lt;-<span class="st"> </span><span class="kw">as.phylo</span>(hc_single)
<span class="kw">plot</span>(ph_single, <span class="dt">type =</span> <span class="st">&quot;phylogram&quot;</span>, <span class="dt">cex =</span> <span class="fl">0.7</span>)
<span class="kw">axisPhylo</span>()</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-14-1.png" title="" alt="" width="672" /></p>
<p>Визуализируем средствами <code>dendextend</code> <span class="citation">(Galili 2015)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dendextend)
den_single &lt;-<span class="st"> </span><span class="kw">as.dendrogram</span>(hc_single)
<span class="kw">plot</span>(den_single)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-15-1.png" title="" alt="" width="672" /></p>
</div>
<div id="----r" class="section level2">
<h2>Метод отдаленного соседа в R</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hc_compl &lt;-<span class="st"> </span><span class="kw">hclust</span>(d, <span class="dt">method =</span> <span class="st">&quot;complete&quot;</span>)
ph_compl &lt;-<span class="st"> </span><span class="kw">as.phylo</span>(hc_compl)
<span class="kw">plot</span>(ph_compl, <span class="dt">type =</span> <span class="st">&quot;phylogram&quot;</span>, <span class="dt">cex =</span> <span class="fl">0.7</span>)
<span class="kw">axisPhylo</span>()</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-16-1.png" title="" alt="" width="960" /></p>
<p>Визуализируем дерево, полученное методом отдаленного соседа, средствами <code>dendextend</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">den_compl &lt;-<span class="st"> </span><span class="kw">as.dendrogram</span>(hc_compl)
<span class="kw">plot</span>(den_compl)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-17-1.png" title="" alt="" width="672" /></p>
</div>
<div id="-----r" class="section level2">
<h2>Метод невзвешенного попарного среднего в R</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hc_avg &lt;-<span class="st"> </span><span class="kw">hclust</span>(d, <span class="dt">method =</span> <span class="st">&quot;average&quot;</span>)
ph_avg &lt;-<span class="st"> </span><span class="kw">as.phylo</span>(hc_avg)
<span class="kw">plot</span>(ph_avg, <span class="dt">type =</span> <span class="st">&quot;phylogram&quot;</span>, <span class="dt">cex =</span> <span class="fl">0.7</span>)
<span class="kw">axisPhylo</span>()</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-18-1.png" title="" alt="" width="960" /></p>
<p>Визуализируем дерево, полученное методом невзвешенного попарного среднего, средствами <code>dendextend</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">den_avg &lt;-<span class="st"> </span><span class="kw">as.dendrogram</span>(hc_avg)
<span class="kw">plot</span>(den_avg)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-19-1.png" title="" alt="" width="672" /></p>
</div>
<div id="---r" class="section level2">
<h2>Метод Варда в R</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hc_w2 &lt;-<span class="kw">hclust</span>(d, <span class="dt">method =</span> <span class="st">&quot;ward.D2&quot;</span>)
ph_w2 &lt;-<span class="st"> </span><span class="kw">as.phylo</span>(hc_w2)
<span class="kw">plot</span>(ph_w2, <span class="dt">type =</span> <span class="st">&quot;phylogram&quot;</span>, <span class="dt">cex =</span> <span class="fl">0.7</span>)
<span class="kw">axisPhylo</span>()</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-20-1.png" title="" alt="" width="960" /></p>
<p>Визуализируем дерево, полученное методом Варда, средствами <code>dendextend</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">den_w2 &lt;-<span class="st"> </span><span class="kw">as.dendrogram</span>(hc_w2)
<span class="kw">plot</span>(den_w2)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-21-1.png" title="" alt="" width="672" /></p>
</div>
</div>
<div id="--" class="section level1">
<h1>Оценка качества кластеризации</h1>
<div id="-" class="section level2">
<h2>Кофенетическая корреляция</h2>
<p>Кофенетическое расстояние - расстояние между объектами на дендрограмме</p>
<p>Кофенетическую корреляцию можно рассчитать как пирсоновскую корреляцию (обычную) между матрицами исходных и кофенетических расстояний между всеми парами объектов</p>
<p>Метод, который дает наибольшую кофенетическую корреляцию дает кластеры лучше всего отражающие исходные данные</p>
<p>Можно рассчитать при помощи функции из пакета <code>ape</code></p>
<div id="---r" class="section level3">
<h3>Кофенетическая корреляция в R</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">c_single &lt;-<span class="st"> </span><span class="kw">cophenetic</span>(ph_single)
c_compl &lt;-<span class="st"> </span><span class="kw">cophenetic</span>(ph_compl)
c_avg &lt;-<span class="st"> </span><span class="kw">cophenetic</span>(ph_avg)
c_w2 &lt;-<span class="st"> </span><span class="kw">cophenetic</span>(ph_w2)

<span class="kw">cor</span>(d, <span class="kw">as.dist</span>(c_single))</code></pre></div>
<pre><code>## [1] 0.8423048</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor</span>(d, <span class="kw">as.dist</span>(c_compl))</code></pre></div>
<pre><code>## [1] 0.7083755</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor</span>(d, <span class="kw">as.dist</span>(c_avg))</code></pre></div>
<pre><code>## [1] 0.866091</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor</span>(d, <span class="kw">as.dist</span>(c_w2))</code></pre></div>
<pre><code>## [1] 0.8647086</code></pre>
</div>
<div class="section level3">
<h3>Задание:</h3>
<p>Оцените при помощи кофенетической корреляции качество кластеризаций, полученных разными методами.</p>
<p>Какой метод дает лучший результат?</p>
</div>
</div>
<div id="---" class="section level2">
<h2>Качество и количество кластеров</h2>
<p>На каком уровне нужно делить дендрограмму на кластеры?</p>
<ul>
<li>Можно субъективно, на любом выбранном уровне. Главное, чтобы кластеры были осмысленными и интерпретируемыми.</li>
<li>Можно выбрать, глядя на распределение расстояний ветвления</li>
<li>Можно оценить стабильность кластеризации при помощи бутстрепа и выбрать оптимальное число кластеров.</li>
</ul>
<div id="-" class="section level3">
<h3>Стабильность кластеров</h3>
<p>На хорошей кластеризации кластеры должны воспроизводиться.</p>
<p>Оптимальное число кластеров можно определить рассчитывая меру нестабильности для каждой из выборок бутстрепа (Fang and Wang (2012))</p>
<p>Много раз берем по 2 выборки бутстрепом, и оцениваем стабильность.</p>
<p>Здесь мы используем всего 300 итераций. Для реальной жизни нужно 1000 и больше.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(fpc)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nsel &lt;-<span class="st"> </span><span class="kw">nselectboot</span>(d, <span class="dt">B =</span> <span class="dv">300</span>, <span class="dt">clustermethod =</span> hclustCBI, <span class="dt">seed =</span> <span class="dv">9646</span>, <span class="dt">method =</span> <span class="st">&quot;complete&quot;</span>, <span class="dt">krange=</span><span class="dv">3</span>:<span class="dv">11</span>)</code></pre></div>
<p>Оптимальное число кластеров — с минимальным значением нестабильности</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nsel$kopt <span class="co"># оптимальное число кластеров</span></code></pre></div>
<pre><code>## [1] 11</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nsel$stabk <span class="co"># средние значения нестабильности</span></code></pre></div>
<pre><code>##  [1]         NA         NA 0.09465067 0.05690133 0.04863467 0.03908800
##  [7] 0.03757067 0.03957067 0.03876267 0.03760533 0.03595733</code></pre>
<p>Чтобы легче было выбирать, и чтобы понять, что происходит, изобразим значения нестабильности на графике</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="dv">1</span>:<span class="dv">11</span>, nsel$stabk)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-24-1.png" title="" alt="" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># nsel$stab # матрица с результатами бутстрепа</span></code></pre></div>
</div>
</div>
<div id="-" class="section level2">
<h2>Ширина силуэта</h2>
<p>Ширина силуэта — мера степени принадлежности объекта к кластеру. Это среднее расстояние от данного объекта до других объектов из того же кластера, в сравнении с аналогичной величиной для ближайшего кластера.</p>
<p>Чем больше, тем лучше</p>
<p>Оценим ширину силуэта для 3 или 6 кластеров</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">complete3 &lt;-<span class="st"> </span><span class="kw">cutree</span>(<span class="kw">hclust</span>(d), <span class="dv">3</span>)
qual3&lt;-<span class="st"> </span><span class="kw">cluster.stats</span>(d, complete3)
qual3$clus.avg.silwidths</code></pre></div>
<pre><code>##         1         2         3 
## 0.5968066 0.4067442 0.7830519</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">complete6 &lt;-<span class="st"> </span><span class="kw">cutree</span>(<span class="kw">hclust</span>(d), <span class="dv">6</span>)
qual6&lt;-<span class="st"> </span><span class="kw">cluster.stats</span>(d, complete6)
qual6$clus.avg.silwidths</code></pre></div>
<pre><code>##         1         2         3         4         5         6 
## 0.5571272 0.3156247 0.3700587 0.2276923 0.7383517 0.4044389</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(qual3$clus.avg.silwidths); <span class="kw">mean</span>(qual6$clus.avg.silwidths)</code></pre></div>
<pre><code>## [1] 0.5955342</code></pre>
<pre><code>## [1] 0.4355489</code></pre>
</div>
<div id="--" class="section level2">
<h2>Бутстреп поддержка ветвей</h2>
<p>“An approximately unbiased test of phylogenetic tree selection” (Shimodaria, 2002)</p>
<p>Этот тест использует специальный вариант бутстрепа — multiscale bootstrap. Мы не просто многократно берем бутстреп-выборки и оцениваем для них вероятность получения топологий (BP p-value), эти выборки еще и будут с разным числом объектов. По изменению BP при разных объемах выборки можно вычислить AU (approximately unbiased p-value).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(pvclust)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># итераций должно быть 1000 и больше, здесь мало для скорости</span>
<span class="kw">set.seed</span>(<span class="dv">42</span>)
cl_boot &lt;-<span class="st"> </span><span class="kw">pvclust</span>(<span class="kw">t</span>(siris[, -<span class="dv">5</span>]), <span class="dt">method.hclust =</span> <span class="st">&quot;average&quot;</span>, <span class="dt">nboot =</span> <span class="dv">100</span>, <span class="dt">method.dist =</span> <span class="st">&quot;euclidean&quot;</span>)</code></pre></div>
<pre><code>## Bootstrap (r = 0.5)... Done.
## Bootstrap (r = 0.5)... Done.
## Bootstrap (r = 0.5)... Done.
## Bootstrap (r = 0.75)... Done.
## Bootstrap (r = 0.75)... Done.
## Bootstrap (r = 1.0)... Done.
## Bootstrap (r = 1.0)... Done.
## Bootstrap (r = 1.0)... Done.
## Bootstrap (r = 1.25)... Done.
## Bootstrap (r = 1.25)... Done.</code></pre>
<pre><code>## Warning in a$p[] &lt;- c(1, bp[r == 1]): number of items to replace is not a
## multiple of replacement length</code></pre>
<p>Дерево с величинами поддержки</p>
<p>AU — approximately unbiased p-values (красный), BP — bootstrap p-values (зеленый)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(cl_boot)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-27-1.png" title="" alt="" width="960" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># pvrect(cl_boot) # достоверные ветвления</span></code></pre></div>
<p>Для диагностики качества оценок AU нам понадобится график стандартных ошибок для AU p-value. Он нужен, чтобы оценить точность оценки самих AU. Чем больше было бутстреп-итераций, тем точнее будет оценка.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">seplot</span>(cl_boot, <span class="dt">cex =</span> <span class="fl">0.5</span>)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-28-1.png" title="" alt="" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># print(cl_boot) # все значения</span></code></pre></div>
</div>
</div>
<div id="--" class="section level1">
<h1>Сопоставление деревьев: Танглграммы</h1>
<div class="section level2">
<h2>Танглграмма</h2>
<p>Два дерева (с непохожим ветвлением) выравнивают, вращая случайным образом ветви вокруг оснований. Итеративный алгоритм. Картина каждый раз разная.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">395</span>)
untang_w &lt;-<span class="st"> </span><span class="kw">untangle_step_rotate_2side</span>(den_compl, den_w2, <span class="dt">print_times =</span> F)

<span class="co"># танглграмма</span>
<span class="kw">tanglegram</span>(untang_w[[<span class="dv">1</span>]], untang_w[[<span class="dv">2</span>]],
           <span class="dt">highlight_distinct_edges =</span> <span class="ot">FALSE</span>,
           <span class="dt">common_subtrees_color_lines =</span> F,
           <span class="dt">main =</span> <span class="st">&quot;Tanglegram&quot;</span>,
           <span class="dt">main_left =</span> <span class="st">&quot;Left tree&quot;</span>,
           <span class="dt">main_right =</span> <span class="st">&quot;Right tree&quot;</span>,
           <span class="dt">columns_width =</span> <span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">1</span>, <span class="dv">8</span>),
           <span class="dt">margin_top =</span> <span class="fl">3.2</span>, <span class="dt">margin_bottom =</span> <span class="fl">2.5</span>,
           <span class="dt">margin_inner =</span> <span class="dv">4</span>, <span class="dt">margin_outer =</span> <span class="fl">0.5</span>,
           <span class="dt">lwd =</span> <span class="fl">1.2</span>, <span class="dt">edge.lwd =</span> <span class="fl">1.2</span>, 
           <span class="dt">lab.cex =</span> <span class="dv">1</span>, <span class="dt">cex_main =</span> <span class="dv">1</span>)</code></pre></div>
<p><img src="03_classification_files/figure-html/tang-1.png" title="" alt="" width="672" /></p>
<div id="-1" class="section level3">
<h3>Задание</h3>
<p>Постройте танглграмму из дендрограмм, полученных методом ближайшего соседа и методом Варда.</p>
</div>
</div>
</div>
<div id="--." class="section level1">
<h1>Тепловые карты экспрессии.</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(gplots) <span class="co"># для тепловых карт</span></code></pre></div>
<div id="---" class="section level2">
<h2>Палитры для тепловых карт</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># library(RColorBrewer)</span>
pal_green &lt;-<span class="st"> </span><span class="kw">colorpanel</span>(<span class="dv">75</span>, <span class="dt">low =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">mid =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;yellow&quot;</span>)
<span class="co"># library(spatstat) # to convert palette to grayscale</span>
<span class="co"># pal_gray &lt;- to.grey(pal_green, weights=c(1,1,1))</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(siris[, -<span class="dv">5</span>])
<span class="kw">heatmap.2</span>(dat, <span class="dt">col=</span>pal_green, <span class="dt">scale =</span> <span class="st">&quot;none&quot;</span>, <span class="dt">key=</span><span class="ot">TRUE</span>, <span class="dt">symkey=</span><span class="ot">FALSE</span>, <span class="dt">density.info=</span><span class="st">&quot;none&quot;</span>, <span class="dt">trace=</span><span class="st">&quot;none&quot;</span>, <span class="dt">cexRow=</span><span class="dv">1</span>, <span class="dt">cexCol =</span> <span class="dv">1</span>, <span class="dt">keysize =</span> <span class="dv">1</span>, <span class="dt">margins =</span> <span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">5</span>))</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-31-1.png" title="" alt="" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">heatmap.2</span>(dat, <span class="dt">col=</span>pal_green, <span class="dt">scale =</span> <span class="st">&quot;none&quot;</span>, <span class="dt">key=</span><span class="ot">TRUE</span>, <span class="dt">symkey=</span><span class="ot">FALSE</span>, <span class="dt">density.info=</span><span class="st">&quot;none&quot;</span>, <span class="dt">trace=</span><span class="st">&quot;none&quot;</span>, <span class="dt">cexRow=</span><span class="dv">1</span>, <span class="dt">cexCol =</span> <span class="dv">1</span>, <span class="dt">keysize =</span> <span class="dv">1</span>, <span class="dt">margins =</span> <span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">5</span>), <span class="dt">key.par =</span> <span class="kw">list</span>(<span class="dt">mgp =</span> <span class="kw">c</span>(<span class="fl">1.5</span>, <span class="fl">0.9</span>, <span class="dv">0</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="fl">0.1</span>), <span class="dt">cex =</span> <span class="dv">1</span>), <span class="dt">key.title =</span> <span class="ot">NA</span>, <span class="dt">key.xlab =</span> <span class="ot">NA</span>)</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-31-2.png" title="" alt="" width="672" /></p>
<p>Еще один вариант</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(NMF)</code></pre></div>
<pre><code>## Loading required package: pkgmaker</code></pre>
<pre><code>## Loading required package: registry</code></pre>
<pre><code>## 
## Attaching package: &#39;pkgmaker&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     isNamespaceLoaded</code></pre>
<pre><code>## Loading required package: rngtools</code></pre>
<pre><code>## Loading required package: cluster</code></pre>
<pre><code>## NMF - BioConductor layer [OK] | Shared memory capabilities [NO: bigmemory] | Cores 3/4</code></pre>
<pre><code>##   To enable shared memory capabilities, try: install.extras(&#39;
## NMF
## &#39;)</code></pre>
<pre><code>## 
## Attaching package: &#39;NMF&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:ape&#39;:
## 
##     consensus</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">aheatmap</span>(dat, <span class="dt">color =</span> <span class="st">&quot;-RdBu:256&quot;</span>, <span class="dt">annRow =</span> siris[, <span class="dv">5</span>])</code></pre></div>
<p><img src="03_classification_files/figure-html/unnamed-chunk-32-1.png" title="" alt="" width="672" /></p>
</div>
<div class="section level2 unnumbered">
<h2>Ссылки</h2>
<div id="refs" class="references">
<div id="ref-Galili_2015">
<p>Galili, T. 2015. Dendextend: An r package for visualizing, adjusting, and comparing trees of hierarchical clustering. Bioinformatics.</p>
</div>
<div id="ref-Paradis_2004">
<p>Paradis, E., J. Claude, and K. Strimmer. 2004. APE: Analyses of phylogenetics and evolution in R language. Bioinformatics 20:289–290.</p>
</div>
</div>
</div>
</div>


<!-- some extra javascript for older browsers -->
<script type="text/javascript" src="libs/polyfill.js"></script>


<!-- bizible -->
<script type="text/javascript" src="//cdn.bizible.com/scripts/bizible.js" async=""></script>


<!-- disqus
  <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'rmarkdown'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

-->


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>


</body>
</html>
